import{r as e,d as s}from"./vendor-DrZUJsRd.js";import{c as t}from"./supabase-BB2vZDKr.js";import{b as a,t as r,c as l}from"./utils-DgbkaoEk.js";import{N as i,a as n,u as c,b as d,c as o,R as m,d as x,B as u}from"./router-DShI7M2a.js";import{R as h,B as p,C as g,X as j,Y as y,T as f,a as v,P as b,b as N,c as w,L as _,d as S}from"./charts-d1WDfZTJ.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))s(e);new MutationObserver(e=>{for(const t of e)if("childList"===t.type)for(const e of t.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&s(e)}).observe(document,{childList:!0,subtree:!0})}function s(e){if(e.ep)return;e.ep=!0;const s=function(e){const s={};return e.integrity&&(s.integrity=e.integrity),e.referrerPolicy&&(s.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?s.credentials="include":"anonymous"===e.crossOrigin?s.credentials="omit":s.credentials="same-origin",s}(e);fetch(e.href,s)}}();var C={exports:{}},k={},A=e,E=Symbol.for("react.element"),D=Symbol.for("react.fragment"),R=Object.prototype.hasOwnProperty,T=A.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,I={key:!0,ref:!0,__self:!0,__source:!0};function P(e,s,t){var a,r={},l=null,i=null;for(a in void 0!==t&&(l=""+t),void 0!==s.key&&(l=""+s.key),void 0!==s.ref&&(i=s.ref),s)R.call(s,a)&&!I.hasOwnProperty(a)&&(r[a]=s[a]);if(e&&e.defaultProps)for(a in s=e.defaultProps)void 0===r[a]&&(r[a]=s[a]);return{$$typeof:E,type:e,key:l,ref:i,props:r,_owner:T.current}}k.Fragment=D,k.jsx=P,k.jsxs=P,C.exports=k;var O,L=C.exports,q=s;O=q.createRoot,q.hydrateRoot;const M="https://dlvpvzfztyzcatcpgwzo.supabase.co",U="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRsdnB2emZ6dHl6Y2F0Y3Bnd3pvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTMyODQ5NTcsImV4cCI6MjA2ODg2MDk1N30.9v5Adsd9GYaB_cFSmamFzRdNIcuBIL7E77ppM7efn2Y",F="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRsdnB2emZ6dHl6Y2F0Y3Bnd3pvIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc1MzI4NDk1NywiZXhwIjoyMDY4ODYwOTU3fQ.VI-Kv0Qu9bQVKO1fBlRue9xrD6l7Ij8Q173ACeIwnHQ",z=Boolean(""!==M.trim()&&""!==U.trim()&&""!==F.trim()&&!0),B=z?t(M,U,{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0}}):null,$=z?t(M,F,{auth:{autoRefreshToken:!1,persistSession:!1}}):null,Z=!z;class Q{static async log(e){try{if(!B)return void 0;let s=e.user_id;if(!s){const e=localStorage.getItem("userData");if(e){s=JSON.parse(e).id}}const t=navigator.userAgent,a={user_id:s,activity_type:e.activity_type,description:e.description,metadata:e.metadata?JSON.stringify(e.metadata):null,ip_address:e.ip_address||null,user_agent:t},{error:r}=await B.from("activity_logs").insert(a)}catch(s){}}static async logLogin(e,s){await this.log({user_id:e,activity_type:"user_login",description:`User logged in: ${s}`,metadata:{email:s,login_time:(new Date).toISOString()}})}static async logLogout(e,s){await this.log({user_id:e,activity_type:"user_logout",description:`User logged out: ${s}`,metadata:{email:s,logout_time:(new Date).toISOString()}})}static async logTestStart(e,s,t){await this.log({user_id:e,activity_type:"test_started",description:`Started test: ${t}`,metadata:{survey_id:s,survey_title:t,start_time:(new Date).toISOString()}})}static async logTestComplete(e,s,t,a,r){await this.log({user_id:e,activity_type:"test_completed",description:`Completed test: ${t} - Score: ${a}% (${r?"Passed":"Failed"})`,metadata:{survey_id:s,survey_title:t,score:a,is_passed:r,completion_time:(new Date).toISOString()}})}static async logUserCreated(e,s,t,a){await this.log({user_id:e,activity_type:"user_created",description:`Created new user: ${t} with role ${a}`,metadata:{new_user_id:s,new_user_email:t,role_name:a,creation_time:(new Date).toISOString()}})}static async logSurveyCreated(e,s,t){await this.log({user_id:e,activity_type:"survey_created",description:`Created new survey: ${t}`,metadata:{survey_id:s,survey_title:t,creation_time:(new Date).toISOString()}})}static async logSurveyUpdated(e,s,t){await this.log({user_id:e,activity_type:"survey_updated",description:`Updated survey: ${t}`,metadata:{survey_id:s,survey_title:t,update_time:(new Date).toISOString()}})}static async logSurveyDeleted(e,s,t){await this.log({user_id:e,activity_type:"survey_deleted",description:`Deleted survey: ${t}`,metadata:{survey_id:s,survey_title:t,deletion_time:(new Date).toISOString()}})}static async logQuestionUploaded(e,s,t){await this.log({user_id:e,activity_type:"questions_uploaded",description:`Uploaded ${t} questions to survey`,metadata:{survey_id:s,questions_count:t,upload_time:(new Date).toISOString()}})}static async logCertificateIssued(e,s,t,a){await this.log({user_id:e,activity_type:"certificate_issued",description:`Certificate issued: ${t} for ${a}`,metadata:{certificate_id:s,certificate_number:t,survey_title:a,issue_time:(new Date).toISOString()}})}static async logSettingUpdated(e,s,t,a){await this.log({user_id:e,activity_type:"setting_updated",description:`Updated setting: ${s}`,metadata:{setting_key:s,old_value:t,new_value:a,update_time:(new Date).toISOString()}})}}class Y{async handleResponse(e){return e.error?{success:!1,message:e.error.message||"An error occurred",data:void 0}:{success:!0,message:"Operation completed successfully",data:e.data}}async handleError(e){return{success:!1,message:e.message||"An unexpected error occurred",data:void 0}}async getSurveySections(e){try{if(!B)return{success:!1,message:"Database not configured",data:[]};const{data:s,error:t}=await B.from("survey_sections").select("*").eq("survey_id",e).order("section_order");if(t)throw t;return{success:!0,data:s||[],message:"Sections fetched successfully"}}catch(s){return{success:!1,message:s instanceof Error?s.message:"Failed to fetch sections",data:[]}}}async createSection(e){try{if(!B)return{success:!1,message:"Database not configured"};const{data:s,error:t}=await B.from("survey_sections").insert({survey_id:e.surveyId,title:e.title,description:e.description,questions_count:e.questionsCount,section_order:e.sectionOrder}).select().single();if(t)throw t;return{success:!0,data:s,message:"Section created successfully"}}catch(s){return{success:!1,message:s instanceof Error?s.message:"Failed to create section"}}}async updateSection(e,s){try{if(!B)return{success:!1,message:"Database not configured"};const{data:t,error:a}=await B.from("survey_sections").update({title:s.title,description:s.description,questions_count:s.questionsCount,section_order:s.sectionOrder,updated_at:(new Date).toISOString()}).eq("id",e).select().single();if(a)throw a;return{success:!0,data:t,message:"Section updated successfully"}}catch(t){return{success:!1,message:t instanceof Error?t.message:"Failed to update section"}}}async deleteSection(e){try{if(!B)return{success:!1,message:"Database not configured"};const{error:s}=await B.from("survey_sections").delete().eq("id",e);if(s)throw s;return{success:!0,message:"Section deleted successfully"}}catch(s){return{success:!1,message:s instanceof Error?s.message:"Failed to delete section"}}}}const V=new class extends Y{async login(e,s){var t;try{if(Z)return{success:!1,message:"Demo mode: Supabase not configured. Please set up your Supabase credentials."};const{data:a,error:r}=await B.auth.signInWithPassword({email:e,password:s});if(r)return{success:!1,message:r.message||"Invalid email or password"};if(!a.user)return{success:!1,message:"Authentication failed"};const{data:l,error:i}=await B.from("users").select("\n          *,\n          role:roles(*)\n        ").eq("id",a.user.id).single();if(i||!l)return{success:!1,message:"User profile not found"};await B.from("users").update({last_login:(new Date).toISOString()}).eq("id",a.user.id),await Q.logLogin(a.user.id,e);return{success:!0,message:"Login successful",data:{user:{id:l.id,email:l.email,name:l.name,roleId:l.role_id,role:{id:l.role.id,name:l.role.name,description:l.role.description,level:l.role.level,isActive:l.role.is_active,createdAt:new Date(l.role.created_at),updatedAt:new Date(l.role.updated_at),menuAccess:l.role.menu_access},isActive:l.is_active,jurisdiction:l.jurisdiction,zone:l.zone,region:l.region,district:l.district,employeeId:l.employee_id,phoneNumber:l.phone_number,createdAt:new Date(l.created_at),updatedAt:new Date(l.updated_at),lastLogin:l.last_login?new Date(l.last_login):void 0},token:(null==(t=a.session)?void 0:t.access_token)||"",session:a.session}}}catch(a){return this.handleError(a)}}async logout(){try{if(Z)return{success:!0,message:"Logged out (demo mode)"};const{error:e}=await B.auth.signOut();if(e)throw e;return{success:!0,message:"Logged out successfully"}}catch(e){return this.handleError(e)}}async changePassword(e,s){try{if(Z)return{success:!1,message:"Password change not available in demo mode"};const{error:e}=await B.auth.updateUser({password:s});if(e)throw e;return{success:!0,message:"Password changed successfully"}}catch(t){return this.handleError(t)}}},K=new class extends Y{async getUsers(){try{if(Z)return{success:!1,message:"User management not available in demo mode"};const{data:e,error:s}=await $.from("users").select("\n          *,\n          role:roles(*)\n        ").order("created_at",{ascending:!1});if(s)throw s;if(!e||0===e.length)return{success:!0,message:"No users found. Initialize the database to create demo users.",data:[]};return{success:!0,message:"Users fetched successfully",data:e.map(e=>({id:e.id,email:e.email,name:e.name,roleId:e.role_id,role:{id:e.role.id,name:e.role.name,description:e.role.description,level:e.role.level,isActive:e.role.is_active,createdAt:new Date(e.role.created_at),updatedAt:new Date(e.role.updated_at)},isActive:e.is_active,jurisdiction:e.jurisdiction,zone:e.zone,region:e.region,district:e.district,employeeId:e.employee_id,phoneNumber:e.phone_number,createdAt:new Date(e.created_at),updatedAt:new Date(e.updated_at),lastLogin:e.last_login?new Date(e.last_login):void 0}))}}catch(e){return this.handleError(e)}}async createUser(e){try{if(Z)return{success:!1,message:"User creation not available in demo mode"};const{data:s,error:t}=await $.auth.admin.createUser({email:e.email,password:e.password,email_confirm:!0,user_metadata:{name:e.name}});if(t)throw t;const r=a.hashSync(e.password,10),{data:l,error:i}=await $.from("users").insert({id:s.user.id,email:e.email,password_hash:r,name:e.name,role_id:e.roleId,jurisdiction:e.jurisdiction,zone:e.zone,region:e.region,district:e.district,employee_id:e.employeeId,phone_number:e.phoneNumber}).select("\n          *,\n          role:roles(*)\n        ").single();if(i)throw i;const n={id:l.id,email:l.email,name:l.name,roleId:l.role_id,role:{id:l.role.id,name:l.role.name,description:l.role.description,level:l.role.level,isActive:l.role.is_active,createdAt:new Date(l.role.created_at),updatedAt:new Date(l.role.updated_at)},isActive:l.is_active,jurisdiction:l.jurisdiction,zone:l.zone,region:l.region,district:l.district,employeeId:l.employee_id,phoneNumber:l.phone_number,createdAt:new Date(l.created_at),updatedAt:new Date(l.updated_at)};return{success:!0,message:`User created successfully! Login credentials:\nEmail: ${e.email}\nPassword: ${e.password}\n\nThe user should change their password on first login.`,data:n}}catch(s){return this.handleError(s)}}async updateUser(e,s){try{if(Z)return{success:!1,message:"User updates not available in demo mode"};const t={name:s.name,email:s.email,role_id:s.roleId,jurisdiction:s.jurisdiction,zone:s.zone,region:s.region,district:s.district,employee_id:s.employeeId,phone_number:s.phoneNumber,updated_at:(new Date).toISOString()};s.password&&s.password.trim()&&(t.password_hash=a.hashSync(s.password,10),await $.auth.admin.updateUserById(e,{password:s.password}));const{data:r,error:l}=await $.from("users").update(t).eq("id",e).select("\n          *,\n          role:roles(*)\n        ").single();if(l)throw l;return{success:!0,message:"User updated successfully",data:{id:r.id,email:r.email,name:r.name,roleId:r.role_id,role:{id:r.role.id,name:r.role.name,description:r.role.description,level:r.role.level,isActive:r.role.is_active,createdAt:new Date(r.role.created_at),updatedAt:new Date(r.role.updated_at)},isActive:r.is_active,jurisdiction:r.jurisdiction,zone:r.zone,region:r.region,district:r.district,employeeId:r.employee_id,phoneNumber:r.phone_number,createdAt:new Date(r.created_at),updatedAt:new Date(r.updated_at)}}}catch(t){return this.handleError(t)}}async deleteUser(e){try{if(Z)return{success:!1,message:"User deletion not available in demo mode"};const{error:s}=await $.from("users").delete().eq("id",e);if(s)throw s;const{error:t}=await $.auth.admin.deleteUser(e);if(t)throw t;return{success:!0,message:"User deleted successfully"}}catch(s){return this.handleError(s)}}},W=new class extends Y{async getRoles(){try{if(Z)return{success:!1,message:"Role management not available in demo mode"};const{data:e,error:s}=await B.from("roles").select("*").order("level",{ascending:!0});if(s)throw s;return{success:!0,message:"Roles fetched successfully",data:(e||[]).map(e=>({id:e.id,name:e.name,description:e.description,level:e.level,isActive:e.is_active,menuAccess:e.menu_access,createdAt:new Date(e.created_at),updatedAt:new Date(e.updated_at)}))}}catch(e){return this.handleError(e)}}async createRole(e){try{if(Z)return{success:!1,message:"Role creation not available in demo mode"};const{data:s,error:t}=await B.from("roles").insert({name:e.name,description:e.description,level:e.level||5,is_active:!0}).select().single();if(t)throw t;return{success:!0,message:"Role created successfully",data:{id:s.id,name:s.name,description:s.description,level:s.level,isActive:s.is_active,createdAt:new Date(s.created_at),updatedAt:new Date(s.updated_at)}}}catch(s){return this.handleError(s)}}async updateRole(e,s){try{if(Z)return{success:!1,message:"Role updates not available in demo mode"};const{data:t,error:a}=await B.from("roles").update({name:s.name,description:s.description,updated_at:(new Date).toISOString()}).eq("id",e).select().single();if(a)throw a;return{success:!0,message:"Role updated successfully",data:{id:t.id,name:t.name,description:t.description,level:t.level,isActive:t.is_active,createdAt:new Date(t.created_at),updatedAt:new Date(t.updated_at)}}}catch(t){return this.handleError(t)}}async deleteRole(e){try{if(Z)return{success:!1,message:"Role deletion not available in demo mode"};const{error:s}=await B.from("roles").delete().eq("id",e);if(s)throw s;return{success:!0,message:"Role deleted successfully"}}catch(s){return this.handleError(s)}}async getPermissions(){try{return{success:!0,message:"Permissions fetched successfully",data:[{id:"1",name:"Create Users",resource:"users",action:"create",description:"Create new users",module:"User Management"},{id:"2",name:"Edit Users",resource:"users",action:"update",description:"Edit existing users",module:"User Management"},{id:"3",name:"Delete Users",resource:"users",action:"delete",description:"Delete users",module:"User Management"},{id:"4",name:"View Surveys",resource:"surveys",action:"read",description:"View surveys",module:"Survey Management"},{id:"5",name:"Create Surveys",resource:"surveys",action:"create",description:"Create new surveys",module:"Survey Management"}]}}catch(e){return this.handleError(e)}}async updateRoleMenuAccess(e,s){try{if(Z)return{success:!1,message:"Menu access updates not available in demo mode"};const{error:t}=await B.from("roles").update({menu_access:s,updated_at:(new Date).toISOString()}).eq("id",e);if(t)throw t;return{success:!0,message:"Menu access updated successfully"}}catch(t){return this.handleError(t)}}},H=new class extends Y{async getSurveys(){try{if(Z)return{success:!1,message:"Survey management not available in demo mode"};const{data:e,error:s}=await B.from("surveys").select("*").order("created_at",{ascending:!1});if(s)throw s;return{success:!0,message:"Surveys fetched successfully",data:(e||[]).map(e=>({id:e.id,title:e.title,description:e.description,targetDate:new Date(e.target_date),duration:e.duration,totalQuestions:e.total_questions,passingScore:e.passing_score,maxAttempts:e.max_attempts,isActive:e.is_active,assignedZones:e.assigned_zones,assignedRegions:e.assigned_regions,sections:[],createdAt:new Date(e.created_at),updatedAt:new Date(e.updated_at),createdBy:e.created_by}))}}catch(e){return this.handleError(e)}}async createSurvey(e){try{if(Z)return{success:!1,message:"Survey creation not available in demo mode"};const{data:s,error:t}=await B.from("surveys").insert({title:e.title,description:e.description,target_date:e.targetDate.toISOString().split("T")[0],duration:e.duration,total_questions:e.totalQuestions,passing_score:e.passingScore,max_attempts:e.maxAttempts,assigned_zones:e.assignedZones,assigned_regions:e.assignedRegions,created_by:e.createdBy}).select().single();if(t)throw t;return{success:!0,message:"Survey created successfully",data:{id:s.id,title:s.title,description:s.description,targetDate:new Date(s.target_date),duration:s.duration,totalQuestions:s.total_questions,passingScore:s.passing_score,maxAttempts:s.max_attempts,isActive:s.is_active,assignedZones:s.assigned_zones,assignedRegions:s.assigned_regions,sections:[],createdAt:new Date(s.created_at),updatedAt:new Date(s.updated_at),createdBy:s.created_by}}}catch(s){return this.handleError(s)}}async updateSurvey(e,s){try{if(Z)return{success:!1,message:"Survey updates not available in demo mode"};const t={title:s.title,description:s.description,duration:s.duration,total_questions:s.totalQuestions,passing_score:s.passingScore,max_attempts:s.maxAttempts,updated_at:(new Date).toISOString()};s.targetDate&&(t.target_date=s.targetDate instanceof Date?s.targetDate.toISOString().split("T")[0]:s.targetDate),void 0!==s.assignedZones&&(t.assigned_zones=s.assignedZones),void 0!==s.assignedRegions&&(t.assigned_regions=s.assignedRegions),void 0!==s.isActive&&(t.is_active=s.isActive);const{data:a,error:r}=await B.from("surveys").update(t).eq("id",e).select().single();if(r)throw r;return{success:!0,message:"Survey updated successfully",data:{id:a.id,title:a.title,description:a.description,targetDate:new Date(a.target_date),duration:a.duration,totalQuestions:a.total_questions,passingScore:a.passing_score,maxAttempts:a.max_attempts,isActive:a.is_active,assignedZones:a.assigned_zones,assignedRegions:a.assigned_regions,sections:[],createdAt:new Date(a.created_at),updatedAt:new Date(a.updated_at),createdBy:a.created_by}}}catch(t){return this.handleError(t)}}async deleteSurvey(e){try{if(Z)return{success:!1,message:"Survey deletion not available in demo mode"};const{error:s}=await B.from("surveys").delete().eq("id",e);if(s)throw s;return{success:!0,message:"Survey deleted successfully"}}catch(s){return this.handleError(s)}}async getSurveySections(e){try{if(Z)return{success:!1,message:"Survey sections not available in demo mode"};const{data:s,error:t}=await B.from("survey_sections").select("*").eq("survey_id",e).order("section_order",{ascending:!0});if(t)throw t;return{success:!0,message:"Survey sections fetched successfully",data:s||[]}}catch(s){return this.handleError(s)}}},G=new class extends Y{async getQuestions(e){try{if(Z)return{success:!1,message:"Questions not available in demo mode"};const{data:s,error:t}=await B.from("questions").select("\n          *,\n          options:question_options(*)\n        ").eq("section_id",e).order("question_order",{ascending:!0});if(t)throw t;return{success:!0,message:"Questions fetched successfully",data:(s||[]).map(e=>({id:e.id,sectionId:e.section_id,text:e.text,type:e.question_type,complexity:e.complexity,points:e.points,explanation:e.explanation,order:e.question_order,options:(e.options||[]).map(e=>({id:e.id,text:e.text,isCorrect:e.is_correct})),correctAnswers:(e.options||[]).filter(e=>e.is_correct).map(e=>e.id),createdAt:new Date(e.created_at),updatedAt:new Date(e.updated_at)}))}}catch(s){return this.handleError(s)}}},X=new class extends Y{async createTestSession(e){try{if(Z)return{success:!1,message:"Test sessions not available in demo mode"};const{data:{user:s}}=await B.auth.getUser();if(!s)throw new Error("User not authenticated");const{data:t,error:a}=await B.from("surveys").select("*").eq("id",e).single();if(a||!t)throw new Error("Survey not found");const{data:r,error:l}=await B.from("test_results").select("attempt_number").eq("user_id",s.id).eq("survey_id",e).order("attempt_number",{ascending:!1}).limit(1);if(l)throw l;const i=r&&r.length>0?r[0].attempt_number+1:1;if(i>t.max_attempts)throw new Error("Maximum attempts exceeded");const{data:n,error:c}=await B.from("test_sessions").insert({user_id:s.id,survey_id:e,time_remaining:60*t.duration,attempt_number:i,session_status:"in_progress"}).select().single();if(c)throw c;return{success:!0,message:"Test session created successfully",data:{id:n.id,userId:n.user_id,surveyId:n.survey_id,startTime:new Date(n.start_time),timeRemaining:n.time_remaining,currentQuestionIndex:n.current_question_index,answers:[],status:n.session_status,attemptNumber:n.attempt_number}}}catch(s){return this.handleError(s)}}async getSession(e){try{if(Z)return{success:!1,message:"Test sessions not available in demo mode"};const{data:s,error:t}=await B.from("test_sessions").select("\n          *,\n          answers:test_answers(*)\n        ").eq("id",e).single();if(t)throw t;return{success:!0,message:"Session fetched successfully",data:{id:s.id,userId:s.user_id,surveyId:s.survey_id,startTime:new Date(s.start_time),endTime:s.end_time?new Date(s.end_time):void 0,timeRemaining:s.time_remaining,currentQuestionIndex:s.current_question_index,answers:(s.answers||[]).map(e=>({questionId:e.question_id,selectedOptions:e.selected_options||[],isCorrect:e.is_correct,timeSpent:e.time_spent,answered:e.answered})),status:s.session_status,attemptNumber:s.attempt_number,score:s.score,isPassed:s.is_passed,completedAt:s.completed_at?new Date(s.completed_at):void 0}}}catch(s){return this.handleError(s)}}async updateSession(e,s){try{if(Z)return{success:!1,message:"Session updates not available in demo mode"};const{error:t}=await B.from("test_sessions").update({current_question_index:s.currentQuestionIndex,time_remaining:s.timeRemaining,updated_at:(new Date).toISOString()}).eq("id",e);if(t)throw t;if(s.answers&&s.answers.length>0)for(const a of s.answers)await this.saveAnswer(e,a.questionId,a.selectedOptions);return{success:!0,message:"Session updated successfully"}}catch(t){return this.handleError(t)}}async saveAnswer(e,s,t){try{if(Z)return{success:!1,message:"Answer saving not available in demo mode"};const{error:a}=await B.from("test_answers").upsert({session_id:e,question_id:s,selected_options:t,answered:t.length>0,updated_at:(new Date).toISOString()},{onConflict:"session_id,question_id"});if(a)throw a;return{success:!0,message:"Answer saved successfully"}}catch(a){return this.handleError(a)}}async submitTest(e){try{if(Z)return{success:!1,message:"Test submission not available in demo mode"};const{data:s,error:t}=await B.from("test_sessions").select("\n          *,\n          survey:surveys(*),\n          answers:test_answers(*)\n        ").eq("id",e).single();if(t||!s)throw new Error("Session not found");const{data:a,error:r}=await B.from("survey_sections").select("questions_count").eq("survey_id",s.survey_id);if(r)throw new Error("Failed to fetch survey sections");const l=(null==a?void 0:a.reduce((e,s)=>e+s.questions_count,0))||0,{data:i,error:n}=await B.from("survey_sections").select("\n          *,\n          questions:questions(\n            *,\n            options:question_options(*)\n          )\n        ").eq("survey_id",s.survey_id).order("section_order",{ascending:!0});if(n)throw n;const c=i.flatMap(e=>e.questions.map(s=>({...s,sectionId:e.id,sectionTitle:e.title})));let d=0;const o=[],m=c.reduce((e,s)=>(e[s.sectionId]||(e[s.sectionId]={sectionId:s.sectionId,sectionTitle:s.sectionTitle,questions:[]}),e[s.sectionId].questions.push(s),e),{});for(const e of Object.values(m)){let t=0;const a=e.questions.length;for(const l of e.questions){const e=s.answers.find(e=>e.question_id===l.id),a=l.options.filter(e=>e.is_correct).map(e=>e.id);if(e&&e.selected_options){const s=e.selected_options;if("single_choice"===l.question_type)1===s.length&&a.includes(s[0])&&(d++,t++);else if("multiple_choice"===l.question_type){a.length===s.length&&a.every(e=>s.includes(e))&&(d++,t++)}}}const r=a>0?t/a*100:0;o.push({section_id:e.sectionId,section_title:e.sectionTitle,score:r,total_questions:a,correct_answers:t})}const x=l>0?d/l*100:0,u=x>=s.survey.passing_score,h=60*s.survey.duration-s.time_remaining,{data:p,error:g}=await B.from("test_results").insert({user_id:s.user_id,survey_id:s.survey_id,session_id:e,score:x,total_questions:l,correct_answers:d,is_passed:u,time_spent:h,attempt_number:s.attempt_number,grade:this.calculateGrade(x)}).select().single();if(g)throw g;for(const e of o)await B.from("section_scores").insert({result_id:p.id,...e});await B.from("test_sessions").update({session_status:"completed",end_time:(new Date).toISOString(),score:x,is_passed:u,completed_at:(new Date).toISOString()}).eq("id",e);let j=null;if(u){const e=`CERT-${Date.now()}-${Math.random().toString(36).substring(2,8).toUpperCase()}`,{data:t,error:a}=await B.from("certificates").insert({user_id:s.user_id,survey_id:s.survey_id,result_id:p.id,certificate_number:e,certificate_status:"active"}).select().single();!a&&t&&(j=t.id,await B.from("test_results").update({certificate_id:j}).eq("id",p.id))}const y={id:p.id,userId:p.user_id,user:{},surveyId:p.survey_id,survey:{},sessionId:p.session_id,score:p.score,totalQuestions:p.total_questions,correctAnswers:p.correct_answers,isPassed:p.is_passed,timeSpent:p.time_spent,attemptNumber:p.attempt_number,sectionScores:o.map(e=>({sectionId:e.section_id,sectionTitle:e.section_title,score:e.score,totalQuestions:e.total_questions,correctAnswers:e.correct_answers})),completedAt:new Date(p.completed_at),certificateId:j,grade:p.grade};return{success:!0,message:`Test submitted successfully! Score: ${x.toFixed(1)}% (${u?"Passed":"Failed"})`,data:y}}catch(s){return this.handleError(s)}}calculateGrade(e){return e>=90?"A+":e>=80?"A":e>=70?"B":e>=60?"C":e>=50?"D":"F"}async syncOfflineData(){try{return{success:!0,message:"Data synced successfully"}}catch(e){return this.handleError(e)}}async logSecurityViolation(e,s){try{return Z?{success:!0,message:"Security violation logged (demo mode)"}:(await Q.log({activity_type:"security_violation",description:`Security violation during test: ${s}`,metadata:{session_id:e,violation:s}}),{success:!0,message:"Security violation logged"})}catch(t){return this.handleError(t)}}},J=new class extends Y{async getDashboardData(){try{if(Z)return{success:!1,message:"Dashboard not available in demo mode"};if(!$)throw new Error("Supabase admin client not available");const{count:e,error:s}=await $.from("users").select("*",{count:"exact",head:!0});if(s)throw s;const{count:t,error:a}=await $.from("surveys").select("*",{count:"exact",head:!0});if(a)throw a;const{count:r,error:l}=await $.from("test_results").select("*",{count:"exact",head:!0});if(l)throw l;const{data:i,error:n}=await $.from("test_results").select("score, is_passed");if(n)throw n;const c=i&&i.length>0?i.reduce((e,s)=>e+s.score,0)/i.length:0,d=i?i.filter(e=>e.is_passed).length:0,o=i&&i.length>0?d/i.length*100:0,{data:m,error:x}=await $.from("activity_logs").select("\n          id,\n          activity_type,\n          description,\n          user_id,\n          created_at,\n          users!inner(name)\n        ").order("created_at",{ascending:!1}).limit(10),u=m?m.map(e=>{var s;return{id:e.id,type:e.activity_type,description:e.description,userId:e.user_id||"",userName:(null==(s=e.users)?void 0:s.name)||"Unknown User",timestamp:new Date(e.created_at)}}):[],{data:h,error:p}=await $.from("test_results").select("\n          is_passed,\n          users!inner(\n            role_id,\n            roles!inner(name)\n          )\n        "),g=h?Object.entries(h.reduce((e,s)=>{var t,a;const r=(null==(a=null==(t=s.users)?void 0:t.roles)?void 0:a.name)||"Unknown";return e[r]||(e[r]={total:0,passed:0}),e[r].total++,s.is_passed&&e[r].passed++,e},{})).map(([e,s])=>({name:e,value:s.passed,total:s.total,percentage:s.total>0?s.passed/s.total*100:0})):[],{data:j,error:y}=await $.from("test_results").select("\n          is_passed,\n          surveys!inner(title)\n        "),f=j?Object.entries(j.reduce((e,s)=>{var t;const a=(null==(t=s.surveys)?void 0:t.title)||"Unknown";return e[a]||(e[a]={total:0,passed:0}),e[a].total++,s.is_passed&&e[a].passed++,e},{})).map(([e,s])=>({name:e,value:s.passed,total:s.total,percentage:s.total>0?s.passed/s.total*100:0})):[],v=[{month:"Jan",attempts:r?Math.floor(.3*r):0,passed:d?Math.floor(.3*d):0,failed:0,passRate:o},{month:"Feb",attempts:r?Math.floor(.35*r):0,passed:d?Math.floor(.35*d):0,failed:0,passRate:o},{month:"Mar",attempts:r?Math.floor(.35*r):0,passed:d?Math.floor(.35*d):0,failed:0,passRate:o}];return{success:!0,data:{totalUsers:e||0,totalSurveys:t||0,totalAttempts:r||0,averageScore:c,passRate:o,recentActivity:u,performanceByRole:g,performanceBySurvey:f,monthlyTrends:v},message:"Dashboard data retrieved successfully"}}catch(e){return this.handleError(e)}}},ee=new class extends Y{async getDashboardData(){try{if(Z)return{success:!1,message:"Enumerator dashboard not available in demo mode"};const{data:{user:e}}=await B.auth.getUser();if(!e)throw new Error("User not authenticated");const{data:s,error:t}=await B.from("users").select("*").eq("id",e.id).single();if(t||!s)throw new Error("User profile not found");const{data:a,error:r}=await B.from("surveys").select("*").eq("is_active",!0);if(r)throw r;const l=(a||[]).filter(e=>{const t=e.assigned_zones||[],a=e.assigned_regions||[];if(0===t.length&&0===a.length)return!0;const r=0===t.length||t.includes(s.zone),l=0===a.length||a.includes(s.region);return r&&l}),{data:i,error:n}=await B.from("test_results").select("\n          *,\n          survey:surveys(title)\n        ").eq("user_id",e.id).order("completed_at",{ascending:!1});if(n)throw n;const{data:c,error:d}=await B.from("certificates").select("\n          *,\n          survey:surveys(title),\n          user:users(name, email, role:roles(name))\n        ").eq("user_id",e.id).order("issued_at",{ascending:!1});if(d)throw d;const o=l.map(e=>{const s=(i||[]).filter(s=>s.survey_id===e.id).length,t=Math.max(0,e.max_attempts-s),a=t>0&&new Date(e.target_date)>=new Date;return{surveyId:e.id,title:e.title,description:e.description,targetDate:new Date(e.target_date),duration:e.duration,totalQuestions:e.total_questions,passingScore:e.passing_score,attemptsLeft:t,maxAttempts:e.max_attempts,isEligible:a}}),m=(i||[]).map(e=>({resultId:e.id,surveyTitle:e.survey.title,score:e.score,isPassed:e.is_passed,completedAt:new Date(e.completed_at),attemptNumber:e.attempt_number,certificateId:e.certificate_id})),x=o.filter(e=>e.isEligible).map(e=>{const s=Math.ceil((e.targetDate.getTime()-(new Date).getTime())/864e5);return{surveyId:e.surveyId,title:e.title,targetDate:e.targetDate,daysLeft:Math.max(0,s),isOverdue:s<0}}).sort((e,s)=>e.daysLeft-s.daysLeft),u=(c||[]).map(e=>({id:e.id,userId:e.user_id,user:{id:e.user_id,name:e.user.name,email:e.user.email,role:e.user.role},surveyId:e.survey_id,survey:{id:e.survey_id,title:e.survey.title},resultId:e.result_id,certificateNumber:e.certificate_number,issuedAt:new Date(e.issued_at),validUntil:e.valid_until?new Date(e.valid_until):void 0,downloadCount:e.download_count,status:e.certificate_status})),h=m.filter(e=>e.isPassed).length,p=m.length>0?m.reduce((e,s)=>e+s.score,0)/m.length:0,g=o.length>0?m.length/o.length*100:0;return{success:!0,message:"Dashboard data fetched successfully",data:{availableTests:o,completedTests:m,upcomingTests:x,certificates:u,overallProgress:g,averageScore:p,totalAttempts:m.length,passedTests:h}}}catch(e){return this.handleError(e)}}},se=new class extends Y{async getDashboardData(e){try{if(Z)return{success:!1,message:"Supervisor dashboard not available in demo mode"};const{count:e}=await $.from("users").select("*",{count:"exact",head:!0});return{success:!0,message:"Supervisor dashboard data fetched successfully",data:{totalUsers:e||0,totalSurveys:0,totalAttempts:0,averageScore:0,passRate:0,recentActivity:[],performanceByRole:[],performanceBySurvey:[],monthlyTrends:[],totalEnumerators:0,teamPerformance:[],enumeratorStatus:[],upcomingDeadlines:[]}}}catch(s){return this.handleError(s)}}},te=new class extends Y{async getDashboardData(e){try{if(Z)return{success:!1,message:"RO dashboard not available in demo mode"};return{success:!0,message:"RO dashboard data fetched successfully",data:{totalUsers:0,totalSurveys:0,totalAttempts:0,averageScore:0,passRate:0,recentActivity:[],performanceByRole:[],performanceBySurvey:[],monthlyTrends:[],totalDistricts:0,totalSupervisors:0,districtPerformance:[],supervisorPerformance:[],enumeratorDistribution:[]}}}catch(s){return this.handleError(s)}}},ae=new class extends Y{async getDashboardData(e){try{if(Z)return{success:!1,message:"ZO dashboard not available in demo mode"};return{success:!0,message:"ZO dashboard data fetched successfully",data:{totalUsers:0,totalSurveys:0,totalAttempts:0,averageScore:0,passRate:0,recentActivity:[],performanceByRole:[],performanceBySurvey:[],monthlyTrends:[],totalZones:0,totalRegions:0,zonePerformance:[],regionalBreakdown:[],topPerformingRegions:[],lowPerformingRegions:[]}}}catch(s){return this.handleError(s)}}},re=new class extends Y{async getResults(e){try{if(!B)return{success:!1,message:"Database not configured",data:[]};const{data:e,error:s}=await B.from("test_results").select("\n          *,\n          user:users(\n            id,\n            name,\n            email,\n            role:roles(\n              id,\n              name,\n              level\n            )\n          ),\n          survey:surveys(\n            id,\n            title,\n            max_attempts\n          )\n        ").order("completed_at",{ascending:!1});if(s)return{success:!1,message:s.message,data:[]};if(!e||0===e.length)return{success:!0,data:[],message:"No test results found"};const t=[...new Set(e.map(e=>e.user_id))],a=[...new Set(e.map(e=>e.survey_id))],{data:r,error:l}=await B.from("users").select("id, name, email, role_id, roles(name)").in("id",t),{data:i,error:n}=await B.from("surveys").select("id, title, max_attempts").in("id",a),c=new Map((null==r?void 0:r.map(e=>[e.id,e]))||[]),d=new Map((null==i?void 0:i.map(e=>[e.id,e]))||[]);return{success:!0,data:e.map(e=>{var s;const t=c.get(e.user_id),a=d.get(e.survey_id);return{id:e.id,userId:e.user_id,user:t?{id:t.id,name:t.name,email:t.email,role:{name:(null==(s=t.roles)?void 0:s.name)||"Unknown Role"}}:{id:e.user_id,name:"Unknown User",email:"unknown@example.com",role:{name:"Unknown Role"}},surveyId:e.survey_id,survey:a?{id:a.id,title:a.title,maxAttempts:a.max_attempts}:{id:e.survey_id,title:"Unknown Survey",maxAttempts:3},sessionId:e.session_id,score:e.score,totalQuestions:e.total_questions,correctAnswers:e.correct_answers,isPassed:e.is_passed,timeSpent:e.time_spent,attemptNumber:e.attempt_number,grade:e.grade,completedAt:new Date(e.completed_at),certificateId:e.certificate_id,sectionScores:[]}}),message:"Results fetched successfully"}}catch(s){return{success:!1,message:"Failed to fetch results",data:[]}}}async getAnalytics(e){try{if(!B)return{success:!1,message:"Database not configured",data:{}};const{data:e,error:s}=await B.from("test_results").select("*");if(s)return{success:!1,message:s.message,data:{}};const t=(null==e?void 0:e.length)||0,a=(null==e?void 0:e.filter(e=>e.is_passed).length)||0,r=t>0?a/t*100:0,l=t>0?e.reduce((e,s)=>e+s.score,0)/t:0,i=t>0?e.reduce((e,s)=>e+s.time_spent/60,0)/t:0,{data:n,error:c}=await B.from("test_results").select("\n          is_passed,\n          user:users(\n            role:roles(name)\n          )\n        "),d=n?Object.entries(n.reduce((e,s)=>{var t,a;const r=(null==(a=null==(t=s.user)?void 0:t.role)?void 0:a.name)||"Unknown";return e[r]||(e[r]={total:0,passed:0}),e[r].total++,s.is_passed&&e[r].passed++,e},{})).map(([e,s])=>({name:e,value:s.passed,total:s.total,percentage:s.total>0?s.passed/s.total*100:0})):[],{data:o,error:m}=await B.from("test_results").select("\n          is_passed,\n          survey:surveys(title)\n        "),x=o?Object.entries(o.reduce((e,s)=>{var t;const a=(null==(t=s.survey)?void 0:t.title)||"Unknown Survey";return e[a]||(e[a]={total:0,passed:0}),e[a].total++,s.is_passed&&e[a].passed++,e},{})).map(([e,s])=>({name:e,value:s.passed,total:s.total,percentage:s.total>0?s.passed/s.total*100:0})):[],{data:u,error:h}=await B.from("test_results").select("\n          score,\n          is_passed,\n          user:users(id, name)\n        "),p=u?Object.entries(u.reduce((e,s)=>{var t,a;const r=null==(t=s.user)?void 0:t.id,l=(null==(a=s.user)?void 0:a.name)||"Unknown User";return r?(e[r]||(e[r]={userName:l,totalAttempts:0,totalScore:0,passed:0}),e[r].totalAttempts++,e[r].totalScore+=s.score,s.is_passed&&e[r].passed++,e):e},{})).map(([e,s])=>({userId:e,userName:s.userName,averageScore:s.totalAttempts>0?s.totalScore/s.totalAttempts:0,totalAttempts:s.totalAttempts,passRate:s.totalAttempts>0?s.passed/s.totalAttempts*100:0})):[],g=p.sort((e,s)=>s.averageScore-e.averageScore).slice(0,5),j=p.sort((e,s)=>e.averageScore-s.averageScore).slice(0,5);return{success:!0,data:{overview:{totalAttempts:t,passRate:r,averageScore:l,averageTime:i},performanceByRole:d,performanceBySurvey:x,performanceByJurisdiction:[],timeSeriesData:[],topPerformers:g,lowPerformers:j},message:"Analytics fetched successfully"}}catch(s){return{success:!1,message:"Failed to fetch analytics",data:{}}}}async exportResults(e){try{if(Z)return{success:!1,message:"Export not available in demo mode"};return{success:!0,message:"Results exported successfully",data:new Blob(["Name,Email,Survey,Score,Status,Date\n"],{type:"text/csv"})}}catch(s){return this.handleError(s)}}},le=new class extends Y{async getCertificates(){try{if(Z)return{success:!1,message:"Certificates not available in demo mode"};const{data:e,error:s}=await B.from("certificates").select("\n          *,\n          user:users(name, email, role:roles(name)),\n          survey:surveys(title)\n        ").order("issued_at",{ascending:!1});if(s)throw s;return{success:!0,message:"Certificates fetched successfully",data:(e||[]).map(e=>({id:e.id,userId:e.user_id,user:{id:e.user_id,name:e.user.name,email:e.user.email,role:e.user.role},surveyId:e.survey_id,survey:{id:e.survey_id,title:e.survey.title},resultId:e.result_id,certificateNumber:e.certificate_number,issuedAt:new Date(e.issued_at),validUntil:e.valid_until?new Date(e.valid_until):void 0,downloadCount:e.download_count,status:e.certificate_status}))}}catch(e){return this.handleError(e)}}async downloadCertificate(e){try{if(Z)return{success:!1,message:"Certificate download not available in demo mode"};const s=`Certificate ${e}`,t=new Blob([s],{type:"application/pdf"});return await B.from("certificates").update({download_count:B.raw("download_count + 1")}).eq("id",e),{success:!0,message:"Certificate downloaded successfully",data:t}}catch(s){return this.handleError(s)}}async revokeCertificate(e){try{if(Z)return{success:!1,message:"Certificate revocation not available in demo mode"};const{error:s}=await B.from("certificates").update({certificate_status:"revoked"}).eq("id",e);if(s)throw s;return{success:!0,message:"Certificate revoked successfully"}}catch(s){return this.handleError(s)}}},ie=new class extends Y{async getSettings(){try{if(Z)return{success:!1,message:"Settings not available in demo mode"};const{data:e,error:s}=await B.from("system_settings").select("*").order("category",{ascending:!0});if(s)throw s;return{success:!0,message:"Settings fetched successfully",data:(e||[]).map(e=>({id:e.id,category:e.category,key:e.setting_key,value:e.setting_value,description:e.description,type:e.setting_type,isEditable:e.is_editable,options:e.options,updatedAt:new Date(e.updated_at),updatedBy:e.updated_by}))}}catch(e){return this.handleError(e)}}async updateSetting(e,s){try{if(Z)return{success:!1,message:"Setting updates not available in demo mode"};const{error:t}=await B.from("system_settings").update({setting_value:s,updated_at:(new Date).toISOString()}).eq("id",e);if(t)throw t;return{success:!0,message:"Setting updated successfully"}}catch(t){return this.handleError(t)}}};
/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */
var ne={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};
/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=(s,t)=>{const a=e.forwardRef(({color:a="currentColor",size:r=24,strokeWidth:l=2,absoluteStrokeWidth:i,className:n="",children:c,...d},o)=>{return e.createElement("svg",{ref:o,...ne,width:r,height:r,stroke:a,strokeWidth:i?24*Number(l)/Number(r):l,className:["lucide",`lucide-${m=s,m.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim()}`,n].join(" "),...d},[...t.map(([s,t])=>e.createElement(s,t)),...Array.isArray(c)?c:[c]]);var m});return a.displayName=`${s}`,a},de=ce("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]),oe=ce("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),me=ce("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]),xe=ce("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]),ue=ce("Award",[["circle",{cx:"12",cy:"8",r:"6",key:"1vp47v"}],["path",{d:"M15.477 12.89 17 22l-5-3-5 3 1.523-9.11",key:"em7aur"}]]),he=ce("BarChart3",[["path",{d:"M3 3v18h18",key:"1s2lah"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]),pe=ce("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]),ge=ce("BookOpen",[["path",{d:"M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z",key:"vv98re"}],["path",{d:"M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z",key:"1cyq3y"}]]),je=ce("Book",[["path",{d:"M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H20v20H6.5a2.5 2.5 0 0 1 0-5H20",key:"t4utmx"}]]),ye=ce("Building",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",ry:"2",key:"76otgf"}],["path",{d:"M9 22v-4h6v4",key:"r93iot"}],["path",{d:"M8 6h.01",key:"1dz90k"}],["path",{d:"M16 6h.01",key:"1x0f13"}],["path",{d:"M12 6h.01",key:"1vi96p"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M8 14h.01",key:"6423bh"}]]),fe=ce("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]),ve=ce("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]),be=ce("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]),Ne=ce("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]),we=ce("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]),_e=ce("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),Se=ce("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]),Ce=ce("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]),ke=ce("Flag",[["path",{d:"M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z",key:"i9b6wo"}],["line",{x1:"4",x2:"4",y1:"22",y2:"15",key:"1cm3nv"}]]),Ae=ce("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]),Ee=ce("HelpCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),De=ce("Home",[["path",{d:"m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"y5dka4"}],["polyline",{points:"9 22 9 12 15 12 15 22",key:"e2us08"}]]),Re=ce("LayoutDashboard",[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]]),Te=ce("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]),Ie=ce("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]),Pe=ce("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]),Oe=ce("MapPin",[["path",{d:"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z",key:"2oe9fu"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]),Le=ce("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]),qe=ce("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]),Me=ce("Pause",[["rect",{width:"4",height:"16",x:"6",y:"4",key:"iffhe4"}],["rect",{width:"4",height:"16",x:"14",y:"4",key:"sjin7j"}]]),Ue=ce("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]),Fe=ce("Play",[["polygon",{points:"5 3 19 12 5 21 5 3",key:"191637"}]]),ze=ce("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]),Be=ce("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]),$e=ce("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]),Ze=ce("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]),Qe=ce("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]),Ye=ce("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),Ve=ce("Shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]),Ke=ce("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a2.121 2.121 0 1 1 3 3L12 15l-4 1 1-4Z",key:"1lpok0"}]]),We=ce("Star",[["polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2",key:"8f66p6"}]]),He=ce("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]),Ge=ce("Timer",[["line",{x1:"10",x2:"14",y1:"2",y2:"2",key:"14vaq8"}],["line",{x1:"12",x2:"15",y1:"14",y2:"11",key:"17fdiu"}],["circle",{cx:"12",cy:"14",r:"8",key:"1e1u0o"}]]),Xe=ce("ToggleLeft",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"6",ry:"6",key:"f2vt7d"}],["circle",{cx:"8",cy:"12",r:"2",key:"1nvbw3"}]]),Je=ce("ToggleRight",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"6",ry:"6",key:"f2vt7d"}],["circle",{cx:"16",cy:"12",r:"2",key:"4ma0v8"}]]),es=ce("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]),ss=ce("TrendingDown",[["polyline",{points:"22 17 13.5 8.5 8.5 13.5 2 7",key:"1r2t7k"}],["polyline",{points:"16 17 22 17 22 11",key:"11uiuu"}]]),ts=ce("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]),as=ce("Trophy",[["path",{d:"M6 9H4.5a2.5 2.5 0 0 1 0-5H6",key:"17hqa7"}],["path",{d:"M18 9h1.5a2.5 2.5 0 0 0 0-5H18",key:"lmptdp"}],["path",{d:"M4 22h16",key:"57wxv0"}],["path",{d:"M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22",key:"1nw9bq"}],["path",{d:"M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22",key:"1np0yb"}],["path",{d:"M18 2H6v7a6 6 0 0 0 12 0V2Z",key:"u46fv3"}]]),rs=ce("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]),ls=ce("UserCheck",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]]),is=ce("UserX",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]]),ns=ce("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]),cs=ce("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]),ds=ce("WifiOff",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}],["path",{d:"M5 12.859a10 10 0 0 1 5.17-2.69",key:"1dl1wf"}],["path",{d:"M19 12.859a10 10 0 0 0-2.007-1.523",key:"4k23kn"}],["path",{d:"M2 8.82a15 15 0 0 1 4.177-2.643",key:"1grhjp"}],["path",{d:"M22 8.82a15 15 0 0 0-11.288-3.764",key:"z3jwby"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]),os=ce("Wifi",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["path",{d:"M5 12.859a10 10 0 0 1 14 0",key:"1x1e6c"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}]]),ms=ce("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]),xs=ce("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);function us({isOpen:e,onClose:s,title:t,children:a,size:r="md"}){if(!e)return null;return L.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:L.jsxs("div",{className:"flex items-center justify-center min-h-screen px-4 pt-4 pb-20 text-center sm:block sm:p-0",children:[L.jsx("div",{className:"fixed inset-0 transition-opacity bg-gray-500 bg-opacity-75",onClick:s}),L.jsx("span",{className:"hidden sm:inline-block sm:align-middle sm:h-screen",children:"​"}),L.jsxs("div",{className:`inline-block w-full ${{sm:"max-w-md",md:"max-w-lg",lg:"max-w-2xl",xl:"max-w-4xl"}[r]} p-6 my-8 overflow-hidden text-left align-middle transition-all transform bg-white shadow-xl rounded-lg`,children:[L.jsxs("div",{className:"flex items-center justify-between mb-4",children:[L.jsx("h3",{className:"text-lg font-medium text-gray-900",children:t}),L.jsx("button",{onClick:s,className:"text-gray-400 hover:text-gray-600 transition-colors",children:L.jsx(xs,{className:"w-5 h-5"})})]}),a]})]})})}class hs{static logError(e,s){}static logWarning(e,s){}static logInfo(e,s){}static handleApiError(e,s){return this.logError(e,`API ${s}`),(null==e?void 0:e.message)?e.message:404===(null==e?void 0:e.status)?"Resource not found":403===(null==e?void 0:e.status)?"Access denied":401===(null==e?void 0:e.status)?"Authentication required":(null==e?void 0:e.status)>=500?"Server error. Please try again later.":"An unexpected error occurred. Please try again."}static suppressConsoleWarnings(){const e=console.warn,s=console.error;console.warn=(...s)=>{const t=s.join(" ");t.includes("Tracking Prevention blocked access to storage")||t.includes("Access to fetch at")&&(t.includes("appsignal-endpoint.net")||t.includes("googleads.g.doubleclick.net")||t.includes("connect.facebook.net")||t.includes("static.ads-twitter.com")||t.includes("track.hubspot.com"))||e.apply(console,s)},console.error=(...e)=>{const t=e.join(" ");t.includes("Failed to load resource")&&(t.includes("net::ERR_SSL_PROTOCOL_ERROR")||t.includes("net::ERR_FAILED"))||s.apply(console,e)}}}function ps(...e){return r(l(e))}function gs(e){return new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})}function js(e){return new Date(e).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}function ys(e){const s=Math.floor(e/60),t=e%60;return s>0?`${s}h ${t}m`:`${t}m`}function fs(e){const s=e%60;return`${Math.floor(e/60).toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}`}function vs(e){return e>=80?"text-green-600":e>=60?"text-yellow-600":"text-red-600"}function bs({children:e,variant:s="primary",size:t="md",disabled:a=!1,loading:r=!1,onClick:l,type:i="button",className:n}){return L.jsxs("button",{type:i,onClick:e=>{"submit"!==i&&e.preventDefault(),a||r||!l||l()},disabled:a||r,className:ps("inline-flex items-center justify-center font-medium rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed",{primary:"bg-blue-600 text-white hover:bg-blue-700 focus:ring-blue-500",secondary:"bg-gray-200 text-gray-900 hover:bg-gray-300 focus:ring-gray-500",success:"bg-green-600 text-white hover:bg-green-700 focus:ring-green-500",danger:"bg-red-600 text-white hover:bg-red-700 focus:ring-red-500",warning:"bg-yellow-600 text-white hover:bg-yellow-700 focus:ring-yellow-500"}[s],{sm:"px-3 py-1.5 text-sm",md:"px-4 py-2 text-sm",lg:"px-6 py-3 text-base"}[t],n),children:[r&&L.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),e]})}hs.suppressConsoleWarnings();const Ns=e.forwardRef(({label:e,error:s,helperText:t,className:a,...r},l)=>L.jsxs("div",{className:"space-y-1",children:[e&&L.jsx("label",{className:"block text-sm font-medium text-gray-700",children:e}),L.jsx("input",{ref:l,className:ps("block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",s&&"border-red-300 focus:ring-red-500 focus:border-red-500",a),...r}),s&&L.jsx("p",{className:"text-sm text-red-600",children:s}),t&&!s&&L.jsx("p",{className:"text-sm text-gray-500",children:t})]}));Ns.displayName="Input";const ws=e.createContext(void 0);function _s(){const s=e.useContext(ws);if(void 0===s)throw new Error("useAuth must be used within an AuthProvider");return s}function Ss({children:s}){const[t,a]=e.useState(null),[r,l]=e.useState(!0),[i,n]=e.useState(!1),[c,d]=e.useState({currentPassword:"",newPassword:"",confirmPassword:""}),[o,m]=e.useState(""),[x,u]=e.useState(!1),h=e.useCallback(async()=>{try{if(B)try{const{data:{session:s},error:t}=await B.auth.getSession();if(t){0;try{await B.auth.signOut()}catch(e){}return a(null),void l(!1)}if(s&&s.user&&!t){const{data:e,error:t}=await B.from("users").select("\n                *,\n                role:roles(*)\n              ").eq("id",s.user.id).maybeSingle();if(e&&!t){const s={id:e.id,name:e.name,email:e.email,role:e.role,jurisdiction:e.jurisdiction,isActive:e.is_active,createdAt:new Date(e.created_at),updatedAt:new Date(e.updated_at)};return a(s),void l(!1)}}}catch(s){0;try{await B.auth.signOut()}catch(e){}}}catch(t){}a(null),l(!1)},[]);e.useEffect(()=>{h()},[h]),e.useEffect(()=>{if(B){const{data:{subscription:e}}=B.auth.onAuthStateChange(async(e,s)=>{"SIGNED_OUT"!==e&&s||a(null)});return()=>e.unsubscribe()}},[]);const p={user:t,isLoading:r,login:async(e,s)=>{try{0;const t=await V.login(e,s);if(t.success&&t.data){const{user:e,token:s,session:a}=t.data;0;return await h(),{success:!0,message:t.message}}return{success:!1,message:t.message}}catch(t){return{success:!1,message:"Login failed. Please try again."}}},logout:async()=>{try{B&&await B.auth.signOut();try{await V.logout()}catch(e){}}catch(s){}finally{a(null)}},isAuthenticated:!!t};return L.jsxs(ws.Provider,{value:p,children:[s,L.jsx(us,{isOpen:i,onClose:()=>{},title:"Change Your Password",size:"md",children:L.jsxs("div",{className:"space-y-6",children:[L.jsxs("div",{className:"text-center",children:[L.jsx("div",{className:"w-16 h-16 bg-yellow-100 rounded-full flex items-center justify-center mx-auto mb-4",children:L.jsx(Te,{className:"w-8 h-8 text-yellow-600"})}),L.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"First Login - Change Password"}),L.jsx("p",{className:"text-gray-600",children:"For security reasons, please change your default password before continuing."})]}),o&&L.jsxs("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg flex items-center space-x-2",children:[L.jsx(de,{className:"w-5 h-5 text-red-600 flex-shrink-0"}),L.jsx("p",{className:"text-red-700 text-sm",children:o})]}),L.jsxs("div",{className:"space-y-4",children:[L.jsx(Ns,{label:"Current Password",type:"password",value:c.currentPassword,onChange:e=>d({...c,currentPassword:e.target.value}),placeholder:"Enter your current password"}),L.jsx(Ns,{label:"New Password",type:"password",value:c.newPassword,onChange:e=>d({...c,newPassword:e.target.value}),placeholder:"Enter your new password (min 6 characters)"}),L.jsx(Ns,{label:"Confirm New Password",type:"password",value:c.confirmPassword,onChange:e=>d({...c,confirmPassword:e.target.value}),placeholder:"Confirm your new password"}),L.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[L.jsx("h4",{className:"font-medium text-blue-900 mb-2",children:"Password Requirements"}),L.jsxs("ul",{className:"text-sm text-blue-800 space-y-1",children:[L.jsx("li",{children:"• At least 6 characters long"}),L.jsx("li",{children:"• Different from your current password"}),L.jsx("li",{children:"• Use a combination of letters, numbers, and symbols for better security"})]})]})]}),L.jsxs("div",{className:"flex justify-between space-x-3 pt-4 border-t",children:[L.jsx(bs,{variant:"secondary",onClick:()=>{window.confirm("Are you sure you want to skip changing your password? It is recommended to change your default password for security.")&&(n(!1),d({currentPassword:"",newPassword:"",confirmPassword:""}))},disabled:x,children:"Skip for Now"}),L.jsxs(bs,{onClick:async()=>{if(m(""),c.currentPassword)if(c.newPassword)if(c.newPassword.length<6)m("New password must be at least 6 characters long");else if(c.newPassword===c.confirmPassword)if(c.currentPassword!==c.newPassword)try{u(!0);const e=await V.changePassword(c.currentPassword,c.newPassword);e.success?(n(!1),d({currentPassword:"",newPassword:"",confirmPassword:""}),alert("Password changed successfully! Please remember your new password.")):m(e.message)}catch(e){m("Failed to change password. Please try again.")}finally{u(!1)}else m("New password must be different from current password");else m("New passwords do not match");else m("New password is required");else m("Current password is required")},loading:x,disabled:x,className:"flex items-center space-x-2",children:[L.jsx(Te,{className:"w-4 h-4"}),L.jsx("span",{children:"Change Password"})]})]})]})})]})}const Cs=e.createContext(void 0);function ks({children:s}){const[t,a]=e.useState(navigator.onLine),[r,l]=e.useState(null),[i,n]=e.useState(!1);e.useEffect(()=>{const e=()=>{a(!0),c()},s=()=>{a(!1)},t=()=>{try{const e=localStorage.getItem("pending_saves");n(!!e&&JSON.parse(e).length>0);const s=localStorage.getItem("last_sync");s&&l(new Date(parseInt(s)))}catch(e){}};window.addEventListener("online",e),window.addEventListener("offline",s),t();const r=setInterval(t,1e4);return()=>{window.removeEventListener("online",e),window.removeEventListener("offline",s),clearInterval(r)}},[]);const c=async()=>{if(t)try{await X.syncOfflineData(),n(!1),l(new Date)}catch(e){}},d={isOnline:t,lastSynced:r,hasPendingChanges:i,syncData:c};return L.jsx(Cs.Provider,{value:d,children:s})}function As({children:e,className:s,padding:t="md",onClick:a}){return L.jsx("div",{className:ps("bg-white rounded-lg border border-gray-200 shadow-sm",a&&"cursor-pointer hover:shadow-md transition-shadow",{none:"",sm:"p-4",md:"p-6",lg:"p-8"}[t],s),onClick:a,children:e})}class Es extends e.Component{constructor(e){super(e),this.handleReload=()=>{window.location.reload()},this.handleGoHome=()=>{window.location.href="/"},this.state={hasError:!1}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,s){this.setState({error:e,errorInfo:s})}render(){return this.state.hasError?L.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center px-4",children:L.jsx(As,{className:"max-w-lg w-full text-center",children:L.jsxs("div",{className:"p-8",children:[L.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-6",children:L.jsx(oe,{className:"w-8 h-8 text-red-600"})}),L.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Something went wrong"}),L.jsx("p",{className:"text-gray-600 mb-6",children:"We encountered an unexpected error. Please try refreshing the page or return to the home page."}),L.jsxs("div",{className:"space-y-3",children:[L.jsxs(bs,{onClick:this.handleReload,className:"w-full flex items-center justify-center space-x-2",children:[L.jsx(Be,{className:"w-4 h-4"}),L.jsx("span",{children:"Reload Page"})]}),L.jsxs(bs,{variant:"secondary",onClick:this.handleGoHome,className:"w-full flex items-center justify-center space-x-2",children:[L.jsx(De,{className:"w-4 h-4"}),L.jsx("span",{children:"Go to Home"})]})]}),!1]})})}):this.props.children}}async function Ds(){try{const e=["roles","users","surveys","survey_sections","questions","question_options","system_settings"];for(const s of e)await B.rpc("exec_sql",{sql:`ALTER TABLE ${s} ENABLE ROW LEVEL SECURITY;`}).catch(()=>{})}catch(e){}}class Rs{static async initializeDatabase(){try{if(Z)return{success:!1,message:"Cannot initialize database in demo mode. Please configure Supabase first:\n\n1. Create a Supabase project at https://supabase.com\n2. Get your project URL and API keys from Settings → API\n3. Update the .env file with your actual credentials\n4. Restart the development server\n5. Try initialization again"};await async function(){try{const e=["roles","users","surveys","survey_sections","questions","question_options","system_settings"];for(const s of e)await B.rpc("exec_sql",{sql:`ALTER TABLE ${s} DISABLE ROW LEVEL SECURITY;`}).catch(()=>{})}catch(e){}}();try{const{data:e,error:s}=await $.auth.admin.listUsers({page:1,perPage:1});if(s)return{success:!1,message:`Admin client authentication failed: ${s.message}. Please check your VITE_SUPABASE_SERVICE_ROLE_KEY in .env file.`};0}catch(e){return await Ds(),{success:!1,message:"Failed to authenticate with Supabase admin client. Please verify your service role key."}}0,await this.cleanupExistingData(B,$);const{data:s,error:t}=await B.from("roles").select("id").limit(1);if(t)return{success:!1,message:`Failed to connect to database: ${t.message}. Please check your Supabase configuration.`,error:t};try{const e=await fetch("/supabase/migrations/create_comprehensive_schema.sql");if(e.ok){const s=await e.text(),{error:t}=await $.rpc("exec_sql",{sql:s})}}catch(e){}await this.createRoles($),await this.createUsers($);const a=await this.verifyUserCreation($);return await this.createSurveys($,a),await this.createSurveySections($),await this.createQuestions($),await this.createSystemSettings($),await this.createRLSPolicies(supabaseAdminClient),await Ds(),{success:!0,message:"Database initialized successfully with demo users and sample data!"}}catch(e){return await Ds(),{success:!1,message:`Failed to initialize database: ${e instanceof Error?e.message:"Unknown error"}`,error:e}}}static async cleanupExistingData(e,s){try{try{const{error:e}=await s.rpc("exec_sql",{sql:"\n            DO $$ \n            DECLARE\n                r RECORD;\n            BEGIN\n                FOR r IN (SELECT schemaname, tablename FROM pg_tables WHERE schemaname = 'public') LOOP\n                    EXECUTE 'DROP POLICY IF EXISTS ' || quote_ident('policy_' || r.tablename) || ' ON ' || quote_ident(r.schemaname) || '.' || quote_ident(r.tablename);\n                END LOOP;\n            END $$;\n          "})}catch(t){}await s.from("test_answers").delete().gte("created_at","1900-01-01"),await s.from("section_scores").delete().gte("created_at","1900-01-01"),await s.from("certificates").delete().gte("created_at","1900-01-01"),await s.from("test_results").delete().gte("created_at","1900-01-01"),await s.from("test_sessions").delete().gte("created_at","1900-01-01"),await s.from("activity_logs").delete().gte("created_at","1900-01-01"),await s.from("question_options").delete().gte("created_at","1900-01-01"),await s.from("questions").delete().gte("created_at","1900-01-01"),await s.from("survey_sections").delete().gte("created_at","1900-01-01"),await s.from("surveys").delete().gte("created_at","1900-01-01"),await s.from("system_settings").delete().gte("updated_at","1900-01-01"),await s.from("users").delete().gte("created_at","1900-01-01"),await s.from("roles").delete().gte("created_at","1900-01-01");const{data:e}=await s.auth.admin.listUsers();if(e&&e.users)for(const t of e.users)t.email&&!t.email.includes("supabase")&&await s.auth.admin.deleteUser(t.id)}catch(t){}}static async verifyUserCreation(e){const s=["admin@esigma.com","enumerator@esigma.com"];let t=null;for(const r of s)try{const{data:e,error:s}=await B.auth.signInWithPassword({email:r,password:"password123"});if(s)throw new Error(`User ${r} cannot authenticate: ${s.message}`);"admin@esigma.com"===r&&(t=e.user.id),await B.auth.signOut()}catch(a){throw a}return t}static async createRoles(e){const{error:s}=await e.from("roles").insert([{id:"550e8400-e29b-41d4-a716-446655440001",name:"Administrator",description:"System Administrator with full access to all features",level:1,is_active:!0,menu_access:["/dashboard","/users","/roles","/role-menu-management","/surveys","/questions","/results","/enumerator-status","/certificates","/settings"]},{id:"550e8400-e29b-41d4-a716-446655440002",name:"CPG User",description:"Central Planning Group User with national oversight",level:2,is_active:!0,menu_access:["/cpg-dashboard","/results","/enumerator-status","/certificates"]},{id:"550e8400-e29b-41d4-a716-446655440003",name:"ZO User",description:"Zonal Office User with zone-level management access",level:3,is_active:!0,menu_access:["/zo-dashboard","/results","/enumerator-status","/certificates"]},{id:"550e8400-e29b-41d4-a716-446655440004",name:"RO User",description:"Regional Office User with regional management access",level:4,is_active:!0,menu_access:["/ro-dashboard","/results","/enumerator-status","/certificates"]},{id:"550e8400-e29b-41d4-a716-446655440005",name:"Supervisor",description:"Field Supervisor with team management capabilities",level:5,is_active:!0,menu_access:["/supervisor-dashboard","/team-results","/my-enumerators","/enumerator-status","/certificates"]},{id:"550e8400-e29b-41d4-a716-446655440006",name:"Enumerator",description:"Field Enumerator with test-taking access (Lowest Level)",level:6,is_active:!0,menu_access:["/enumerator-dashboard","/available-tests","/my-results","/my-certificates","/test-schedule"]}]);if(s)throw s}static async createUsers(e){const s=[{email:"admin@esigma.com",password:"password123",name:"System Administrator",role_id:"550e8400-e29b-41d4-a716-446655440001",is_active:!0,jurisdiction:"National",zone:null,region:null,district:null,employee_id:"ADM001",phone_number:"+91-9876543210"},{email:"zo@esigma.com",password:"password123",name:"Zonal Officer",role_id:"550e8400-e29b-41d4-a716-446655440003",is_active:!0,jurisdiction:"North Zone",zone:"North Zone",region:null,district:null,employee_id:"ZO001",phone_number:"+91-9876543211"},{email:"ro@esigma.com",password:"password123",name:"Regional Officer",role_id:"550e8400-e29b-41d4-a716-446655440004",is_active:!0,jurisdiction:"Delhi Region",zone:"North Zone",region:"Delhi Region",district:null,employee_id:"RO001",phone_number:"+91-9876543212",parent_id:null},{email:"supervisor@esigma.com",password:"password123",name:"Field Supervisor",role_id:"550e8400-e29b-41d4-a716-446655440005",is_active:!0,jurisdiction:"Central Delhi District",zone:"North Zone",region:"Delhi Region",district:"Central Delhi",employee_id:"SUP001",phone_number:"+91-9876543213",parent_id:null},{email:"enumerator@esigma.com",password:"password123",name:"Field Enumerator",role_id:"550e8400-e29b-41d4-a716-446655440006",is_active:!0,jurisdiction:"Block A, Central Delhi",zone:"North Zone",region:"Delhi Region",district:"Central Delhi",employee_id:"ENU001",phone_number:"+91-9876543214",parent_id:null}];for(const r of s)try{const{data:e,error:s}=await supabaseAdminClient.auth.admin.createUser({email:r.email,password:r.password,email_confirm:!0,user_metadata:{name:r.name},app_metadata:{role:r.role_id}});if(s)throw new Error(`Auth creation failed for ${r.email}: ${s.message}`);if(e.user){const{error:s}=await supabaseAdminClient.auth.admin.updateUserById(e.user.id,{email_confirm:!0})}const t=a.hashSync(r.password,10),{error:l}=await supabaseAdminClient.from("users").insert({id:e.user.id,email:r.email,password_hash:t,name:r.name,role_id:r.role_id,is_active:r.is_active,jurisdiction:r.jurisdiction,zone:r.zone,region:r.region,district:r.district,employee_id:r.employee_id,phone_number:r.phone_number,parent_id:r.parent_id});if(l)throw new Error(`Profile creation failed for ${r.email}: ${l.message}`)}catch(t){throw t}}static async createSurveys(e,s){const t=[{id:"550e8400-e29b-41d4-a716-446655440020",title:"Digital Literacy Assessment",description:"Comprehensive assessment of digital skills and computer literacy for field staff",target_date:new Date(Date.now()+2592e6).toISOString().split("T")[0],duration:35,total_questions:30,passing_score:70,max_attempts:3,is_active:!0,assigned_zones:["North Zone","South Zone","East Zone"],assigned_regions:["Delhi Region","Mumbai Region","Kolkata Region"],created_by:s},{id:"550e8400-e29b-41d4-a716-446655440021",title:"Data Collection Procedures",description:"Assessment of field data collection methods and procedures",target_date:new Date(Date.now()+3888e6).toISOString().split("T")[0],duration:40,total_questions:25,passing_score:75,max_attempts:2,is_active:!0,assigned_zones:["North Zone","South Zone","East Zone"],assigned_regions:["Delhi Region","Mumbai Region","Kolkata Region"],created_by:s},{id:"550e8400-e29b-41d4-a716-446655440022",title:"Survey Methodology Training",description:"Training assessment on survey methodology and best practices",target_date:new Date(Date.now()+5184e6).toISOString().split("T")[0],duration:30,total_questions:20,passing_score:80,max_attempts:3,is_active:!0,assigned_zones:["North Zone","South Zone","East Zone"],assigned_regions:["Delhi Region","Mumbai Region","Kolkata Region"],created_by:s}],{error:a}=await e.from("surveys").insert(t);if(a)throw a}static async createSurveySections(e){const{error:s}=await e.from("survey_sections").insert([{id:"550e8400-e29b-41d4-a716-446655440030",survey_id:"550e8400-e29b-41d4-a716-446655440020",title:"Basic Computer Skills",description:"Fundamental computer operations and software usage",questions_count:2,section_order:1},{id:"550e8400-e29b-41d4-a716-446655440031",survey_id:"550e8400-e29b-41d4-a716-446655440020",title:"Internet and Digital Communication",description:"Web browsing, email, and online communication tools",questions_count:1,section_order:2},{id:"550e8400-e29b-41d4-a716-446655440032",survey_id:"550e8400-e29b-41d4-a716-446655440020",title:"Digital Security and Privacy",description:"Online safety, password management, and privacy protection",questions_count:1,section_order:3},{id:"550e8400-e29b-41d4-a716-446655440033",survey_id:"550e8400-e29b-41d4-a716-446655440021",title:"Field Data Collection",description:"Methods and procedures for collecting data in the field",questions_count:2,section_order:1},{id:"550e8400-e29b-41d4-a716-446655440034",survey_id:"550e8400-e29b-41d4-a716-446655440021",title:"Data Quality Assurance",description:"Ensuring accuracy and completeness of collected data",questions_count:1,section_order:2}]);if(s)throw s}static async createQuestions(e){const{error:s}=await e.from("questions").insert([{id:"550e8400-e29b-41d4-a716-446655440040",section_id:"550e8400-e29b-41d4-a716-446655440030",text:"What is the primary function of an operating system?",question_type:"single_choice",complexity:"easy",points:1,explanation:"An operating system manages all hardware and software resources of a computer.",question_order:1},{id:"550e8400-e29b-41d4-a716-446655440041",section_id:"550e8400-e29b-41d4-a716-446655440030",text:"Which of the following are input devices? (Select all that apply)",question_type:"multiple_choice",complexity:"medium",points:2,explanation:"Input devices allow users to provide data to the computer. Monitor is an output device.",question_order:2},{id:"550e8400-e29b-41d4-a716-446655440042",section_id:"550e8400-e29b-41d4-a716-446655440031",text:"What does URL stand for?",question_type:"single_choice",complexity:"easy",points:1,explanation:"URL stands for Uniform Resource Locator, which is the address of a web page.",question_order:1},{id:"550e8400-e29b-41d4-a716-446655440043",section_id:"550e8400-e29b-41d4-a716-446655440032",text:"Which of the following are good password practices?",question_type:"multiple_choice",complexity:"medium",points:2,explanation:"Strong passwords should be long, complex, unique, and not shared.",question_order:1},{id:"550e8400-e29b-41d4-a716-446655440044",section_id:"550e8400-e29b-41d4-a716-446655440033",text:"What is the first step in field data collection?",question_type:"single_choice",complexity:"easy",points:1,explanation:"Planning and preparation are essential before starting data collection.",question_order:1},{id:"550e8400-e29b-41d4-a716-446655440045",section_id:"550e8400-e29b-41d4-a716-446655440033",text:"Which tools are commonly used for field data collection?",question_type:"multiple_choice",complexity:"medium",points:2,explanation:"Multiple tools can be used for effective field data collection.",question_order:2},{id:"550e8400-e29b-41d4-a716-446655440046",section_id:"550e8400-e29b-41d4-a716-446655440034",text:"What is the primary goal of data quality assurance?",question_type:"single_choice",complexity:"medium",points:1,explanation:"Data quality assurance ensures data accuracy and reliability.",question_order:1}]);if(s)throw s;const{error:t}=await e.from("question_options").insert([{id:"550e8400-e29b-41d4-a716-446655440050",question_id:"550e8400-e29b-41d4-a716-446655440040",text:"To manage hardware and software resources",is_correct:!0,option_order:1},{id:"550e8400-e29b-41d4-a716-446655440051",question_id:"550e8400-e29b-41d4-a716-446655440040",text:"To create documents",is_correct:!1,option_order:2},{id:"550e8400-e29b-41d4-a716-446655440052",question_id:"550e8400-e29b-41d4-a716-446655440040",text:"To browse the internet",is_correct:!1,option_order:3},{id:"550e8400-e29b-41d4-a716-446655440053",question_id:"550e8400-e29b-41d4-a716-446655440040",text:"To play games",is_correct:!1,option_order:4},{id:"550e8400-e29b-41d4-a716-446655440054",question_id:"550e8400-e29b-41d4-a716-446655440041",text:"Keyboard",is_correct:!0,option_order:1},{id:"550e8400-e29b-41d4-a716-446655440055",question_id:"550e8400-e29b-41d4-a716-446655440041",text:"Mouse",is_correct:!0,option_order:2},{id:"550e8400-e29b-41d4-a716-446655440056",question_id:"550e8400-e29b-41d4-a716-446655440041",text:"Monitor",is_correct:!1,option_order:3},{id:"550e8400-e29b-41d4-a716-446655440057",question_id:"550e8400-e29b-41d4-a716-446655440041",text:"Microphone",is_correct:!0,option_order:4},{id:"550e8400-e29b-41d4-a716-446655440058",question_id:"550e8400-e29b-41d4-a716-446655440042",text:"Uniform Resource Locator",is_correct:!0,option_order:1},{id:"550e8400-e29b-41d4-a716-446655440059",question_id:"550e8400-e29b-41d4-a716-446655440042",text:"Universal Resource Link",is_correct:!1,option_order:2},{id:"550e8400-e29b-41d4-a716-446655440060",question_id:"550e8400-e29b-41d4-a716-446655440042",text:"Unified Resource Location",is_correct:!1,option_order:3},{id:"550e8400-e29b-41d4-a716-446655440061",question_id:"550e8400-e29b-41d4-a716-446655440042",text:"Universal Reference Locator",is_correct:!1,option_order:4},{id:"550e8400-e29b-41d4-a716-446655440062",question_id:"550e8400-e29b-41d4-a716-446655440043",text:"Use at least 8 characters",is_correct:!0,option_order:1},{id:"550e8400-e29b-41d4-a716-446655440063",question_id:"550e8400-e29b-41d4-a716-446655440043",text:"Include uppercase and lowercase letters",is_correct:!0,option_order:2},{id:"550e8400-e29b-41d4-a716-446655440064",question_id:"550e8400-e29b-41d4-a716-446655440043",text:"Share passwords with colleagues",is_correct:!1,option_order:3},{id:"550e8400-e29b-41d4-a716-446655440065",question_id:"550e8400-e29b-41d4-a716-446655440043",text:"Use unique passwords for each account",is_correct:!0,option_order:4},{id:"550e8400-e29b-41d4-a716-446655440066",question_id:"550e8400-e29b-41d4-a716-446655440044",text:"Planning and preparation",is_correct:!0,option_order:1},{id:"550e8400-e29b-41d4-a716-446655440067",question_id:"550e8400-e29b-41d4-a716-446655440044",text:"Start collecting immediately",is_correct:!1,option_order:2},{id:"550e8400-e29b-41d4-a716-446655440068",question_id:"550e8400-e29b-41d4-a716-446655440044",text:"Buy equipment first",is_correct:!1,option_order:3},{id:"550e8400-e29b-41d4-a716-446655440069",question_id:"550e8400-e29b-41d4-a716-446655440044",text:"Hire staff first",is_correct:!1,option_order:4},{id:"550e8400-e29b-41d4-a716-446655440070",question_id:"550e8400-e29b-41d4-a716-446655440045",text:"Tablets and smartphones",is_correct:!0,option_order:1},{id:"550e8400-e29b-41d4-a716-446655440071",question_id:"550e8400-e29b-41d4-a716-446655440045",text:"Paper forms",is_correct:!0,option_order:2},{id:"550e8400-e29b-41d4-a716-446655440072",question_id:"550e8400-e29b-41d4-a716-446655440045",text:"GPS devices",is_correct:!0,option_order:3},{id:"550e8400-e29b-41d4-a716-446655440073",question_id:"550e8400-e29b-41d4-a716-446655440045",text:"Gaming consoles",is_correct:!1,option_order:4},{id:"550e8400-e29b-41d4-a716-446655440074",question_id:"550e8400-e29b-41d4-a716-446655440046",text:"Ensure data accuracy and reliability",is_correct:!0,option_order:1},{id:"550e8400-e29b-41d4-a716-446655440075",question_id:"550e8400-e29b-41d4-a716-446655440046",text:"Collect as much data as possible",is_correct:!1,option_order:2},{id:"550e8400-e29b-41d4-a716-446655440076",question_id:"550e8400-e29b-41d4-a716-446655440046",text:"Speed up data collection",is_correct:!1,option_order:3},{id:"550e8400-e29b-41d4-a716-446655440077",question_id:"550e8400-e29b-41d4-a716-446655440046",text:"Reduce data collection costs",is_correct:!1,option_order:4}]);if(t)throw t}static async createSystemSettings(e){const{error:s}=await e.from("system_settings").insert([{category:"security",setting_key:"max_login_attempts",setting_value:"5",description:"Maximum failed login attempts before account lockout",setting_type:"number",is_editable:!0},{category:"security",setting_key:"lockout_duration",setting_value:"30",description:"Account lockout duration in minutes",setting_type:"number",is_editable:!0},{category:"security",setting_key:"session_timeout",setting_value:"120",description:"User session timeout in minutes",setting_type:"number",is_editable:!0},{category:"security",setting_key:"password_min_length",setting_value:"8",description:"Minimum password length requirement",setting_type:"number",is_editable:!0},{category:"security",setting_key:"password_complexity",setting_value:"true",description:"Require complex passwords (uppercase, lowercase, numbers)",setting_type:"boolean",is_editable:!0},{category:"security",setting_key:"force_password_change",setting_value:"90",description:"Force password change every X days",setting_type:"number",is_editable:!0},{category:"test",setting_key:"auto_save_interval",setting_value:"30",description:"Auto-save test progress every X seconds",setting_type:"number",is_editable:!0},{category:"test",setting_key:"enable_auto_save",setting_value:"true",description:"Enable automatic saving of test progress",setting_type:"boolean",is_editable:!0},{category:"test",setting_key:"auto_submit_on_timeout",setting_value:"true",description:"Automatically submit test when time expires",setting_type:"boolean",is_editable:!0},{category:"test",setting_key:"show_time_warning",setting_value:"true",description:"Show warning when 5 minutes remaining",setting_type:"boolean",is_editable:!0},{category:"test",setting_key:"allow_question_navigation",setting_value:"true",description:"Allow users to navigate between questions",setting_type:"boolean",is_editable:!0},{category:"test",setting_key:"enable_question_flagging",setting_value:"true",description:"Allow users to flag questions for review",setting_type:"boolean",is_editable:!0},{category:"test",setting_key:"network_pause_enabled",setting_value:"true",description:"Auto-pause test when network is unavailable",setting_type:"boolean",is_editable:!0},{category:"general",setting_key:"site_name",setting_value:"eSigma Survey Platform",description:"Application name displayed to users",setting_type:"string",is_editable:!0},{category:"general",setting_key:"site_description",setting_value:"Online MCQ Test Management System",description:"Application description",setting_type:"string",is_editable:!0},{category:"general",setting_key:"support_email",setting_value:"support@esigma.com",description:"Support contact email address",setting_type:"email",is_editable:!0},{category:"general",setting_key:"maintenance_mode",setting_value:"false",description:"Enable maintenance mode to restrict access",setting_type:"boolean",is_editable:!0},{category:"general",setting_key:"default_timezone",setting_value:"Asia/Kolkata",description:"Default system timezone",setting_type:"select",is_editable:!0,options:["Asia/Kolkata","UTC","America/New_York","Europe/London"]},{category:"general",setting_key:"date_format",setting_value:"DD/MM/YYYY",description:"Date display format",setting_type:"select",is_editable:!0,options:["DD/MM/YYYY","MM/DD/YYYY","YYYY-MM-DD"]}]);if(s)throw s}static async createRLSPolicies(e){try{await e.rpc("exec_sql",{sql:'\n          ALTER TABLE questions ENABLE ROW LEVEL SECURITY;\n          \n          DROP POLICY IF EXISTS "questions_select_authenticated" ON questions;\n          CREATE POLICY "questions_select_authenticated"\n            ON questions\n            FOR SELECT\n            TO authenticated\n            USING (true);\n          \n          ALTER TABLE question_options ENABLE ROW LEVEL SECURITY;\n          \n          DROP POLICY IF EXISTS "question_options_select_authenticated" ON question_options;\n          CREATE POLICY "question_options_select_authenticated"\n            ON question_options\n            FOR SELECT\n            TO authenticated\n            USING (true);\n          \n          -- Test Results policies\n          ALTER TABLE test_results ENABLE ROW LEVEL SECURITY;\n          \n          DROP POLICY IF EXISTS "test_results_select_own" ON test_results;\n          CREATE POLICY "test_results_select_own"\n            ON test_results\n            FOR SELECT\n            TO authenticated\n            USING (user_id = auth.uid());\n          \n          DROP POLICY IF EXISTS "test_results_insert_own" ON test_results;\n          CREATE POLICY "test_results_insert_own"\n            ON test_results\n            FOR INSERT\n            TO authenticated\n            WITH CHECK (user_id = auth.uid());\n          \n          DROP POLICY IF EXISTS "test_results_update_own" ON test_results;\n          CREATE POLICY "test_results_update_own"\n            ON test_results\n            FOR UPDATE\n            TO authenticated\n            USING (user_id = auth.uid())\n            WITH CHECK (user_id = auth.uid());\n          \n          -- Section Scores policies\n          ALTER TABLE section_scores ENABLE ROW LEVEL SECURITY;\n          \n          DROP POLICY IF EXISTS "section_scores_select_own" ON section_scores;\n          CREATE POLICY "section_scores_select_own"\n            ON section_scores\n            FOR SELECT\n            TO authenticated\n            USING (EXISTS (\n              SELECT 1 FROM test_results \n              WHERE test_results.id = section_scores.result_id \n              AND test_results.user_id = auth.uid()\n            ));\n          \n          DROP POLICY IF EXISTS "section_scores_insert_own" ON section_scores;\n          CREATE POLICY "section_scores_insert_own"\n            ON section_scores\n            FOR INSERT\n            TO authenticated\n            WITH CHECK (EXISTS (\n              SELECT 1 FROM test_results \n              WHERE test_results.id = section_scores.result_id \n              AND test_results.user_id = auth.uid()\n            ));\n          \n          -- Test Sessions policies\n          ALTER TABLE test_sessions ENABLE ROW LEVEL SECURITY;\n          \n          DROP POLICY IF EXISTS "test_sessions_select_own" ON test_sessions;\n          CREATE POLICY "test_sessions_select_own"\n            ON test_sessions\n            FOR SELECT\n            TO authenticated\n            USING (user_id = auth.uid());\n          \n          DROP POLICY IF EXISTS "test_sessions_insert_own" ON test_sessions;\n          CREATE POLICY "test_sessions_insert_own"\n            ON test_sessions\n            FOR INSERT\n            TO authenticated\n            WITH CHECK (user_id = auth.uid());\n          \n          DROP POLICY IF EXISTS "test_sessions_update_own" ON test_sessions;\n          CREATE POLICY "test_sessions_update_own"\n            ON test_sessions\n            FOR UPDATE\n            TO authenticated\n            USING (user_id = auth.uid())\n            WITH CHECK (user_id = auth.uid());\n          \n          -- Test Answers policies\n          ALTER TABLE test_answers ENABLE ROW LEVEL SECURITY;\n          \n          DROP POLICY IF EXISTS "test_answers_select_own" ON test_answers;\n          CREATE POLICY "test_answers_select_own"\n            ON test_answers\n            FOR SELECT\n            TO authenticated\n            USING (EXISTS (\n              SELECT 1 FROM test_sessions \n              WHERE test_sessions.id = test_answers.session_id \n              AND test_sessions.user_id = auth.uid()\n            ));\n          \n          DROP POLICY IF EXISTS "test_answers_insert_own" ON test_answers;\n          CREATE POLICY "test_answers_insert_own"\n            ON test_answers\n            FOR INSERT\n            TO authenticated\n            WITH CHECK (EXISTS (\n              SELECT 1 FROM test_sessions \n              WHERE test_sessions.id = test_answers.session_id \n              AND test_sessions.user_id = auth.uid()\n            ));\n          \n          DROP POLICY IF EXISTS "test_answers_update_own" ON test_answers;\n          CREATE POLICY "test_answers_update_own"\n            ON test_answers\n            FOR UPDATE\n            TO authenticated\n            USING (EXISTS (\n              SELECT 1 FROM test_sessions \n              WHERE test_sessions.id = test_answers.session_id \n              AND test_sessions.user_id = auth.uid()\n            ))\n            WITH CHECK (EXISTS (\n              SELECT 1 FROM test_sessions \n              WHERE test_sessions.id = test_answers.session_id \n              AND test_sessions.user_id = auth.uid()\n            ));\n          \n          -- Certificates policies\n          ALTER TABLE certificates ENABLE ROW LEVEL SECURITY;\n          \n          DROP POLICY IF EXISTS "certificates_select_own" ON certificates;\n          CREATE POLICY "certificates_select_own"\n            ON certificates\n            FOR SELECT\n            TO authenticated\n            USING (user_id = auth.uid());\n          \n          DROP POLICY IF EXISTS "certificates_insert_own" ON certificates;\n          CREATE POLICY "certificates_insert_own"\n            ON certificates\n            FOR INSERT\n            TO authenticated\n            WITH CHECK (user_id = auth.uid());\n        '})}catch(s){}}static async checkDatabaseConnection(){try{const{count:e,error:s}=await B.from("roles").select("*",{count:"exact",head:!0});if(s)throw s;return(e||0)>0}catch(e){return{success:!1,message:"Database connection failed",error:e}}}}function Ts(){const{login:s,logout:t,isAuthenticated:a}=_s(),[r,l]=e.useState(""),[n,c]=e.useState(""),[d,o]=e.useState(!1),[m,x]=e.useState(!1),[u,h]=e.useState(""),[p,g]=e.useState(!1),[j,y]=e.useState(!0);e.useEffect(()=>{f()},[]);const f=async()=>{try{if(y(!0),Z)return void g(!0);const{data:e,error:s}=await B.from("users").select("id").limit(1);s||!e||0===e.length?g(!0):g(!1)}catch(e){g(!0)}finally{y(!1)}};if(a)return L.jsx(i,{to:"/",replace:!0});return L.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 flex items-center justify-center px-4",children:L.jsx("div",{className:"max-w-md w-full",children:L.jsxs("div",{className:"bg-white rounded-xl shadow-xl p-8",children:[L.jsxs("div",{className:"text-center mb-8",children:[L.jsx("div",{className:"mb-6",children:L.jsx("img",{src:"/Tuteck-Logo_Darkmode-2.svg",alt:"Tuteck Technologies Pvt. Ltd.",className:"h-20 mx-auto object-contain"})}),L.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Online Examination Platform"}),L.jsx("p",{className:"text-gray-600 mt-2",children:"Tuteck Technologies Pvt. Ltd."}),L.jsx("p",{className:"text-gray-500 text-sm mt-1",children:"Sign in to your account"})]}),p&&L.jsxs("div",{className:"mb-6 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[L.jsx("h3",{className:"text-sm font-semibold text-blue-800 mb-2",children:"First Time Setup"}),L.jsx("p",{className:"text-xs text-blue-700 mb-3",children:Z?"Please configure Supabase to use the system.":"Database appears to be empty. Initialize with demo data to get started."}),!Z&&L.jsx(bs,{onClick:async()=>{x(!0),h("");try{const e=await Rs.initializeDatabase();e.success?(h(""),alert("Database initialized successfully! You can now login with the demo credentials.")):h(e.message)}catch(e){h("Failed to initialize database. Please try again.")}x(!1)},disabled:m,variant:"outline",size:"sm",className:"w-full text-blue-700 border-blue-300 hover:bg-blue-100",children:m?"Initializing Database...":"Initialize Database"}),Z&&L.jsxs("div",{className:"text-xs text-blue-700",children:[L.jsx("p",{children:"1. Create a Supabase project at supabase.com"}),L.jsx("p",{children:"2. Update .env with your credentials"}),L.jsx("p",{children:"3. Restart the development server"})]})]}),u&&L.jsxs("div",{className:"mb-4 p-4 bg-red-50 border border-red-200 rounded-lg flex items-center space-x-2",children:[L.jsx(de,{className:"w-5 h-5 text-red-600 flex-shrink-0"}),L.jsx("p",{className:"text-red-700 text-sm",children:u})]}),L.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),r&&n){o(!0),h("");try{const e=await s(r,n);e.success||h(e.message)}catch(t){h("Login failed. Please try again.")}o(!1)}else h("Please enter both email and password")},className:"space-y-4",children:[L.jsx(Ns,{label:"Email Address",type:"text",value:r,onChange:e=>l(e.target.value),placeholder:"Enter your email address",autoComplete:"off",autoFocus:!1,required:!0}),L.jsx(Ns,{label:"Password",type:"password",value:n,onChange:e=>c(e.target.value),placeholder:"Enter your password",autoComplete:"new-password",required:!0}),L.jsx(bs,{type:"submit",disabled:d,className:"w-full",size:"lg",children:d?"Signing In...":"Sign In"})]}),p&&L.jsxs("div",{className:"mt-6 p-4 bg-gray-50 border border-gray-200 rounded-lg",children:[L.jsx("h3",{className:"text-sm font-semibold text-gray-800 mb-2",children:"Demo Credentials"}),L.jsxs("div",{className:"text-xs text-gray-600 space-y-1",children:[L.jsxs("p",{children:[L.jsx("strong",{children:"Admin:"})," admin@esigma.com / password123"]}),L.jsxs("p",{children:[L.jsx("strong",{children:"Enumerator:"})," enumerator@esigma.com / password123"]})]})]})]})})})}function Is({children:e}){const{isAuthenticated:s,isLoading:t}=_s();return t?L.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:L.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):s?L.jsx(L.Fragment,{children:e}):L.jsx(i,{to:"/login",replace:!0})}function Ps(){const{user:e,logout:s}=_s();return L.jsx("header",{className:"bg-white border-b border-gray-200 px-6 py-4",children:L.jsxs("div",{className:"flex items-center justify-between",children:[L.jsxs("div",{className:"flex items-center space-x-4",children:[L.jsx("img",{src:"/Tuteck-Logo_Darkmode-2.svg",alt:"Tuteck Technologies Pvt. Ltd.",className:"h-10 object-contain"}),L.jsxs("div",{className:"flex items-center space-x-2",children:[L.jsxs("div",{children:[L.jsx("h1",{className:"text-xl font-bold text-gray-900",children:"Tuteck Online Examination Platform"}),L.jsx("p",{className:"text-sm text-gray-600",children:"Tuteck Technologies Pvt. Ltd."})]}),Z&&L.jsx("span",{className:"px-2 py-1 bg-yellow-100 text-yellow-800 text-xs rounded-full font-medium",children:"Demo Mode"})]})]}),L.jsx("div",{}),L.jsxs("div",{className:"flex items-center space-x-4",children:[L.jsx("button",{className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors",children:L.jsx(pe,{className:"w-5 h-5"})}),L.jsxs("div",{className:"flex items-center space-x-3",children:[L.jsxs("div",{className:"text-right",children:[L.jsx("p",{className:"text-sm font-medium text-gray-900",children:null==e?void 0:e.name}),L.jsx("p",{className:"text-xs text-gray-500",children:null==e?void 0:e.role.name})]}),L.jsxs("div",{className:"relative group",children:[L.jsx("button",{className:"flex items-center space-x-2 p-2 rounded-lg hover:bg-gray-100 transition-colors",children:L.jsx("div",{className:"w-8 h-8 bg-blue-600 rounded-full flex items-center justify-center",children:L.jsx(ns,{className:"w-4 h-4 text-white"})})}),L.jsx("div",{className:"absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg border border-gray-200 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-50",children:L.jsxs("div",{className:"py-2",children:[L.jsxs("button",{className:"flex items-center space-x-2 w-full px-4 py-2 text-sm text-gray-700 hover:bg-gray-100",children:[L.jsx(Ye,{className:"w-4 h-4"}),L.jsx("span",{children:"Settings"})]}),L.jsxs("button",{onClick:async()=>{await s()},className:"flex items-center space-x-2 w-full px-4 py-2 text-sm text-red-600 hover:bg-red-50",children:[L.jsx(Ie,{className:"w-4 h-4"}),L.jsx("span",{children:"Logout"})]})]})})]})]})]})]})})}const Os=[{to:"/dashboard",icon:Re,label:"Dashboard",roles:["Admin"],level:1},{to:"/users",icon:cs,label:"User Management",roles:["Admin"],level:1},{to:"/roles",icon:Ve,label:"Role Management",roles:["Admin"],level:1},{to:"/role-menu-management",icon:Le,label:"Menu Access Control",roles:["Admin"],level:1},{to:"/surveys",icon:Se,label:"Question Area",roles:["Admin"],level:1},{to:"/questions",icon:je,label:"Question Bank",roles:["Admin"],level:1},{to:"/settings",icon:Ye,label:"System Settings",roles:["Admin"],level:1},{to:"/zo-dashboard",icon:Re,label:"ZO Dashboard",roles:["ZO User"],level:2},{to:"/zone-performance",icon:Oe,label:"Zone Performance",roles:["ZO User"],level:2},{to:"/regional-overview",icon:ye,label:"Regional Overview",roles:["ZO User"],level:2},{to:"/ro-dashboard",icon:Re,label:"RO Dashboard",roles:["RO User"],level:3},{to:"/district-performance",icon:ye,label:"District Performance",roles:["RO User"],level:3},{to:"/supervisor-teams",icon:ls,label:"Supervisor Teams",roles:["RO User"],level:3},{to:"/supervisor-dashboard",icon:Re,label:"Dashboard",roles:["Supervisor"],level:4},{to:"/team-results",icon:he,label:"Team Results",roles:["Supervisor"],level:4},{to:"/my-enumerators",icon:ls,label:"My Enumerators",roles:["Supervisor"],level:4},{to:"/assigned-surveys",icon:Se,label:"Assigned Surveys",roles:["Supervisor"],level:4},{to:"/enumerator-dashboard",icon:Re,label:"My Dashboard",roles:["Enumerator"],level:5},{to:"/available-tests",icon:ge,label:"Available Tests",roles:["Enumerator","FresherBScBCA"],level:5},{to:"/my-results",icon:ts,label:"My Results",roles:["Enumerator","FresherBScBCA"],level:5},{to:"/my-certificates",icon:as,label:"My Certificates",roles:["Enumerator","FresherBScBCA"],level:5},{to:"/test-schedule",icon:Ge,label:"Test Schedule",roles:["Enumerator","FresherBScBCA"],level:5},{to:"/enumerator-dashboard",icon:Re,label:"My Dashboard",roles:["FresherBScBCA"],level:6},{to:"/results",icon:he,label:"Results & Analytics",roles:["Admin","ZO User","RO User","Supervisor"],level:1},{to:"/enumerator-status",icon:_e,label:"Candidate Status",roles:["Admin","ZO User","RO User","Supervisor"],level:1},{to:"/certificates",icon:ue,label:"Certificates",roles:["Admin","ZO User","RO User","Supervisor","Enumerator","FresherBScBCA"],level:1}],Ls={admin:[{to:"/dashboard",icon:Re,label:"Dashboard"},{to:"/users",icon:cs,label:"User Management"},{to:"/roles",icon:Ve,label:"Role Management"},{to:"/role-menu-management",icon:Le,label:"Menu Access Control"},{to:"/surveys",icon:Se,label:"Question Area"},{to:"/questions",icon:je,label:"Question Bank"},{to:"/results",icon:he,label:"Results & Analytics"},{to:"/enumerator-status",icon:_e,label:"Candidate Status"},{to:"/certificates",icon:ue,label:"Certificates"},{to:"/settings",icon:Ye,label:"System Settings"}],"zo user":[{to:"/zo-dashboard",icon:Re,label:"ZO Dashboard"},{to:"/zone-performance",icon:Oe,label:"Zone Performance"},{to:"/regional-overview",icon:ye,label:"Regional Overview"},{to:"/enumerator-status",icon:_e,label:"Candidate Status"},{to:"/results",icon:he,label:"Zone Analytics"},{to:"/certificates",icon:ue,label:"Certificates"}],"ro user":[{to:"/ro-dashboard",icon:Re,label:"RO Dashboard"},{to:"/district-performance",icon:ye,label:"District Performance"},{to:"/supervisor-teams",icon:ls,label:"Supervisor Teams"},{to:"/enumerator-status",icon:_e,label:"Candidate Status"},{to:"/results",icon:he,label:"Regional Analytics"},{to:"/certificates",icon:ue,label:"Certificates"}],supervisor:[{to:"/supervisor-dashboard",icon:Re,label:"Dashboard"},{to:"/team-results",icon:he,label:"Team Results"},{to:"/my-enumerators",icon:ls,label:"My Enumerators"},{to:"/enumerator-status",icon:_e,label:"Candidate Status"},{to:"/assigned-surveys",icon:Se,label:"Assigned Surveys"},{to:"/certificates",icon:ue,label:"Team Certificates"}],enumerator:[{to:"/enumerator-dashboard",icon:Re,label:"My Dashboard"},{to:"/available-tests",icon:ge,label:"Available Tests"},{to:"/my-results",icon:ts,label:"My Results"},{to:"/my-certificates",icon:as,label:"My Certificates"},{to:"/test-schedule",icon:Ge,label:"Test Schedule"}],fresherbscbca:[{to:"/enumerator-dashboard",icon:Re,label:"My Dashboard"},{to:"/available-tests",icon:ge,label:"Available Tests"},{to:"/my-results",icon:ts,label:"My Results"},{to:"/my-certificates",icon:as,label:"My Certificates"},{to:"/test-schedule",icon:Ge,label:"Test Schedule"}]};function qs(){const{user:e}=_s(),s=(()=>{if(!e)return[];const s="Administrator"===e.role.name?"Admin":e.role.name,t=e.role.level;return Os.filter(e=>{const a=e.roles.includes(s),r=!e.level||t<=e.level;return a&&r})})(),t=null==e?void 0:e.role.name.toLowerCase().replace(" ","_"),a=Ls[t]||Ls.enumerator,r=s.length>0?s.map(e=>({to:e.to,icon:e.icon,label:e.label})):a;return L.jsxs("aside",{className:"w-64 bg-gray-900 text-white flex flex-col",children:[L.jsxs("div",{className:"p-6",children:[L.jsxs("div",{className:"flex items-center space-x-3",children:[L.jsx("div",{className:`w-10 h-10 ${(e=>{switch(e.toLowerCase()){case"admin":return"bg-red-600";case"zo user":return"bg-purple-600";case"ro user":return"bg-indigo-600";case"supervisor":return"bg-green-600";case"enumerator":return"bg-blue-600";default:return"bg-gray-600"}})((null==e?void 0:e.role.name)||"")} rounded-lg flex items-center justify-center`,children:L.jsx(Se,{className:"w-6 h-6 text-white"})}),L.jsxs("div",{children:[L.jsx("h2",{className:"text-xl font-bold",children:"Tuteck"}),L.jsx("p",{className:"text-xs text-gray-400",children:"Examination Platform"})]})]}),L.jsxs("div",{className:"mt-4 p-3 bg-gray-800 rounded-lg",children:[L.jsxs("div",{className:"flex items-center justify-between mb-2",children:[L.jsx("p",{className:"text-sm font-medium text-white",children:null==e?void 0:e.name}),L.jsx("span",{className:"px-2 py-1 bg-blue-600 text-xs rounded-full",children:null==e?void 0:e.role.level})]}),L.jsx("p",{className:"text-xs text-gray-400",children:null==e?void 0:e.role.name}),L.jsx("p",{className:"text-xs text-gray-500",children:(e=>{switch(e.toLowerCase()){case"admin":return"Full System Access";case"zo user":return"Zone Level Access";case"ro user":return"Regional Access";case"supervisor":return"Team Management";case"enumerator":return"Test Access";default:return"Limited Access"}})((null==e?void 0:e.role.name)||"")}),(null==e?void 0:e.zone)&&L.jsx("p",{className:"text-xs text-gray-400",children:e.zone}),(null==e?void 0:e.region)&&L.jsx("p",{className:"text-xs text-gray-400",children:e.region}),(null==e?void 0:e.district)&&L.jsx("p",{className:"text-xs text-gray-400",children:e.district})]}),L.jsx("div",{className:"mt-3 p-2 bg-green-900 rounded-lg",children:L.jsxs("div",{className:"flex items-center space-x-2",children:[L.jsx(Le,{className:"w-4 h-4 text-green-400"}),L.jsxs("div",{children:[L.jsx("p",{className:"text-xs font-medium text-green-400",children:"RBAC Active"}),L.jsxs("p",{className:"text-xs text-green-300",children:[s.length," menu items"]})]})]})})]}),L.jsx("nav",{className:"flex-1 px-4 pb-4",children:L.jsx("ul",{className:"space-y-2",children:r.map(e=>L.jsx("li",{children:L.jsxs(n,{to:e.to,className:({isActive:e})=>"flex items-center space-x-3 px-4 py-3 rounded-lg transition-colors "+(e?"bg-blue-600 text-white":"text-gray-300 hover:bg-gray-800 hover:text-white"),children:[L.jsx(e.icon,{className:"w-5 h-5"}),L.jsx("span",{children:e.label})]})},e.to))})}),L.jsx("div",{className:"p-4 border-t border-gray-800",children:L.jsxs("button",{className:"flex items-center space-x-3 px-4 py-2 text-gray-300 hover:text-white hover:bg-gray-800 rounded-lg transition-colors w-full",children:[L.jsx(Ee,{className:"w-5 h-5"}),L.jsx("span",{children:"Help & Support"})]})})]})}function Ms({children:e}){return L.jsxs("div",{className:"min-h-screen bg-gray-50 flex",children:[L.jsx(qs,{}),L.jsxs("div",{className:"flex-1 flex flex-col",children:[L.jsx(Ps,{}),L.jsx("main",{className:"flex-1 overflow-auto",children:e})]})]})}function Us({title:e,value:s,icon:t,change:a,color:r="blue"}){return L.jsx(As,{children:L.jsxs("div",{className:"flex items-center justify-between",children:[L.jsxs("div",{children:[L.jsx("p",{className:"text-sm font-medium text-gray-600",children:e}),L.jsx("p",{className:"text-3xl font-bold text-gray-900",children:s}),a&&L.jsxs("p",{className:"text-sm "+("increase"===a.type?"text-green-600":"text-red-600"),children:["increase"===a.type?"+":"-",Math.abs(a.value),"% from last month"]})]}),L.jsx("div",{className:`p-3 rounded-full ${{blue:"bg-blue-500",green:"bg-green-500",yellow:"bg-yellow-500",red:"bg-red-500"}[r]}`,children:L.jsx("div",{className:"text-white",children:t})})]})})}function Fs({activities:e}){const s=e=>{switch(e){case"test_completed":return L.jsx(ve,{className:"w-4 h-4 text-green-600"});case"user_created":return L.jsx(ns,{className:"w-4 h-4 text-blue-600"});case"survey_created":return L.jsx(Se,{className:"w-4 h-4 text-purple-600"});case"question_uploaded":return L.jsx(rs,{className:"w-4 h-4 text-orange-600"});default:return L.jsx(be,{className:"w-4 h-4 text-gray-600"})}};return L.jsxs(As,{children:[L.jsxs("div",{className:"flex items-center justify-between mb-4",children:[L.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Recent Activity"}),L.jsx("button",{className:"text-sm text-blue-600 hover:text-blue-700",children:"View All"})]}),L.jsx("div",{className:"space-y-4",children:0===e.length?L.jsx("p",{className:"text-gray-500 text-sm",children:"No recent activity"}):e.map(e=>L.jsxs("div",{className:"flex items-start space-x-3",children:[L.jsx("div",{className:"flex-shrink-0 mt-1",children:s(e.type)}),L.jsxs("div",{className:"flex-1 min-w-0",children:[L.jsx("p",{className:"text-sm text-gray-900",children:e.description}),L.jsxs("p",{className:"text-xs text-gray-500",children:["by ",e.userName," • ",js(e.timestamp)]})]})]},e.id))})]})}function zs({title:e,data:s}){return L.jsxs(As,{children:[L.jsx("div",{className:"mb-4",children:L.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:e})}),L.jsx("div",{className:"h-64",children:L.jsx(h,{width:"100%",height:"100%",children:L.jsxs(p,{data:s,margin:{top:20,right:30,left:20,bottom:5},children:[L.jsx(g,{strokeDasharray:"3 3"}),L.jsx(j,{dataKey:"name"}),L.jsx(y,{}),L.jsx(f,{formatter:(e,s)=>[`${e}%`,"percentage"===s?"Pass Rate":"Count"]}),L.jsx(v,{dataKey:"percentage",fill:"#3B82F6",radius:[4,4,0,0]})]})})})]})}function Bs(){const[s,t]=e.useState(null),[a,r]=e.useState(!0);return e.useEffect(()=>{(async()=>{try{const e=await J.getDashboardData();e.success&&e.data&&t(e.data)}catch(e){}finally{r(!1)}})()},[]),a?L.jsx(Ms,{children:L.jsx("div",{className:"p-6",children:L.jsx("div",{className:"animate-pulse",children:L.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[1,2,3,4].map(e=>L.jsx("div",{className:"bg-gray-200 rounded-lg h-32"},e))})})})}):s?L.jsx(Ms,{children:L.jsxs("div",{className:"p-6",children:[L.jsxs("div",{className:"mb-8",children:[L.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Dashboard"}),L.jsx("p",{className:"text-gray-600 mt-2",children:"Overview of your Examination platform performance"})]}),L.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[L.jsx(Us,{title:"Total Users",value:s.totalUsers,icon:L.jsx(cs,{className:"w-6 h-6"}),color:"blue",change:{value:12,type:"increase"}}),L.jsx(Us,{title:"Active Surveys",value:s.totalSurveys,icon:L.jsx(Se,{className:"w-6 h-6"}),color:"green",change:{value:8,type:"increase"}}),L.jsx(Us,{title:"Test Attempts",value:s.totalAttempts,icon:L.jsx(He,{className:"w-6 h-6"}),color:"yellow",change:{value:15,type:"increase"}}),L.jsx(Us,{title:"Pass Rate",value:`${s.passRate.toFixed(1)}%`,icon:L.jsx(ue,{className:"w-6 h-6"}),color:"red",change:{value:3,type:"decrease"}})]}),L.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8",children:[L.jsx(zs,{title:"Performance by Role",data:s.performanceByRole}),L.jsx(Fs,{activities:s.recentActivity})]}),L.jsx("div",{className:"grid grid-cols-1 gap-6",children:L.jsx(zs,{title:"Performance by Question Area",data:s.performanceBySurvey})})]})}):L.jsx(Ms,{children:L.jsx("div",{className:"p-6",children:L.jsx("div",{className:"text-center text-gray-500",children:"Failed to load dashboard data"})})})}function $s(){const[s,t]=e.useState(null),[a,r]=e.useState(null),[l,i]=e.useState(!0),[n,c]=e.useState(!1),[d,o]=e.useState("30");e.useEffect(()=>{m()},[d]);const m=async()=>{try{i(!0);const e=await ae.getDashboardData(d);e.success&&e.data&&t(e.data)}catch(e){}finally{i(!1)}},x=["#3B82F6","#10B981","#F59E0B","#EF4444","#8B5CF6"];return l?L.jsx(Ms,{children:L.jsx("div",{className:"p-6",children:L.jsx("div",{className:"animate-pulse",children:L.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[1,2,3,4].map(e=>L.jsx("div",{className:"bg-gray-200 rounded-lg h-32"},e))})})})}):s?L.jsx(Ms,{children:L.jsxs("div",{className:"p-6",children:[L.jsxs("div",{className:"flex items-center justify-between mb-8",children:[L.jsxs("div",{children:[L.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Zonal Office Dashboard"}),L.jsx("p",{className:"text-gray-600 mt-2",children:"Comprehensive overview of all zones and regional performance"})]}),L.jsxs("div",{className:"flex items-center space-x-3",children:[L.jsxs("select",{value:d,onChange:e=>o(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[L.jsx("option",{value:"7",children:"Last 7 days"}),L.jsx("option",{value:"30",children:"Last 30 days"}),L.jsx("option",{value:"90",children:"Last 3 months"}),L.jsx("option",{value:"365",children:"Last year"})]}),L.jsxs(bs,{className:"flex items-center space-x-2",children:[L.jsx(we,{className:"w-4 h-4"}),L.jsx("span",{children:"Export Report"})]})]})]}),L.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-6 mb-8",children:[L.jsx(As,{children:L.jsxs("div",{className:"flex items-center justify-between",children:[L.jsxs("div",{children:[L.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Zones"}),L.jsx("p",{className:"text-3xl font-bold text-blue-600",children:s.totalZones})]}),L.jsx("div",{className:"p-3 rounded-full bg-blue-100",children:L.jsx(Oe,{className:"w-6 h-6 text-blue-600"})})]})}),L.jsx(As,{children:L.jsxs("div",{className:"flex items-center justify-between",children:[L.jsxs("div",{children:[L.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Regions"}),L.jsx("p",{className:"text-3xl font-bold text-green-600",children:s.totalRegions})]}),L.jsx("div",{className:"p-3 rounded-full bg-green-100",children:L.jsx(ye,{className:"w-6 h-6 text-green-600"})})]})}),L.jsx(As,{children:L.jsxs("div",{className:"flex items-center justify-between",children:[L.jsxs("div",{children:[L.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Users"}),L.jsx("p",{className:"text-3xl font-bold text-purple-600",children:s.totalUsers})]}),L.jsx("div",{className:"p-3 rounded-full bg-purple-100",children:L.jsx(cs,{className:"w-6 h-6 text-purple-600"})})]})}),L.jsx(As,{children:L.jsxs("div",{className:"flex items-center justify-between",children:[L.jsxs("div",{children:[L.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Overall Pass Rate"}),L.jsxs("p",{className:"text-3xl font-bold text-yellow-600",children:[s.passRate.toFixed(1),"%"]})]}),L.jsx("div",{className:"p-3 rounded-full bg-yellow-100",children:L.jsx(He,{className:"w-6 h-6 text-yellow-600"})})]})}),L.jsx(As,{children:L.jsxs("div",{className:"flex items-center justify-between",children:[L.jsxs("div",{children:[L.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Avg Score"}),L.jsxs("p",{className:"text-3xl font-bold text-red-600",children:[s.averageScore.toFixed(1),"%"]})]}),L.jsx("div",{className:"p-3 rounded-full bg-red-100",children:L.jsx(ue,{className:"w-6 h-6 text-red-600"})})]})})]}),L.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8",children:[L.jsxs(As,{children:[L.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Zone Performance Comparison"}),L.jsx("div",{className:"h-64",children:L.jsx(h,{width:"100%",height:"100%",children:L.jsxs(p,{data:s.zonePerformance,children:[L.jsx(g,{strokeDasharray:"3 3"}),L.jsx(j,{dataKey:"zoneName"}),L.jsx(y,{}),L.jsx(f,{formatter:(e,s)=>["passRate"===s?`${e}%`:e,"passRate"===s?"Pass Rate":"Average Score"]}),L.jsx(v,{dataKey:"passRate",fill:"#3B82F6",name:"passRate"}),L.jsx(v,{dataKey:"averageScore",fill:"#10B981",name:"averageScore"})]})})})]}),L.jsxs(As,{children:[L.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Regional Distribution"}),L.jsx("div",{className:"h-64",children:L.jsx(h,{width:"100%",height:"100%",children:L.jsxs(b,{children:[L.jsx(N,{data:s.regionalBreakdown,cx:"50%",cy:"50%",labelLine:!1,label:({regionName:e,percentage:s})=>`${e}: ${s}%`,outerRadius:80,fill:"#8884d8",dataKey:"totalEnumerators",children:s.regionalBreakdown.map((e,s)=>L.jsx(w,{fill:x[s%x.length]},`cell-${s}`))}),L.jsx(f,{})]})})})]})]}),L.jsxs(As,{className:"mb-8",children:[L.jsxs("div",{className:"flex items-center justify-between mb-6",children:[L.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Zone Performance Details"}),L.jsxs(bs,{variant:"secondary",className:"flex items-center space-x-2",children:[L.jsx(Ce,{className:"w-4 h-4"}),L.jsx("span",{children:"Filter Zones"})]})]}),L.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:s.zonePerformance.map(e=>L.jsxs(As,{className:"hover:shadow-lg transition-shadow cursor-pointer",onClick:()=>(e=>{r(e),c(!0)})(e),children:[L.jsxs("div",{className:"flex items-center justify-between mb-4",children:[L.jsx("h4",{className:"text-lg font-semibold text-gray-900",children:e.zoneName}),L.jsxs("span",{className:"px-3 py-1 rounded-full text-sm font-medium "+(e.passRate>=80?"bg-green-100 text-green-800":e.passRate>=60?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"),children:[e.passRate.toFixed(1),"% Pass Rate"]})]}),L.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[L.jsxs("div",{className:"text-center p-3 bg-blue-50 rounded-lg",children:[L.jsx("p",{className:"text-xl font-bold text-blue-600",children:e.totalEnumerators}),L.jsx("p",{className:"text-xs text-gray-600",children:"Enumerators"})]}),L.jsxs("div",{className:"text-center p-3 bg-green-50 rounded-lg",children:[L.jsx("p",{className:"text-xl font-bold text-green-600",children:e.completedTests}),L.jsx("p",{className:"text-xs text-gray-600",children:"Completed"})]})]}),L.jsxs("div",{className:"mb-4",children:[L.jsxs("div",{className:"flex items-center justify-between mb-2",children:[L.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Average Score"}),L.jsxs("span",{className:"text-sm text-gray-500",children:[e.averageScore.toFixed(1),"%"]})]}),L.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:L.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:`${e.averageScore}%`}})})]}),L.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-500",children:[L.jsxs("span",{children:[e.regions.length," Regions"]}),L.jsxs("div",{className:"flex items-center space-x-1",children:[L.jsx(_e,{className:"w-4 h-4"}),L.jsx("span",{children:"View Details"})]})]})]},e.zoneId))})]}),L.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8",children:[L.jsxs(As,{children:[L.jsxs("div",{className:"flex items-center justify-between mb-4",children:[L.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Top Performing Regions"}),L.jsx(ts,{className:"w-5 h-5 text-green-600"})]}),L.jsx("div",{className:"space-y-3",children:s.topPerformingRegions.map((e,s)=>L.jsxs("div",{className:"flex items-center justify-between p-3 bg-green-50 rounded-lg",children:[L.jsxs("div",{className:"flex items-center space-x-3",children:[L.jsx("div",{className:"w-8 h-8 bg-green-600 rounded-full flex items-center justify-center text-white font-bold text-sm",children:s+1}),L.jsxs("div",{children:[L.jsx("p",{className:"font-medium text-gray-900",children:e.name}),L.jsxs("p",{className:"text-sm text-gray-500",children:[e.total," enumerators"]})]})]}),L.jsxs("div",{className:"text-right",children:[L.jsxs("p",{className:"font-bold text-green-600",children:[e.percentage.toFixed(1),"%"]}),L.jsx("p",{className:"text-sm text-gray-500",children:"Pass Rate"})]})]},e.name))})]}),L.jsxs(As,{children:[L.jsxs("div",{className:"flex items-center justify-between mb-4",children:[L.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Regions Needing Attention"}),L.jsx(ss,{className:"w-5 h-5 text-red-600"})]}),L.jsx("div",{className:"space-y-3",children:s.lowPerformingRegions.map((e,s)=>L.jsxs("div",{className:"flex items-center justify-between p-3 bg-red-50 rounded-lg",children:[L.jsxs("div",{className:"flex items-center space-x-3",children:[L.jsx("div",{className:"w-8 h-8 bg-red-600 rounded-full flex items-center justify-center text-white font-bold text-sm",children:s+1}),L.jsxs("div",{children:[L.jsx("p",{className:"font-medium text-gray-900",children:e.name}),L.jsxs("p",{className:"text-sm text-gray-500",children:[e.total," enumerators"]})]})]}),L.jsxs("div",{className:"text-right",children:[L.jsxs("p",{className:"font-bold text-red-600",children:[e.percentage.toFixed(1),"%"]}),L.jsx("p",{className:"text-sm text-gray-500",children:"Pass Rate"})]})]},e.name))})]})]}),L.jsxs(As,{children:[L.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Performance Trends"}),L.jsx("div",{className:"h-64",children:L.jsx(h,{width:"100%",height:"100%",children:L.jsxs(_,{data:s.monthlyTrends,children:[L.jsx(g,{strokeDasharray:"3 3"}),L.jsx(j,{dataKey:"month"}),L.jsx(y,{}),L.jsx(f,{}),L.jsx(S,{type:"monotone",dataKey:"attempts",stroke:"#3B82F6",name:"Attempts"}),L.jsx(S,{type:"monotone",dataKey:"passed",stroke:"#10B981",name:"Passed"}),L.jsx(S,{type:"monotone",dataKey:"passRate",stroke:"#F59E0B",name:"Pass Rate %"})]})})})]}),L.jsx(us,{isOpen:n,onClose:()=>c(!1),title:`Zone Details: ${null==a?void 0:a.zoneName}`,size:"xl",children:a&&L.jsxs("div",{className:"space-y-6",children:[L.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[L.jsxs("div",{className:"text-center p-4 bg-blue-50 rounded-lg",children:[L.jsx("p",{className:"text-2xl font-bold text-blue-600",children:a.totalEnumerators}),L.jsx("p",{className:"text-sm text-gray-600",children:"Total Enumerators"})]}),L.jsxs("div",{className:"text-center p-4 bg-green-50 rounded-lg",children:[L.jsx("p",{className:"text-2xl font-bold text-green-600",children:a.completedTests}),L.jsx("p",{className:"text-sm text-gray-600",children:"Completed Tests"})]}),L.jsxs("div",{className:"text-center p-4 bg-yellow-50 rounded-lg",children:[L.jsxs("p",{className:"text-2xl font-bold text-yellow-600",children:[a.passRate.toFixed(1),"%"]}),L.jsx("p",{className:"text-sm text-gray-600",children:"Pass Rate"})]}),L.jsxs("div",{className:"text-center p-4 bg-purple-50 rounded-lg",children:[L.jsxs("p",{className:"text-2xl font-bold text-purple-600",children:[a.averageScore.toFixed(1),"%"]}),L.jsx("p",{className:"text-sm text-gray-600",children:"Average Score"})]})]}),L.jsxs("div",{children:[L.jsx("h4",{className:"font-semibold text-gray-900 mb-4",children:"Regional Breakdown"}),L.jsx("div",{className:"space-y-3",children:a.regions.map(e=>L.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[L.jsxs("div",{className:"flex items-center justify-between mb-3",children:[L.jsx("h5",{className:"font-medium text-gray-900",children:e.regionName}),L.jsxs("span",{className:"px-2 py-1 rounded-full text-xs font-medium "+(e.passRate>=80?"bg-green-100 text-green-800":e.passRate>=60?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"),children:[e.passRate.toFixed(1),"% Pass Rate"]})]}),L.jsxs("div",{className:"grid grid-cols-3 gap-4 text-sm",children:[L.jsxs("div",{children:[L.jsx("p",{className:"text-gray-500",children:"Enumerators"}),L.jsx("p",{className:"font-medium",children:e.totalEnumerators})]}),L.jsxs("div",{children:[L.jsx("p",{className:"text-gray-500",children:"Completed"}),L.jsx("p",{className:"font-medium",children:e.completedTests})]}),L.jsxs("div",{children:[L.jsx("p",{className:"text-gray-500",children:"Avg Score"}),L.jsxs("p",{className:"font-medium",children:[e.averageScore.toFixed(1),"%"]})]})]})]},e.regionId))})]})]})})]})}):L.jsx(Ms,{children:L.jsx("div",{className:"p-6",children:L.jsx("div",{className:"text-center text-gray-500",children:"Failed to load dashboard data"})})})}function Zs(){const[s,t]=e.useState(null),[a,r]=e.useState(null),[l,i]=e.useState(null),[n,c]=e.useState(!0),[d,o]=e.useState(!1),[m,x]=e.useState(!1),[u,C]=e.useState("30");e.useEffect(()=>{k()},[u]);const k=async()=>{try{c(!0);const e=await te.getDashboardData(u);e.success&&e.data&&t(e.data)}catch(e){}finally{c(!1)}},A=["#3B82F6","#10B981","#F59E0B","#EF4444","#8B5CF6"];return n?L.jsx(Ms,{children:L.jsx("div",{className:"p-6",children:L.jsx("div",{className:"animate-pulse",children:L.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[1,2,3,4].map(e=>L.jsx("div",{className:"bg-gray-200 rounded-lg h-32"},e))})})})}):s?L.jsx(Ms,{children:L.jsxs("div",{className:"p-6",children:[L.jsxs("div",{className:"flex items-center justify-between mb-8",children:[L.jsxs("div",{children:[L.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Regional Office Dashboard"}),L.jsx("p",{className:"text-gray-600 mt-2",children:"Comprehensive overview of districts and supervisor performance"})]}),L.jsxs("div",{className:"flex items-center space-x-3",children:[L.jsxs("select",{value:u,onChange:e=>C(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[L.jsx("option",{value:"7",children:"Last 7 days"}),L.jsx("option",{value:"30",children:"Last 30 days"}),L.jsx("option",{value:"90",children:"Last 3 months"}),L.jsx("option",{value:"365",children:"Last year"})]}),L.jsxs(bs,{className:"flex items-center space-x-2",children:[L.jsx(we,{className:"w-4 h-4"}),L.jsx("span",{children:"Export Report"})]})]})]}),L.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-6 mb-8",children:[L.jsx(As,{children:L.jsxs("div",{className:"flex items-center justify-between",children:[L.jsxs("div",{children:[L.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Districts"}),L.jsx("p",{className:"text-3xl font-bold text-blue-600",children:s.totalDistricts})]}),L.jsx("div",{className:"p-3 rounded-full bg-blue-100",children:L.jsx(Oe,{className:"w-6 h-6 text-blue-600"})})]})}),L.jsx(As,{children:L.jsxs("div",{className:"flex items-center justify-between",children:[L.jsxs("div",{children:[L.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Supervisors"}),L.jsx("p",{className:"text-3xl font-bold text-green-600",children:s.totalSupervisors})]}),L.jsx("div",{className:"p-3 rounded-full bg-green-100",children:L.jsx(ls,{className:"w-6 h-6 text-green-600"})})]})}),L.jsx(As,{children:L.jsxs("div",{className:"flex items-center justify-between",children:[L.jsxs("div",{children:[L.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Enumerators"}),L.jsx("p",{className:"text-3xl font-bold text-purple-600",children:s.totalUsers})]}),L.jsx("div",{className:"p-3 rounded-full bg-purple-100",children:L.jsx(cs,{className:"w-6 h-6 text-purple-600"})})]})}),L.jsx(As,{children:L.jsxs("div",{className:"flex items-center justify-between",children:[L.jsxs("div",{children:[L.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Overall Pass Rate"}),L.jsxs("p",{className:"text-3xl font-bold text-yellow-600",children:[s.passRate.toFixed(1),"%"]})]}),L.jsx("div",{className:"p-3 rounded-full bg-yellow-100",children:L.jsx(He,{className:"w-6 h-6 text-yellow-600"})})]})}),L.jsx(As,{children:L.jsxs("div",{className:"flex items-center justify-between",children:[L.jsxs("div",{children:[L.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Avg Score"}),L.jsxs("p",{className:"text-3xl font-bold text-red-600",children:[s.averageScore.toFixed(1),"%"]})]}),L.jsx("div",{className:"p-3 rounded-full bg-red-100",children:L.jsx(ue,{className:"w-6 h-6 text-red-600"})})]})})]}),L.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8",children:[L.jsxs(As,{children:[L.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"District Performance Comparison"}),L.jsx("div",{className:"h-64",children:L.jsx(h,{width:"100%",height:"100%",children:L.jsxs(p,{data:s.districtPerformance,children:[L.jsx(g,{strokeDasharray:"3 3"}),L.jsx(j,{dataKey:"districtName"}),L.jsx(y,{}),L.jsx(f,{formatter:(e,s)=>["passRate"===s?`${e}%`:e,"passRate"===s?"Pass Rate":"Average Score"]}),L.jsx(v,{dataKey:"passRate",fill:"#3B82F6",name:"passRate"}),L.jsx(v,{dataKey:"averageScore",fill:"#10B981",name:"averageScore"})]})})})]}),L.jsxs(As,{children:[L.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Enumerator Distribution"}),L.jsx("div",{className:"h-64",children:L.jsx(h,{width:"100%",height:"100%",children:L.jsxs(b,{children:[L.jsx(N,{data:s.enumeratorDistribution,cx:"50%",cy:"50%",labelLine:!1,label:({category:e,percentage:s})=>`${e}: ${s}%`,outerRadius:80,fill:"#8884d8",dataKey:"count",children:s.enumeratorDistribution.map((e,s)=>L.jsx(w,{fill:A[s%A.length]},`cell-${s}`))}),L.jsx(f,{})]})})})]})]}),L.jsxs(As,{className:"mb-8",children:[L.jsxs("div",{className:"flex items-center justify-between mb-6",children:[L.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"District Performance Details"}),L.jsxs(bs,{variant:"secondary",className:"flex items-center space-x-2",children:[L.jsx(Ce,{className:"w-4 h-4"}),L.jsx("span",{children:"Filter Districts"})]})]}),L.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:s.districtPerformance.map(e=>L.jsxs(As,{className:"hover:shadow-lg transition-shadow cursor-pointer",onClick:()=>(e=>{r(e),o(!0)})(e),children:[L.jsxs("div",{className:"flex items-center justify-between mb-4",children:[L.jsx("h4",{className:"text-lg font-semibold text-gray-900",children:e.districtName}),L.jsxs("span",{className:"px-3 py-1 rounded-full text-sm font-medium "+(e.passRate>=80?"bg-green-100 text-green-800":e.passRate>=60?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"),children:[e.passRate.toFixed(1),"% Pass Rate"]})]}),L.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[L.jsxs("div",{className:"text-center p-3 bg-blue-50 rounded-lg",children:[L.jsx("p",{className:"text-xl font-bold text-blue-600",children:e.totalEnumerators}),L.jsx("p",{className:"text-xs text-gray-600",children:"Enumerators"})]}),L.jsxs("div",{className:"text-center p-3 bg-green-50 rounded-lg",children:[L.jsx("p",{className:"text-xl font-bold text-green-600",children:e.completedTests}),L.jsx("p",{className:"text-xs text-gray-600",children:"Completed"})]})]}),L.jsxs("div",{className:"mb-4",children:[L.jsxs("div",{className:"flex items-center justify-between mb-2",children:[L.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Average Score"}),L.jsxs("span",{className:"text-sm text-gray-500",children:[e.averageScore.toFixed(1),"%"]})]}),L.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:L.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:`${e.averageScore}%`}})})]}),L.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-500",children:[L.jsxs("span",{children:["District ID: ",e.districtId]}),L.jsxs("div",{className:"flex items-center space-x-1",children:[L.jsx(_e,{className:"w-4 h-4"}),L.jsx("span",{children:"View Details"})]})]})]},e.districtId))})]}),L.jsxs(As,{className:"mb-8",children:[L.jsxs("div",{className:"flex items-center justify-between mb-6",children:[L.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Supervisor Performance"}),L.jsxs(bs,{variant:"secondary",className:"flex items-center space-x-2",children:[L.jsx(Ce,{className:"w-4 h-4"}),L.jsx("span",{children:"Filter Supervisors"})]})]}),L.jsx("div",{className:"overflow-x-auto",children:L.jsxs("table",{className:"w-full",children:[L.jsx("thead",{children:L.jsxs("tr",{className:"border-b border-gray-200",children:[L.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-900",children:"Supervisor"}),L.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-900",children:"Enumerators"}),L.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-900",children:"Completed Tests"}),L.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-900",children:"Pass Rate"}),L.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-900",children:"Avg Score"}),L.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-900",children:"Actions"})]})}),L.jsx("tbody",{children:s.supervisorPerformance.map(e=>L.jsxs("tr",{className:"border-b border-gray-100 hover:bg-gray-50",children:[L.jsx("td",{className:"py-3 px-4",children:L.jsxs("div",{children:[L.jsx("p",{className:"font-medium text-gray-900",children:e.supervisorName}),L.jsxs("p",{className:"text-sm text-gray-500",children:["ID: ",e.supervisorId]})]})}),L.jsx("td",{className:"py-3 px-4 text-gray-900",children:e.totalEnumerators}),L.jsx("td",{className:"py-3 px-4 text-gray-900",children:e.completedTests}),L.jsx("td",{className:"py-3 px-4",children:L.jsxs("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium "+(e.passRate>=80?"bg-green-100 text-green-800":e.passRate>=60?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"),children:[e.passRate.toFixed(1),"%"]})}),L.jsxs("td",{className:"py-3 px-4 text-gray-900",children:[e.averageScore.toFixed(1),"%"]}),L.jsx("td",{className:"py-3 px-4",children:L.jsx("button",{onClick:()=>(e=>{i(e),x(!0)})(e),className:"p-1 text-blue-600 hover:text-blue-700",children:L.jsx(_e,{className:"w-4 h-4"})})})]},e.supervisorId))})]})})]}),L.jsxs(As,{children:[L.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Performance Trends"}),L.jsx("div",{className:"h-64",children:L.jsx(h,{width:"100%",height:"100%",children:L.jsxs(_,{data:s.monthlyTrends,children:[L.jsx(g,{strokeDasharray:"3 3"}),L.jsx(j,{dataKey:"month"}),L.jsx(y,{}),L.jsx(f,{}),L.jsx(S,{type:"monotone",dataKey:"attempts",stroke:"#3B82F6",name:"Attempts"}),L.jsx(S,{type:"monotone",dataKey:"passed",stroke:"#10B981",name:"Passed"}),L.jsx(S,{type:"monotone",dataKey:"passRate",stroke:"#F59E0B",name:"Pass Rate %"})]})})})]}),L.jsx(us,{isOpen:d,onClose:()=>o(!1),title:`District Details: ${null==a?void 0:a.districtName}`,size:"lg",children:a&&L.jsxs("div",{className:"space-y-6",children:[L.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[L.jsxs("div",{className:"text-center p-4 bg-blue-50 rounded-lg",children:[L.jsx("p",{className:"text-2xl font-bold text-blue-600",children:a.totalEnumerators}),L.jsx("p",{className:"text-sm text-gray-600",children:"Total Enumerators"})]}),L.jsxs("div",{className:"text-center p-4 bg-green-50 rounded-lg",children:[L.jsx("p",{className:"text-2xl font-bold text-green-600",children:a.completedTests}),L.jsx("p",{className:"text-sm text-gray-600",children:"Completed Tests"})]}),L.jsxs("div",{className:"text-center p-4 bg-yellow-50 rounded-lg",children:[L.jsxs("p",{className:"text-2xl font-bold text-yellow-600",children:[a.passRate.toFixed(1),"%"]}),L.jsx("p",{className:"text-sm text-gray-600",children:"Pass Rate"})]}),L.jsxs("div",{className:"text-center p-4 bg-purple-50 rounded-lg",children:[L.jsxs("p",{className:"text-2xl font-bold text-purple-600",children:[a.averageScore.toFixed(1),"%"]}),L.jsx("p",{className:"text-sm text-gray-600",children:"Average Score"})]})]}),L.jsxs("div",{children:[L.jsx("h4",{className:"font-semibold text-gray-900 mb-4",children:"District Information"}),L.jsx("div",{className:"bg-gray-50 rounded-lg p-4",children:L.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[L.jsxs("div",{children:[L.jsx("p",{className:"text-gray-500",children:"District ID"}),L.jsx("p",{className:"font-medium",children:a.districtId})]}),L.jsxs("div",{children:[L.jsx("p",{className:"text-gray-500",children:"District Name"}),L.jsx("p",{className:"font-medium",children:a.districtName})]})]})})]})]})}),L.jsx(us,{isOpen:m,onClose:()=>x(!1),title:`Supervisor Details: ${null==l?void 0:l.supervisorName}`,size:"xl",children:l&&L.jsxs("div",{className:"space-y-6",children:[L.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[L.jsxs("div",{className:"text-center p-4 bg-blue-50 rounded-lg",children:[L.jsx("p",{className:"text-2xl font-bold text-blue-600",children:l.totalEnumerators}),L.jsx("p",{className:"text-sm text-gray-600",children:"Team Size"})]}),L.jsxs("div",{className:"text-center p-4 bg-green-50 rounded-lg",children:[L.jsx("p",{className:"text-2xl font-bold text-green-600",children:l.completedTests}),L.jsx("p",{className:"text-sm text-gray-600",children:"Completed Tests"})]}),L.jsxs("div",{className:"text-center p-4 bg-yellow-50 rounded-lg",children:[L.jsxs("p",{className:"text-2xl font-bold text-yellow-600",children:[l.passRate.toFixed(1),"%"]}),L.jsx("p",{className:"text-sm text-gray-600",children:"Team Pass Rate"})]}),L.jsxs("div",{className:"text-center p-4 bg-purple-50 rounded-lg",children:[L.jsxs("p",{className:"text-2xl font-bold text-purple-600",children:[l.averageScore.toFixed(1),"%"]}),L.jsx("p",{className:"text-sm text-gray-600",children:"Team Avg Score"})]})]}),L.jsxs("div",{children:[L.jsx("h4",{className:"font-semibold text-gray-900 mb-4",children:"Team Members"}),L.jsx("div",{className:"space-y-3 max-h-64 overflow-y-auto",children:l.enumerators.map(e=>L.jsx("div",{className:"border border-gray-200 rounded-lg p-3",children:L.jsxs("div",{className:"flex items-center justify-between",children:[L.jsxs("div",{children:[L.jsx("p",{className:"font-medium text-gray-900",children:e.user.name}),L.jsx("p",{className:"text-sm text-gray-500",children:e.user.email})]}),L.jsxs("div",{className:"text-right",children:[L.jsxs("p",{className:"text-sm font-medium text-gray-900",children:[e.overallProgress,"% Complete"]}),L.jsxs("p",{className:"text-xs text-gray-500",children:[e.totalCertificates," certificates"]})]})]})},e.id))})]})]})})]})}):L.jsx(Ms,{children:L.jsx("div",{className:"p-6",children:L.jsx("div",{className:"text-center text-gray-500",children:"Failed to load dashboard data"})})})}function Qs(){const[s,t]=e.useState(null),[a,r]=e.useState(null),[l,i]=e.useState(null),[n,c]=e.useState(!0),[d,o]=e.useState(!1),[m,x]=e.useState(!1),[u,_]=e.useState("30");e.useEffect(()=>{S()},[u]);const S=async()=>{try{c(!0);const e=await se.getDashboardData(u);e.success&&e.data&&t(e.data)}catch(e){}finally{c(!1)}},C=e=>{switch(e){case"completed":return"bg-green-100 text-green-800";case"in_progress":return"bg-yellow-100 text-yellow-800";case"failed":return"bg-red-100 text-red-800";case"expired":return"bg-orange-100 text-orange-800";default:return"bg-gray-100 text-gray-800"}},k=["#3B82F6","#10B981","#F59E0B","#EF4444","#8B5CF6"];return n?L.jsx(Ms,{children:L.jsx("div",{className:"p-6",children:L.jsx("div",{className:"animate-pulse",children:L.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[1,2,3,4].map(e=>L.jsx("div",{className:"bg-gray-200 rounded-lg h-32"},e))})})})}):s?L.jsx(Ms,{children:L.jsxs("div",{className:"p-6",children:[L.jsxs("div",{className:"flex items-center justify-between mb-8",children:[L.jsxs("div",{children:[L.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Supervisor Dashboard"}),L.jsx("p",{className:"text-gray-600 mt-2",children:"Monitor your team's performance and progress"})]}),L.jsxs("div",{className:"flex items-center space-x-3",children:[L.jsxs("select",{value:u,onChange:e=>_(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[L.jsx("option",{value:"7",children:"Last 7 days"}),L.jsx("option",{value:"30",children:"Last 30 days"}),L.jsx("option",{value:"90",children:"Last 3 months"}),L.jsx("option",{value:"365",children:"Last year"})]}),L.jsxs(bs,{className:"flex items-center space-x-2",children:[L.jsx(we,{className:"w-4 h-4"}),L.jsx("span",{children:"Export Report"})]})]})]}),L.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[L.jsx(As,{children:L.jsxs("div",{className:"flex items-center justify-between",children:[L.jsxs("div",{children:[L.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Enumerators"}),L.jsx("p",{className:"text-3xl font-bold text-blue-600",children:s.totalEnumerators})]}),L.jsx("div",{className:"p-3 rounded-full bg-blue-100",children:L.jsx(cs,{className:"w-6 h-6 text-blue-600"})})]})}),L.jsx(As,{children:L.jsxs("div",{className:"flex items-center justify-between",children:[L.jsxs("div",{children:[L.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Attempts"}),L.jsx("p",{className:"text-3xl font-bold text-green-600",children:s.totalAttempts})]}),L.jsx("div",{className:"p-3 rounded-full bg-green-100",children:L.jsx(Se,{className:"w-6 h-6 text-green-600"})})]})}),L.jsx(As,{children:L.jsxs("div",{className:"flex items-center justify-between",children:[L.jsxs("div",{children:[L.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Team Pass Rate"}),L.jsxs("p",{className:"text-3xl font-bold text-yellow-600",children:[s.passRate.toFixed(1),"%"]})]}),L.jsx("div",{className:"p-3 rounded-full bg-yellow-100",children:L.jsx(He,{className:"w-6 h-6 text-yellow-600"})})]})}),L.jsx(As,{children:L.jsxs("div",{className:"flex items-center justify-between",children:[L.jsxs("div",{children:[L.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Avg Score"}),L.jsxs("p",{className:"text-3xl font-bold text-purple-600",children:[s.averageScore.toFixed(1),"%"]})]}),L.jsx("div",{className:"p-3 rounded-full bg-purple-100",children:L.jsx(ue,{className:"w-6 h-6 text-purple-600"})})]})})]}),s.upcomingDeadlines.length>0&&L.jsxs(As,{className:"mb-8 border-l-4 border-orange-500 bg-orange-50",children:[L.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[L.jsx(oe,{className:"w-6 h-6 text-orange-600"}),L.jsx("h3",{className:"text-lg font-semibold text-orange-900",children:"Upcoming Deadlines"})]}),L.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:s.upcomingDeadlines.map(e=>L.jsxs("div",{className:"bg-white rounded-lg p-4 border border-orange-200",children:[L.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:e.surveyTitle}),L.jsxs("div",{className:"space-y-1 text-sm",children:[L.jsxs("p",{className:"text-gray-600",children:[L.jsx(fe,{className:"w-4 h-4 inline mr-1"}),"Due: ",gs(e.targetDate)]}),L.jsxs("p",{className:"text-orange-600 font-medium",children:[e.daysLeft," days left"]}),L.jsxs("p",{className:"text-gray-600",children:[e.pendingEnumerators,"/",e.totalEnumerators," pending"]})]})]},e.surveyId))})]}),L.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8",children:[L.jsxs(As,{children:[L.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Team Performance"}),L.jsx("div",{className:"h-64",children:L.jsx(h,{width:"100%",height:"100%",children:L.jsxs(p,{data:s.teamPerformance,children:[L.jsx(g,{strokeDasharray:"3 3"}),L.jsx(j,{dataKey:"teamName"}),L.jsx(y,{}),L.jsx(f,{formatter:(e,s)=>["passRate"===s?`${e}%`:e,"passRate"===s?"Pass Rate":"Average Score"]}),L.jsx(v,{dataKey:"passRate",fill:"#3B82F6",name:"passRate"}),L.jsx(v,{dataKey:"averageScore",fill:"#10B981",name:"averageScore"})]})})})]}),L.jsxs(As,{children:[L.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Enumerator Status Distribution"}),L.jsx("div",{className:"h-64",children:L.jsx(h,{width:"100%",height:"100%",children:L.jsxs(b,{children:[L.jsx(N,{data:[{name:"Completed",value:s.enumeratorStatus.filter(e=>100===e.overallProgress).length},{name:"In Progress",value:s.enumeratorStatus.filter(e=>e.overallProgress>0&&e.overallProgress<100).length},{name:"Not Started",value:s.enumeratorStatus.filter(e=>0===e.overallProgress).length}],cx:"50%",cy:"50%",labelLine:!1,label:({name:e,value:s})=>`${e}: ${s}`,outerRadius:80,fill:"#8884d8",dataKey:"value",children:[0,1,2].map(e=>L.jsx(w,{fill:k[e%k.length]},`cell-${e}`))}),L.jsx(f,{})]})})})]})]}),L.jsxs(As,{className:"mb-8",children:[L.jsxs("div",{className:"flex items-center justify-between mb-6",children:[L.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Team Details"}),L.jsxs(bs,{variant:"secondary",className:"flex items-center space-x-2",children:[L.jsx(Ce,{className:"w-4 h-4"}),L.jsx("span",{children:"Filter Teams"})]})]}),L.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:s.teamPerformance.map(e=>L.jsxs(As,{className:"hover:shadow-lg transition-shadow cursor-pointer",onClick:()=>(e=>{r(e),o(!0)})(e),children:[L.jsxs("div",{className:"flex items-center justify-between mb-4",children:[L.jsx("h4",{className:"text-lg font-semibold text-gray-900",children:e.teamName}),L.jsxs("span",{className:"px-3 py-1 rounded-full text-sm font-medium "+(e.passRate>=80?"bg-green-100 text-green-800":e.passRate>=60?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"),children:[e.passRate.toFixed(1),"% Pass Rate"]})]}),L.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[L.jsxs("div",{className:"text-center p-3 bg-blue-50 rounded-lg",children:[L.jsx("p",{className:"text-xl font-bold text-blue-600",children:e.totalMembers}),L.jsx("p",{className:"text-xs text-gray-600",children:"Members"})]}),L.jsxs("div",{className:"text-center p-3 bg-green-50 rounded-lg",children:[L.jsx("p",{className:"text-xl font-bold text-green-600",children:e.completedTests}),L.jsx("p",{className:"text-xs text-gray-600",children:"Completed"})]})]}),L.jsxs("div",{className:"mb-4",children:[L.jsxs("div",{className:"flex items-center justify-between mb-2",children:[L.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Average Score"}),L.jsxs("span",{className:"text-sm text-gray-500",children:[e.averageScore.toFixed(1),"%"]})]}),L.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:L.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:`${e.averageScore}%`}})})]}),L.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-500",children:[L.jsxs("span",{children:["Team ID: ",e.teamId]}),L.jsxs("div",{className:"flex items-center space-x-1",children:[L.jsx(_e,{className:"w-4 h-4"}),L.jsx("span",{children:"View Details"})]})]})]},e.teamId))})]}),L.jsxs(As,{children:[L.jsxs("div",{className:"flex items-center justify-between mb-6",children:[L.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Enumerator Status"}),L.jsxs("div",{className:"flex items-center space-x-3",children:[L.jsx(Ns,{placeholder:"Search enumerators...",className:"w-64"}),L.jsxs(bs,{variant:"secondary",className:"flex items-center space-x-2",children:[L.jsx(Ce,{className:"w-4 h-4"}),L.jsx("span",{children:"Filter"})]})]})]}),L.jsx("div",{className:"space-y-4",children:s.enumeratorStatus.map(e=>L.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow",children:[L.jsxs("div",{className:"flex items-center justify-between",children:[L.jsxs("div",{className:"flex items-center space-x-4",children:[L.jsx("div",{className:"w-12 h-12 bg-blue-600 rounded-full flex items-center justify-center",children:L.jsx(ns,{className:"w-6 h-6 text-white"})}),L.jsxs("div",{children:[L.jsx("h4",{className:"text-lg font-semibold text-gray-900",children:e.user.name}),L.jsx("p",{className:"text-sm text-gray-500",children:e.user.email}),L.jsx("p",{className:"text-sm text-gray-500",children:e.user.jurisdiction||"No jurisdiction"})]})]}),L.jsxs("div",{className:"flex items-center space-x-6",children:[L.jsxs("div",{className:"text-center",children:[L.jsxs("p",{className:"text-2xl font-bold text-blue-600",children:[e.overallProgress,"%"]}),L.jsx("p",{className:"text-sm text-gray-500",children:"Progress"})]}),L.jsxs("div",{className:"text-center",children:[L.jsx("p",{className:"text-2xl font-bold text-green-600",children:e.surveys.filter(e=>"completed"===e.status).length}),L.jsx("p",{className:"text-sm text-gray-500",children:"Completed"})]}),L.jsxs("div",{className:"text-center",children:[L.jsx("p",{className:"text-2xl font-bold text-purple-600",children:e.totalCertificates}),L.jsx("p",{className:"text-sm text-gray-500",children:"Certificates"})]}),L.jsxs(bs,{variant:"secondary",size:"sm",onClick:()=>(e=>{i(e),x(!0)})(e),className:"flex items-center space-x-2",children:[L.jsx(_e,{className:"w-4 h-4"}),L.jsx("span",{children:"View"})]})]})]}),L.jsxs("div",{className:"mt-4",children:[L.jsxs("div",{className:"flex items-center justify-between mb-2",children:[L.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Overall Progress"}),L.jsxs("span",{className:"text-sm text-gray-500",children:[e.overallProgress,"%"]})]}),L.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:L.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:`${e.overallProgress}%`}})})]}),L.jsxs("div",{className:"mt-4 flex flex-wrap gap-2",children:[e.surveys.slice(0,3).map(e=>L.jsxs("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${C(e.status)}`,children:[e.surveyTitle,": ",e.status.replace("_"," ")]},e.surveyId)),e.surveys.length>3&&L.jsxs("span",{className:"text-sm text-gray-500",children:["+",e.surveys.length-3," more"]})]})]},e.id))})]}),L.jsx(us,{isOpen:d,onClose:()=>o(!1),title:`Team Details: ${null==a?void 0:a.teamName}`,size:"xl",children:a&&L.jsxs("div",{className:"space-y-6",children:[L.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[L.jsxs("div",{className:"text-center p-4 bg-blue-50 rounded-lg",children:[L.jsx("p",{className:"text-2xl font-bold text-blue-600",children:a.totalMembers}),L.jsx("p",{className:"text-sm text-gray-600",children:"Total Members"})]}),L.jsxs("div",{className:"text-center p-4 bg-green-50 rounded-lg",children:[L.jsx("p",{className:"text-2xl font-bold text-green-600",children:a.completedTests}),L.jsx("p",{className:"text-sm text-gray-600",children:"Completed Tests"})]}),L.jsxs("div",{className:"text-center p-4 bg-yellow-50 rounded-lg",children:[L.jsxs("p",{className:"text-2xl font-bold text-yellow-600",children:[a.passRate.toFixed(1),"%"]}),L.jsx("p",{className:"text-sm text-gray-600",children:"Pass Rate"})]}),L.jsxs("div",{className:"text-center p-4 bg-purple-50 rounded-lg",children:[L.jsxs("p",{className:"text-2xl font-bold text-purple-600",children:[a.averageScore.toFixed(1),"%"]}),L.jsx("p",{className:"text-sm text-gray-600",children:"Average Score"})]})]}),L.jsxs("div",{children:[L.jsx("h4",{className:"font-semibold text-gray-900 mb-4",children:"Team Members"}),L.jsx("div",{className:"space-y-3 max-h-64 overflow-y-auto",children:a.members.map(e=>L.jsx("div",{className:"border border-gray-200 rounded-lg p-3",children:L.jsxs("div",{className:"flex items-center justify-between",children:[L.jsxs("div",{children:[L.jsx("p",{className:"font-medium text-gray-900",children:e.user.name}),L.jsx("p",{className:"text-sm text-gray-500",children:e.user.email})]}),L.jsxs("div",{className:"text-right",children:[L.jsxs("p",{className:"text-sm font-medium text-gray-900",children:[e.overallProgress,"% Complete"]}),L.jsxs("p",{className:"text-xs text-gray-500",children:[e.totalCertificates," certificates"]})]})]})},e.id))})]})]})}),L.jsx(us,{isOpen:m,onClose:()=>x(!1),title:`Enumerator Details: ${null==l?void 0:l.user.name}`,size:"xl",children:l&&L.jsxs("div",{className:"space-y-6",children:[L.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[L.jsxs("div",{children:[L.jsx("h4",{className:"font-semibold text-gray-900 mb-3",children:"Personal Information"}),L.jsxs("div",{className:"space-y-2 text-sm",children:[L.jsxs("p",{children:[L.jsx("span",{className:"font-medium",children:"Name:"})," ",l.user.name]}),L.jsxs("p",{children:[L.jsx("span",{className:"font-medium",children:"Email:"})," ",l.user.email]}),L.jsxs("p",{children:[L.jsx("span",{className:"font-medium",children:"Role:"})," ",l.user.role.name]}),L.jsxs("p",{children:[L.jsx("span",{className:"font-medium",children:"Jurisdiction:"})," ",l.user.jurisdiction||"N/A"]}),L.jsxs("p",{children:[L.jsx("span",{className:"font-medium",children:"Last Activity:"})," ",js(l.lastActivity)]})]})]}),L.jsxs("div",{children:[L.jsx("h4",{className:"font-semibold text-gray-900 mb-3",children:"Performance Summary"}),L.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[L.jsxs("div",{className:"text-center p-3 bg-blue-50 rounded-lg",children:[L.jsxs("p",{className:"text-xl font-bold text-blue-600",children:[l.overallProgress,"%"]}),L.jsx("p",{className:"text-xs text-gray-600",children:"Overall Progress"})]}),L.jsxs("div",{className:"text-center p-3 bg-purple-50 rounded-lg",children:[L.jsx("p",{className:"text-xl font-bold text-purple-600",children:l.totalCertificates}),L.jsx("p",{className:"text-xs text-gray-600",children:"Certificates"})]})]})]})]}),L.jsxs("div",{children:[L.jsx("h4",{className:"font-semibold text-gray-900 mb-4",children:"Survey Status"}),L.jsx("div",{className:"space-y-3",children:l.surveys.map(e=>L.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[L.jsxs("div",{className:"flex items-center justify-between mb-3",children:[L.jsx("h5",{className:"font-medium text-gray-900",children:e.surveyTitle}),L.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${C(e.status)}`,children:e.status.replace("_"," ").toUpperCase()})]}),L.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[L.jsxs("div",{children:[L.jsx("p",{className:"text-gray-500",children:"Attempts"}),L.jsxs("p",{className:"font-medium",children:[e.attempts,"/",e.maxAttempts]})]}),L.jsxs("div",{children:[L.jsx("p",{className:"text-gray-500",children:"Best Score"}),L.jsx("p",{className:"font-medium",children:e.bestScore?`${e.bestScore}%`:"N/A"})]}),L.jsxs("div",{children:[L.jsx("p",{className:"text-gray-500",children:"Target Date"}),L.jsx("p",{className:"font-medium",children:gs(e.targetDate)})]}),L.jsxs("div",{children:[L.jsx("p",{className:"text-gray-500",children:"Last Attempt"}),L.jsx("p",{className:"font-medium",children:e.lastAttempt?gs(e.lastAttempt):"Never"})]})]}),e.certificateId&&L.jsxs("div",{className:"mt-3 flex items-center space-x-2 text-green-600",children:[L.jsx(ue,{className:"w-4 h-4"}),L.jsx("span",{className:"text-sm font-medium",children:"Certificate Earned"})]})]},e.surveyId))})]})]})})]})}):L.jsx(Ms,{children:L.jsx("div",{className:"p-6",children:L.jsx("div",{className:"text-center text-gray-500",children:"Failed to load dashboard data"})})})}function Ys(){const s=c(),[t,a]=e.useState(null),[r,l]=e.useState(null);e.useState(null);const[i,n]=e.useState(!0),[d,o]=e.useState(!1),[m,x]=e.useState(!1),[u,p]=e.useState("overview"),[v,b]=e.useState(""),[N,w]=e.useState("all");e.useEffect(()=>{C()},[]);const C=async()=>{try{n(!0);const e=await ee.getDashboardData();e.success&&e.data&&a(e.data)}catch(e){}finally{n(!1)}},k=async e=>{try{x(!0);const a=null==t?void 0:t.availableTests.find(s=>s.surveyId===e);if(!a||!a.isEligible||0===a.attemptsLeft)return void alert("You are not eligible to take this test or have no attempts remaining.");const r=await X.createTestSession(e);if(!r.success||!r.data)throw new Error(r.message||"Failed to create test session");const l=r.data.id;s(`/test/${l}`,{state:{surveyId:e,startTime:r.data.startTime,sessionData:r.data}})}catch(a){alert(`Failed to start test: ${a instanceof Error?a.message:"Please try again."}`)}finally{x(!1),o(!1)}},A=e=>{if(!e.isEligible)return"bg-gray-100 text-gray-800";if(0===e.attemptsLeft)return"bg-red-100 text-red-800";return Math.ceil((new Date(e.targetDate).getTime()-(new Date).getTime())/864e5)<=3?"bg-orange-100 text-orange-800":"bg-green-100 text-green-800"},E=e=>{if(!e.isEligible)return"Not Eligible";if(0===e.attemptsLeft)return"No Attempts Left";const s=Math.ceil((new Date(e.targetDate).getTime()-(new Date).getTime())/864e5);return s<=0?"Overdue":s<=3?`${s} days left`:"Available"},D=(null==t?void 0:t.availableTests.filter(e=>{const s=e.title.toLowerCase().includes(v.toLowerCase())||e.description.toLowerCase().includes(v.toLowerCase());if("all"===N)return s;const t=Math.ceil((new Date(e.targetDate).getTime()-(new Date).getTime())/864e5);switch(N){case"urgent":return s&&t<=3&&t>0;case"available":return s&&e.isEligible&&e.attemptsLeft>0;case"overdue":return s&&t<=0;default:return s}}))||[];return i?L.jsx(Ms,{children:L.jsx("div",{className:"p-6",children:L.jsx("div",{className:"animate-pulse",children:L.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[1,2,3,4].map(e=>L.jsx("div",{className:"bg-gray-200 rounded-lg h-32"},e))})})})}):t?L.jsx(Ms,{children:L.jsxs("div",{className:"p-6",children:[L.jsxs("div",{className:"flex items-center justify-between mb-8",children:[L.jsxs("div",{children:[L.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"My Dashboard"}),L.jsx("p",{className:"text-gray-600 mt-2",children:"Track your test progress and achievements"})]}),L.jsxs("div",{className:"flex items-center space-x-3",children:[L.jsxs(bs,{variant:"secondary",className:"flex items-center space-x-2",children:[L.jsx(we,{className:"w-4 h-4"}),L.jsx("span",{children:"Download Progress Report"})]}),L.jsxs(bs,{className:"flex items-center space-x-2",children:[L.jsx(ge,{className:"w-4 h-4"}),L.jsx("span",{children:"Study Materials"})]})]})]}),L.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[L.jsx(As,{children:L.jsxs("div",{className:"flex items-center justify-between",children:[L.jsxs("div",{children:[L.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Available Tests"}),L.jsx("p",{className:"text-3xl font-bold text-blue-600",children:t.availableTests.length})]}),L.jsx("div",{className:"p-3 rounded-full bg-blue-100",children:L.jsx(Se,{className:"w-6 h-6 text-blue-600"})})]})}),L.jsx(As,{children:L.jsxs("div",{className:"flex items-center justify-between",children:[L.jsxs("div",{children:[L.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Completed Tests"}),L.jsx("p",{className:"text-3xl font-bold text-green-600",children:t.completedTests.length})]}),L.jsx("div",{className:"p-3 rounded-full bg-green-100",children:L.jsx(ve,{className:"w-6 h-6 text-green-600"})})]})}),L.jsx(As,{children:L.jsxs("div",{className:"flex items-center justify-between",children:[L.jsxs("div",{children:[L.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Average Score"}),L.jsxs("p",{className:"text-3xl font-bold text-yellow-600",children:[t.averageScore.toFixed(1),"%"]})]}),L.jsx("div",{className:"p-3 rounded-full bg-yellow-100",children:L.jsx(He,{className:"w-6 h-6 text-yellow-600"})})]})}),L.jsx(As,{children:L.jsxs("div",{className:"flex items-center justify-between",children:[L.jsxs("div",{children:[L.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Certificates"}),L.jsx("p",{className:"text-3xl font-bold text-purple-600",children:t.certificates.length})]}),L.jsx("div",{className:"p-3 rounded-full bg-purple-100",children:L.jsx(ue,{className:"w-6 h-6 text-purple-600"})})]})})]}),L.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8",children:[L.jsxs(As,{children:[L.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Overall Progress"}),L.jsxs("div",{className:"text-center mb-6",children:[L.jsxs("div",{className:"relative inline-flex items-center justify-center w-32 h-32",children:[L.jsxs("svg",{className:"w-32 h-32 transform -rotate-90",viewBox:"0 0 100 100",children:[L.jsx("circle",{cx:"50",cy:"50",r:"40",stroke:"currentColor",strokeWidth:"8",fill:"transparent",className:"text-gray-200"}),L.jsx("circle",{cx:"50",cy:"50",r:"40",stroke:"currentColor",strokeWidth:"8",fill:"transparent",strokeDasharray:""+2*Math.PI*40,strokeDashoffset:""+2*Math.PI*40*(1-t.overallProgress/100),className:"text-blue-600 transition-all duration-300"})]}),L.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:L.jsxs("span",{className:"text-2xl font-bold text-gray-900",children:[t.overallProgress,"%"]})})]}),L.jsx("p",{className:"text-gray-600 mt-2",children:"Overall Completion"})]}),L.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[L.jsxs("div",{className:"text-center p-3 bg-green-50 rounded-lg",children:[L.jsx("p",{className:"text-xl font-bold text-green-600",children:t.passedTests}),L.jsx("p",{className:"text-xs text-gray-600",children:"Passed Tests"})]}),L.jsxs("div",{className:"text-center p-3 bg-blue-50 rounded-lg",children:[L.jsx("p",{className:"text-xl font-bold text-blue-600",children:t.totalAttempts}),L.jsx("p",{className:"text-xs text-gray-600",children:"Total Attempts"})]})]})]}),L.jsxs(As,{children:[L.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Test Performance Trend"}),L.jsx("div",{className:"h-64",children:L.jsx(h,{width:"100%",height:"100%",children:L.jsxs(_,{data:t.completedTests.map((e,s)=>({attempt:s+1,score:e.score,name:e.surveyTitle.substring(0,10)+"..."})),children:[L.jsx(g,{strokeDasharray:"3 3"}),L.jsx(j,{dataKey:"attempt"}),L.jsx(y,{domain:[0,100]}),L.jsx(f,{formatter:e=>[`${e}%`,"Score"]}),L.jsx(S,{type:"monotone",dataKey:"score",stroke:"#3B82F6",strokeWidth:2})]})})})]})]}),t.upcomingTests.filter(e=>e.daysLeft<=7).length>0&&L.jsxs(As,{className:"mb-8 border-l-4 border-orange-500 bg-orange-50",children:[L.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[L.jsx(oe,{className:"w-6 h-6 text-orange-600"}),L.jsx("h3",{className:"text-lg font-semibold text-orange-900",children:"Urgent: Tests Due Soon"})]}),L.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:t.upcomingTests.filter(e=>e.daysLeft<=7).map(e=>L.jsxs("div",{className:"bg-white rounded-lg p-4 border border-orange-200",children:[L.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:e.title}),L.jsxs("div",{className:"space-y-1 text-sm",children:[L.jsxs("p",{className:"text-gray-600",children:[L.jsx(fe,{className:"w-4 h-4 inline mr-1"}),"Due: ",gs(e.targetDate)]}),L.jsx("p",{className:"font-medium "+(e.isOverdue?"text-red-600":"text-orange-600"),children:e.isOverdue?"OVERDUE":`${e.daysLeft} days left`})]})]},e.surveyId))})]}),L.jsxs(As,{children:[L.jsx("div",{className:"border-b border-gray-200 mb-6",children:L.jsxs("nav",{className:"-mb-px flex space-x-8",children:[L.jsxs("button",{onClick:()=>p("overview"),className:"py-2 px-1 border-b-2 font-medium text-sm "+("overview"===u?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:[L.jsx(_e,{className:"w-4 h-4 inline mr-2"}),"Overview"]}),L.jsxs("button",{onClick:()=>p("available"),className:"py-2 px-1 border-b-2 font-medium text-sm "+("available"===u?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:[L.jsx(ge,{className:"w-4 h-4 inline mr-2"}),"Available Tests (",t.availableTests.length,")"]}),L.jsxs("button",{onClick:()=>p("results"),className:"py-2 px-1 border-b-2 font-medium text-sm "+("results"===u?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:[L.jsx(ts,{className:"w-4 h-4 inline mr-2"}),"My Results (",t.completedTests.length,")"]}),L.jsxs("button",{onClick:()=>p("certificates"),className:"py-2 px-1 border-b-2 font-medium text-sm "+("certificates"===u?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:[L.jsx(as,{className:"w-4 h-4 inline mr-2"}),"My Certificates (",t.certificates.length,")"]})]})}),"overview"===u&&L.jsx("div",{className:"space-y-6",children:L.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[L.jsxs("div",{children:[L.jsx("h4",{className:"font-semibold text-gray-900 mb-4",children:"Quick Stats"}),L.jsxs("div",{className:"space-y-3",children:[L.jsxs("div",{className:"flex justify-between items-center p-3 bg-blue-50 rounded-lg",children:[L.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Tests Available"}),L.jsx("span",{className:"text-lg font-bold text-blue-600",children:t.availableTests.length})]}),L.jsxs("div",{className:"flex justify-between items-center p-3 bg-green-50 rounded-lg",children:[L.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Tests Passed"}),L.jsx("span",{className:"text-lg font-bold text-green-600",children:t.passedTests})]}),L.jsxs("div",{className:"flex justify-between items-center p-3 bg-yellow-50 rounded-lg",children:[L.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Average Score"}),L.jsxs("span",{className:"text-lg font-bold text-yellow-600",children:[t.averageScore.toFixed(1),"%"]})]}),L.jsxs("div",{className:"flex justify-between items-center p-3 bg-purple-50 rounded-lg",children:[L.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Certificates Earned"}),L.jsx("span",{className:"text-lg font-bold text-purple-600",children:t.certificates.length})]})]})]}),L.jsxs("div",{children:[L.jsx("h4",{className:"font-semibold text-gray-900 mb-4",children:"Recent Activity"}),L.jsx("div",{className:"space-y-3",children:t.completedTests.slice(0,3).map(e=>L.jsxs("div",{className:"flex items-center space-x-3 p-3 bg-gray-50 rounded-lg",children:[L.jsx("div",{className:"w-3 h-3 rounded-full "+(e.isPassed?"bg-green-500":"bg-red-500")}),L.jsxs("div",{className:"flex-1",children:[L.jsx("p",{className:"text-sm font-medium text-gray-900",children:e.surveyTitle}),L.jsx("p",{className:"text-xs text-gray-500",children:gs(e.completedAt)})]}),L.jsxs("span",{className:"text-sm font-bold "+(e.isPassed?"text-green-600":"text-red-600"),children:[e.score,"%"]})]},e.resultId))})]})]})}),"available"===u&&L.jsxs("div",{className:"space-y-6",children:[L.jsx("div",{className:"flex items-center justify-between",children:L.jsxs("div",{className:"flex items-center space-x-4",children:[L.jsxs("div",{className:"relative",children:[L.jsx(Qe,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),L.jsx(Ns,{placeholder:"Search tests...",value:v,onChange:e=>b(e.target.value),className:"pl-10 w-64"})]}),L.jsxs("select",{value:N,onChange:e=>w(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[L.jsx("option",{value:"all",children:"All Tests"}),L.jsx("option",{value:"available",children:"Available"}),L.jsx("option",{value:"urgent",children:"Urgent (Due Soon)"}),L.jsx("option",{value:"overdue",children:"Overdue"})]})]})}),L.jsx("div",{className:"space-y-4",children:D.map(e=>L.jsx("div",{className:"border border-gray-200 rounded-lg p-6 hover:shadow-md transition-shadow",children:L.jsxs("div",{className:"flex items-center justify-between mb-4",children:[L.jsxs("div",{className:"flex-1",children:[L.jsx("h4",{className:"text-lg font-semibold text-gray-900 mb-2",children:e.title}),L.jsx("p",{className:"text-gray-600 text-sm mb-3",children:e.description}),L.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[L.jsxs("div",{className:"flex items-center space-x-2",children:[L.jsx(fe,{className:"w-4 h-4 text-gray-400"}),L.jsxs("span",{children:["Due: ",gs(e.targetDate)]})]}),L.jsxs("div",{className:"flex items-center space-x-2",children:[L.jsx(be,{className:"w-4 h-4 text-gray-400"}),L.jsxs("span",{children:["Duration: ",ys(e.duration)]})]}),L.jsxs("div",{className:"flex items-center space-x-2",children:[L.jsx(Se,{className:"w-4 h-4 text-gray-400"}),L.jsxs("span",{children:[e.totalQuestions," Questions"]})]}),L.jsxs("div",{className:"flex items-center space-x-2",children:[L.jsx(He,{className:"w-4 h-4 text-gray-400"}),L.jsxs("span",{children:["Pass: ",e.passingScore,"%"]})]})]})]}),L.jsxs("div",{className:"flex items-center space-x-4",children:[L.jsxs("div",{className:"text-center",children:[L.jsx("span",{className:`inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ${A(e)}`,children:E(e)}),L.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[e.attemptsLeft,"/",e.maxAttempts," attempts left"]})]}),L.jsxs("div",{className:"flex flex-col space-y-2",children:[L.jsxs(bs,{onClick:()=>(e=>{l(e),o(!0)})(e),variant:"secondary",size:"sm",className:"flex items-center space-x-2",children:[L.jsx(_e,{className:"w-4 h-4"}),L.jsx("span",{children:"Details"})]}),L.jsxs(bs,{onClick:()=>k(e.surveyId),disabled:!e.isEligible||0===e.attemptsLeft||m,loading:m&&(null==r?void 0:r.surveyId)===e.surveyId,size:"sm",className:"flex items-center space-x-2",children:[L.jsx(Fe,{className:"w-4 h-4"}),L.jsx("span",{children:"Start Test"})]})]})]})]})},e.surveyId))})]}),"results"===u&&L.jsx("div",{className:"space-y-4",children:t.completedTests.map(e=>L.jsx("div",{className:"border border-gray-200 rounded-lg p-6",children:L.jsxs("div",{className:"flex items-center justify-between",children:[L.jsxs("div",{className:"flex-1",children:[L.jsx("h4",{className:"text-lg font-semibold text-gray-900 mb-2",children:e.surveyTitle}),L.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm text-gray-600",children:[L.jsxs("div",{children:[L.jsx("span",{className:"font-medium",children:"Score:"}),L.jsxs("span",{className:"ml-2 font-bold "+(e.score>=70?"text-green-600":"text-red-600"),children:[e.score,"%"]})]}),L.jsxs("div",{children:[L.jsx("span",{className:"font-medium",children:"Status:"}),L.jsx("span",{className:"ml-2 "+(e.isPassed?"text-green-600":"text-red-600"),children:e.isPassed?"Passed":"Failed"})]}),L.jsxs("div",{children:[L.jsx("span",{className:"font-medium",children:"Attempt:"}),L.jsx("span",{className:"ml-2",children:e.attemptNumber})]}),L.jsxs("div",{children:[L.jsx("span",{className:"font-medium",children:"Completed:"}),L.jsx("span",{className:"ml-2",children:gs(e.completedAt)})]})]})]}),L.jsxs("div",{className:"flex items-center space-x-4",children:[e.certificateId&&L.jsxs("div",{className:"flex items-center space-x-2 text-green-600",children:[L.jsx(ue,{className:"w-5 h-5"}),L.jsx("span",{className:"text-sm font-medium",children:"Certificate Earned"})]}),L.jsxs(bs,{variant:"secondary",size:"sm",children:[L.jsx(_e,{className:"w-4 h-4 mr-2"}),"View Details"]})]})]})},e.resultId))}),"certificates"===u&&L.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:t.certificates.map(e=>L.jsxs(As,{className:"hover:shadow-lg transition-shadow",children:[L.jsxs("div",{className:"text-center mb-4",children:[L.jsx("div",{className:"w-16 h-16 bg-yellow-100 rounded-full flex items-center justify-center mx-auto mb-3",children:L.jsx(ue,{className:"w-8 h-8 text-yellow-600"})}),L.jsx("h4",{className:"font-semibold text-gray-900",children:e.survey.title}),L.jsxs("p",{className:"text-sm text-gray-500",children:["Certificate #",e.certificateNumber]})]}),L.jsxs("div",{className:"space-y-2 text-sm text-gray-600 mb-4",children:[L.jsxs("p",{children:[L.jsx("span",{className:"font-medium",children:"Issued:"})," ",gs(e.issuedAt)]}),L.jsxs("p",{children:[L.jsx("span",{className:"font-medium",children:"Status:"}),L.jsx("span",{className:"ml-2 px-2 py-1 rounded-full text-xs "+("active"===e.status?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"),children:e.status.charAt(0).toUpperCase()+e.status.slice(1)})]})]}),L.jsxs(bs,{className:"w-full flex items-center justify-center space-x-2",children:[L.jsx(we,{className:"w-4 h-4"}),L.jsx("span",{children:"Download Certificate"})]})]},e.id))})]}),L.jsx(us,{isOpen:d,onClose:()=>o(!1),title:`Test Details: ${null==r?void 0:r.title}`,size:"lg",children:r&&L.jsxs("div",{className:"space-y-6",children:[L.jsxs("div",{children:[L.jsx("h4",{className:"font-semibold text-gray-900 mb-2",children:"Description"}),L.jsx("p",{className:"text-gray-600",children:r.description})]}),L.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[L.jsxs("div",{children:[L.jsx("h4",{className:"font-semibold text-gray-900 mb-3",children:"Test Information"}),L.jsxs("div",{className:"space-y-2 text-sm",children:[L.jsxs("p",{children:[L.jsx("span",{className:"font-medium",children:"Duration:"})," ",ys(r.duration)]}),L.jsxs("p",{children:[L.jsx("span",{className:"font-medium",children:"Questions:"})," ",r.totalQuestions]}),L.jsxs("p",{children:[L.jsx("span",{className:"font-medium",children:"Passing Score:"})," ",r.passingScore,"%"]}),L.jsxs("p",{children:[L.jsx("span",{className:"font-medium",children:"Target Date:"})," ",gs(r.targetDate)]})]})]}),L.jsxs("div",{children:[L.jsx("h4",{className:"font-semibold text-gray-900 mb-3",children:"Attempt Information"}),L.jsxs("div",{className:"space-y-2 text-sm",children:[L.jsxs("p",{children:[L.jsx("span",{className:"font-medium",children:"Attempts Left:"})," ",r.attemptsLeft,"/",r.maxAttempts]}),L.jsxs("p",{children:[L.jsx("span",{className:"font-medium",children:"Eligibility:"}),L.jsx("span",{className:"ml-2 "+(r.isEligible?"text-green-600":"text-red-600"),children:r.isEligible?"Eligible":"Not Eligible"})]})]})]})]}),L.jsxs("div",{className:"flex justify-end space-x-3 pt-4 border-t",children:[L.jsx(bs,{variant:"secondary",onClick:()=>o(!1),children:"Close"}),L.jsxs(bs,{onClick:()=>{k(r.surveyId)},disabled:!r.isEligible||0===r.attemptsLeft||m,loading:m&&(null==r?void 0:r.surveyId)===r.surveyId,className:"flex items-center space-x-2",children:[L.jsx(Fe,{className:"w-4 h-4"}),L.jsx("span",{children:"Start Test"})]})]})]})})]})}):L.jsx(Ms,{children:L.jsx("div",{className:"p-6",children:L.jsx("div",{className:"text-center text-gray-500",children:"Failed to load dashboard data"})})})}function Vs(){const[s,t]=e.useState([]),[a,r]=e.useState(null),[l,i]=e.useState(!0),[n,c]=e.useState(!1),[d,o]=e.useState(""),[m,x]=e.useState("30"),[u,_]=e.useState("all");e.useEffect(()=>{S()},[m]);const S=async()=>{try{i(!0);const e=await se.getDashboardData(m);e.success&&e.data&&t(e.data.teamPerformance)}catch(e){}finally{i(!1)}},C=e=>e>=90?"excellent":e>=80?"good":e>=60?"average":"poor",k=e=>{switch(e){case"excellent":return"bg-green-100 text-green-800";case"good":return"bg-blue-100 text-blue-800";case"average":return"bg-yellow-100 text-yellow-800";case"poor":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},A=s.filter(e=>{const s=e.teamName.toLowerCase().includes(d.toLowerCase()),t=C(e.passRate);return s&&("all"===u||t===u)}),E=["#3B82F6","#10B981","#F59E0B","#EF4444","#8B5CF6"],D={totalTeams:s.length,totalMembers:s.reduce((e,s)=>e+s.totalMembers,0),averagePassRate:s.reduce((e,s)=>e+s.passRate,0)/s.length||0,averageScore:s.reduce((e,s)=>e+s.averageScore,0)/s.length||0,topPerformingTeam:s.reduce((e,s)=>e.passRate>s.passRate?e:s,s[0]),lowPerformingTeam:s.reduce((e,s)=>e.passRate<s.passRate?e:s,s[0])};return L.jsx(Ms,{children:L.jsxs("div",{className:"p-6",children:[L.jsxs("div",{className:"flex items-center justify-between mb-8",children:[L.jsxs("div",{children:[L.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Team Results"}),L.jsx("p",{className:"text-gray-600 mt-2",children:"Comprehensive analysis of team performance and progress"})]}),L.jsxs("div",{className:"flex items-center space-x-3",children:[L.jsxs("select",{value:m,onChange:e=>x(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[L.jsx("option",{value:"7",children:"Last 7 days"}),L.jsx("option",{value:"30",children:"Last 30 days"}),L.jsx("option",{value:"90",children:"Last 3 months"}),L.jsx("option",{value:"365",children:"Last year"})]}),L.jsxs(bs,{className:"flex items-center space-x-2",children:[L.jsx(we,{className:"w-4 h-4"}),L.jsx("span",{children:"Export Report"})]})]})]}),L.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[L.jsx(As,{children:L.jsxs("div",{className:"flex items-center justify-between",children:[L.jsxs("div",{children:[L.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Teams"}),L.jsx("p",{className:"text-3xl font-bold text-blue-600",children:D.totalTeams})]}),L.jsx("div",{className:"p-3 rounded-full bg-blue-100",children:L.jsx(cs,{className:"w-6 h-6 text-blue-600"})})]})}),L.jsx(As,{children:L.jsxs("div",{className:"flex items-center justify-between",children:[L.jsxs("div",{children:[L.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Members"}),L.jsx("p",{className:"text-3xl font-bold text-green-600",children:D.totalMembers})]}),L.jsx("div",{className:"p-3 rounded-full bg-green-100",children:L.jsx(cs,{className:"w-6 h-6 text-green-600"})})]})}),L.jsx(As,{children:L.jsxs("div",{className:"flex items-center justify-between",children:[L.jsxs("div",{children:[L.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Avg Pass Rate"}),L.jsxs("p",{className:"text-3xl font-bold text-yellow-600",children:[D.averagePassRate.toFixed(1),"%"]})]}),L.jsx("div",{className:"p-3 rounded-full bg-yellow-100",children:L.jsx(He,{className:"w-6 h-6 text-yellow-600"})})]})}),L.jsx(As,{children:L.jsxs("div",{className:"flex items-center justify-between",children:[L.jsxs("div",{children:[L.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Avg Score"}),L.jsxs("p",{className:"text-3xl font-bold text-purple-600",children:[D.averageScore.toFixed(1),"%"]})]}),L.jsx("div",{className:"p-3 rounded-full bg-purple-100",children:L.jsx(ue,{className:"w-6 h-6 text-purple-600"})})]})})]}),L.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8",children:[L.jsxs(As,{children:[L.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Team Performance Comparison"}),L.jsx("div",{className:"h-64",children:L.jsx(h,{width:"100%",height:"100%",children:L.jsxs(p,{data:s,children:[L.jsx(g,{strokeDasharray:"3 3"}),L.jsx(j,{dataKey:"teamName"}),L.jsx(y,{}),L.jsx(f,{formatter:(e,s)=>["passRate"===s?`${e}%`:e,"passRate"===s?"Pass Rate":"Average Score"]}),L.jsx(v,{dataKey:"passRate",fill:"#3B82F6",name:"passRate"}),L.jsx(v,{dataKey:"averageScore",fill:"#10B981",name:"averageScore"})]})})})]}),L.jsxs(As,{children:[L.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Performance Distribution"}),L.jsx("div",{className:"h-64",children:L.jsx(h,{width:"100%",height:"100%",children:L.jsxs(b,{children:[L.jsx(N,{data:[{name:"Excellent (90%+)",value:s.filter(e=>e.passRate>=90).length},{name:"Good (80-89%)",value:s.filter(e=>e.passRate>=80&&e.passRate<90).length},{name:"Average (60-79%)",value:s.filter(e=>e.passRate>=60&&e.passRate<80).length},{name:"Poor (<60%)",value:s.filter(e=>e.passRate<60).length}],cx:"50%",cy:"50%",labelLine:!1,label:({name:e,value:s})=>`${e}: ${s}`,outerRadius:80,fill:"#8884d8",dataKey:"value",children:[0,1,2,3].map(e=>L.jsx(w,{fill:E[e%E.length]},`cell-${e}`))}),L.jsx(f,{})]})})})]})]}),L.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8",children:[L.jsxs(As,{children:[L.jsxs("div",{className:"flex items-center justify-between mb-4",children:[L.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Top Performing Teams"}),L.jsx(ts,{className:"w-5 h-5 text-green-600"})]}),L.jsx("div",{className:"space-y-3",children:s.sort((e,s)=>s.passRate-e.passRate).slice(0,3).map((e,s)=>L.jsxs("div",{className:"flex items-center justify-between p-3 bg-green-50 rounded-lg",children:[L.jsxs("div",{className:"flex items-center space-x-3",children:[L.jsx("div",{className:"w-8 h-8 bg-green-600 rounded-full flex items-center justify-center text-white font-bold text-sm",children:s+1}),L.jsxs("div",{children:[L.jsx("p",{className:"font-medium text-gray-900",children:e.teamName}),L.jsxs("p",{className:"text-sm text-gray-500",children:[e.totalMembers," members"]})]})]}),L.jsxs("div",{className:"text-right",children:[L.jsxs("p",{className:"font-bold text-green-600",children:[e.passRate.toFixed(1),"%"]}),L.jsx("p",{className:"text-sm text-gray-500",children:"Pass Rate"})]})]},e.teamId))})]}),L.jsxs(As,{children:[L.jsxs("div",{className:"flex items-center justify-between mb-4",children:[L.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Teams Needing Support"}),L.jsx(ss,{className:"w-5 h-5 text-red-600"})]}),L.jsx("div",{className:"space-y-3",children:s.sort((e,s)=>e.passRate-s.passRate).slice(0,3).map((e,s)=>L.jsxs("div",{className:"flex items-center justify-between p-3 bg-red-50 rounded-lg",children:[L.jsxs("div",{className:"flex items-center space-x-3",children:[L.jsx("div",{className:"w-8 h-8 bg-red-600 rounded-full flex items-center justify-center text-white font-bold text-sm",children:s+1}),L.jsxs("div",{children:[L.jsx("p",{className:"font-medium text-gray-900",children:e.teamName}),L.jsxs("p",{className:"text-sm text-gray-500",children:[e.totalMembers," members"]})]})]}),L.jsxs("div",{className:"text-right",children:[L.jsxs("p",{className:"font-bold text-red-600",children:[e.passRate.toFixed(1),"%"]}),L.jsx("p",{className:"text-sm text-gray-500",children:"Pass Rate"})]})]},e.teamId))})]})]}),L.jsx(As,{className:"mb-6",children:L.jsx("div",{className:"flex items-center justify-between",children:L.jsxs("div",{className:"flex items-center space-x-4",children:[L.jsx("div",{className:"relative",children:L.jsx(Ns,{placeholder:"Search teams...",value:d,onChange:e=>o(e.target.value),className:"w-64"})}),L.jsxs("select",{value:u,onChange:e=>_(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[L.jsx("option",{value:"all",children:"All Performance Levels"}),L.jsx("option",{value:"excellent",children:"Excellent (90%+)"}),L.jsx("option",{value:"good",children:"Good (80-89%)"}),L.jsx("option",{value:"average",children:"Average (60-79%)"}),L.jsx("option",{value:"poor",children:"Poor (0-60%)"})]})]})})}),L.jsxs(As,{children:[L.jsx("div",{className:"flex items-center justify-between mb-6",children:L.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Detailed Team Results"})}),l?L.jsxs("div",{className:"text-center py-8",children:[L.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),L.jsx("p",{className:"text-gray-500 mt-2",children:"Loading team results..."})]}):L.jsx("div",{className:"space-y-4",children:A.map(e=>{const s=C(e.passRate);return L.jsxs("div",{className:"border border-gray-200 rounded-lg p-6 hover:shadow-md transition-shadow",children:[L.jsxs("div",{className:"flex items-center justify-between mb-4",children:[L.jsxs("div",{className:"flex items-center space-x-4",children:[L.jsx("div",{className:"w-12 h-12 bg-blue-600 rounded-full flex items-center justify-center",children:L.jsx(cs,{className:"w-6 h-6 text-white"})}),L.jsxs("div",{children:[L.jsx("h4",{className:"text-lg font-semibold text-gray-900",children:e.teamName}),L.jsxs("p",{className:"text-sm text-gray-500",children:["Team ID: ",e.teamId]})]})]}),L.jsxs("div",{className:"flex items-center space-x-6",children:[L.jsxs("div",{className:"text-center",children:[L.jsx("p",{className:"text-2xl font-bold text-blue-600",children:e.totalMembers}),L.jsx("p",{className:"text-sm text-gray-500",children:"Members"})]}),L.jsxs("div",{className:"text-center",children:[L.jsx("p",{className:"text-2xl font-bold text-green-600",children:e.completedTests}),L.jsx("p",{className:"text-sm text-gray-500",children:"Completed"})]}),L.jsxs("div",{className:"text-center",children:[L.jsxs("p",{className:`text-2xl font-bold ${vs(e.passRate)}`,children:[e.passRate.toFixed(1),"%"]}),L.jsx("p",{className:"text-sm text-gray-500",children:"Pass Rate"})]}),L.jsxs("div",{className:"text-center",children:[L.jsxs("p",{className:`text-2xl font-bold ${vs(e.averageScore)}`,children:[e.averageScore.toFixed(1),"%"]}),L.jsx("p",{className:"text-sm text-gray-500",children:"Avg Score"})]}),L.jsx("div",{className:"text-center",children:L.jsx("span",{className:`inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ${k(s)}`,children:s.charAt(0).toUpperCase()+s.slice(1)})}),L.jsxs(bs,{variant:"secondary",size:"sm",onClick:()=>(e=>{r(e),c(!0)})(e),className:"flex items-center space-x-2",children:[L.jsx(_e,{className:"w-4 h-4"}),L.jsx("span",{children:"View Details"})]})]})]}),L.jsxs("div",{className:"mt-4",children:[L.jsxs("div",{className:"flex items-center justify-between mb-2",children:[L.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Team Progress"}),L.jsxs("span",{className:"text-sm text-gray-500",children:[(e.completedTests/e.totalMembers*100).toFixed(1),"%"]})]}),L.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:L.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:e.completedTests/e.totalMembers*100+"%"}})})]})]},e.teamId)})})]}),L.jsx(us,{isOpen:n,onClose:()=>c(!1),title:`Team Details: ${null==a?void 0:a.teamName}`,size:"xl",children:a&&L.jsxs("div",{className:"space-y-6",children:[L.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[L.jsxs("div",{className:"text-center p-4 bg-blue-50 rounded-lg",children:[L.jsx("p",{className:"text-2xl font-bold text-blue-600",children:a.totalMembers}),L.jsx("p",{className:"text-sm text-gray-600",children:"Total Members"})]}),L.jsxs("div",{className:"text-center p-4 bg-green-50 rounded-lg",children:[L.jsx("p",{className:"text-2xl font-bold text-green-600",children:a.completedTests}),L.jsx("p",{className:"text-sm text-gray-600",children:"Completed Tests"})]}),L.jsxs("div",{className:"text-center p-4 bg-yellow-50 rounded-lg",children:[L.jsxs("p",{className:"text-2xl font-bold text-yellow-600",children:[a.passRate.toFixed(1),"%"]}),L.jsx("p",{className:"text-sm text-gray-600",children:"Pass Rate"})]}),L.jsxs("div",{className:"text-center p-4 bg-purple-50 rounded-lg",children:[L.jsxs("p",{className:"text-2xl font-bold text-purple-600",children:[a.averageScore.toFixed(1),"%"]}),L.jsx("p",{className:"text-sm text-gray-600",children:"Average Score"})]})]}),L.jsxs("div",{children:[L.jsx("h4",{className:"font-semibold text-gray-900 mb-4",children:"Team Members Performance"}),L.jsx("div",{className:"space-y-3 max-h-64 overflow-y-auto",children:a.members.map(e=>L.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[L.jsxs("div",{className:"flex items-center justify-between mb-3",children:[L.jsxs("div",{children:[L.jsx("p",{className:"font-medium text-gray-900",children:e.user.name}),L.jsx("p",{className:"text-sm text-gray-500",children:e.user.email})]}),L.jsxs("div",{className:"text-right",children:[L.jsxs("p",{className:"text-sm font-medium text-gray-900",children:[e.overallProgress,"% Complete"]}),L.jsxs("p",{className:"text-xs text-gray-500",children:[e.totalCertificates," certificates"]})]})]}),L.jsxs("div",{className:"grid grid-cols-3 gap-4 text-sm",children:[L.jsxs("div",{children:[L.jsx("p",{className:"text-gray-500",children:"Surveys"}),L.jsx("p",{className:"font-medium",children:e.surveys.length})]}),L.jsxs("div",{children:[L.jsx("p",{className:"text-gray-500",children:"Completed"}),L.jsx("p",{className:"font-medium",children:e.surveys.filter(e=>"completed"===e.status).length})]}),L.jsxs("div",{children:[L.jsx("p",{className:"text-gray-500",children:"Best Score"}),L.jsx("p",{className:"font-medium",children:e.surveys.length>0?Math.max(...e.surveys.map(e=>e.bestScore||0)).toFixed(1)+"%":"N/A"})]})]})]},e.id))})]})]})})]})})}function Ks(){const[s,t]=e.useState([]),[a,r]=e.useState(null),[l,i]=e.useState(!0),[n,c]=e.useState(!1),[d,o]=e.useState(""),[m,x]=e.useState("all"),[u,b]=e.useState("all");e.useEffect(()=>{N()},[]);const N=async()=>{try{i(!0);const e=await se.getDashboardData("30");e.success&&e.data&&t(e.data.enumeratorStatus)}catch(e){}finally{i(!1)}},w=e=>{switch(e){case"completed":return L.jsx(ve,{className:"w-4 h-4 text-green-600"});case"in_progress":return L.jsx(be,{className:"w-4 h-4 text-yellow-600"});case"failed":return L.jsx(ms,{className:"w-4 h-4 text-red-600"});case"expired":return L.jsx(oe,{className:"w-4 h-4 text-orange-600"});default:return L.jsx(be,{className:"w-4 h-4 text-gray-600"})}},_=e=>{switch(e){case"completed":return"bg-green-100 text-green-800";case"in_progress":return"bg-yellow-100 text-yellow-800";case"failed":return"bg-red-100 text-red-800";case"expired":return"bg-orange-100 text-orange-800";default:return"bg-gray-100 text-gray-800"}},S=e=>{const s=e.surveys.length,t=e.surveys.filter(e=>"completed"===e.status).length,a=e.surveys.filter(e=>"failed"===e.status).length,r=e.surveys.filter(e=>"expired"===e.status).length;return t===s?"excellent":a>0||r>0?"needs_attention":t>s/2?"good":"poor"},C=s.filter(e=>{const s=e.user.name.toLowerCase().includes(d.toLowerCase())||e.user.email.toLowerCase().includes(d.toLowerCase()),t=S(e),a="all"===m||t===m;let r=!0;if("all"!==u)switch(u){case"completed":r=100===e.overallProgress;break;case"in_progress":r=e.overallProgress>0&&e.overallProgress<100;break;case"not_started":r=0===e.overallProgress}return s&&a&&r}),k={totalEnumerators:s.length,completedAll:s.filter(e=>100===e.overallProgress).length,inProgress:s.filter(e=>e.overallProgress>0&&e.overallProgress<100).length,notStarted:s.filter(e=>0===e.overallProgress).length,averageProgress:s.reduce((e,s)=>e+s.overallProgress,0)/s.length||0,totalCertificates:s.reduce((e,s)=>e+s.totalCertificates,0)};return L.jsx(Ms,{children:L.jsxs("div",{className:"p-6",children:[L.jsxs("div",{className:"flex items-center justify-between mb-8",children:[L.jsxs("div",{children:[L.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"My Enumerators"}),L.jsx("p",{className:"text-gray-600 mt-2",children:"Manage and monitor your team members' progress"})]}),L.jsxs("div",{className:"flex items-center space-x-3",children:[L.jsxs(bs,{variant:"secondary",className:"flex items-center space-x-2",children:[L.jsx(Ce,{className:"w-4 h-4"}),L.jsx("span",{children:"Advanced Filters"})]}),L.jsxs(bs,{className:"flex items-center space-x-2",children:[L.jsx(we,{className:"w-4 h-4"}),L.jsx("span",{children:"Export Report"})]})]})]}),L.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-6 gap-6 mb-8",children:[L.jsx(As,{children:L.jsxs("div",{className:"flex items-center justify-between",children:[L.jsxs("div",{children:[L.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total"}),L.jsx("p",{className:"text-3xl font-bold text-blue-600",children:k.totalEnumerators})]}),L.jsx("div",{className:"p-3 rounded-full bg-blue-100",children:L.jsx(ns,{className:"w-6 h-6 text-blue-600"})})]})}),L.jsx(As,{children:L.jsxs("div",{className:"flex items-center justify-between",children:[L.jsxs("div",{children:[L.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Completed"}),L.jsx("p",{className:"text-3xl font-bold text-green-600",children:k.completedAll})]}),L.jsx("div",{className:"p-3 rounded-full bg-green-100",children:L.jsx(ve,{className:"w-6 h-6 text-green-600"})})]})}),L.jsx(As,{children:L.jsxs("div",{className:"flex items-center justify-between",children:[L.jsxs("div",{children:[L.jsx("p",{className:"text-sm font-medium text-gray-600",children:"In Progress"}),L.jsx("p",{className:"text-3xl font-bold text-yellow-600",children:k.inProgress})]}),L.jsx("div",{className:"p-3 rounded-full bg-yellow-100",children:L.jsx(be,{className:"w-6 h-6 text-yellow-600"})})]})}),L.jsx(As,{children:L.jsxs("div",{className:"flex items-center justify-between",children:[L.jsxs("div",{children:[L.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Not Started"}),L.jsx("p",{className:"text-3xl font-bold text-red-600",children:k.notStarted})]}),L.jsx("div",{className:"p-3 rounded-full bg-red-100",children:L.jsx(oe,{className:"w-6 h-6 text-red-600"})})]})}),L.jsx(As,{children:L.jsxs("div",{className:"flex items-center justify-between",children:[L.jsxs("div",{children:[L.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Avg Progress"}),L.jsxs("p",{className:"text-3xl font-bold text-purple-600",children:[k.averageProgress.toFixed(1),"%"]})]}),L.jsx("div",{className:"p-3 rounded-full bg-purple-100",children:L.jsx(He,{className:"w-6 h-6 text-purple-600"})})]})}),L.jsx(As,{children:L.jsxs("div",{className:"flex items-center justify-between",children:[L.jsxs("div",{children:[L.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Certificates"}),L.jsx("p",{className:"text-3xl font-bold text-indigo-600",children:k.totalCertificates})]}),L.jsx("div",{className:"p-3 rounded-full bg-indigo-100",children:L.jsx(ue,{className:"w-6 h-6 text-indigo-600"})})]})})]}),L.jsxs(As,{className:"mb-8",children:[L.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Team Progress Overview"}),L.jsx("div",{className:"h-64",children:L.jsx(h,{width:"100%",height:"100%",children:L.jsxs(p,{data:s.map(e=>({name:e.user.name.split(" ")[0],progress:e.overallProgress,certificates:e.totalCertificates})),children:[L.jsx(g,{strokeDasharray:"3 3"}),L.jsx(j,{dataKey:"name"}),L.jsx(y,{}),L.jsx(f,{formatter:(e,s)=>["progress"===s?`${e}%`:e,"progress"===s?"Progress":"Certificates"]}),L.jsx(v,{dataKey:"progress",fill:"#3B82F6",name:"progress"}),L.jsx(v,{dataKey:"certificates",fill:"#10B981",name:"certificates"})]})})})]}),L.jsx(As,{className:"mb-6",children:L.jsx("div",{className:"flex items-center justify-between",children:L.jsxs("div",{className:"flex items-center space-x-4",children:[L.jsxs("div",{className:"relative",children:[L.jsx(Qe,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),L.jsx(Ns,{placeholder:"Search enumerators...",value:d,onChange:e=>o(e.target.value),className:"pl-10 w-64"})]}),L.jsxs("select",{value:m,onChange:e=>x(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[L.jsx("option",{value:"all",children:"All Status"}),L.jsx("option",{value:"excellent",children:"Excellent"}),L.jsx("option",{value:"good",children:"Good"}),L.jsx("option",{value:"needs_attention",children:"Needs Attention"}),L.jsx("option",{value:"poor",children:"Poor"})]}),L.jsxs("select",{value:u,onChange:e=>b(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[L.jsx("option",{value:"all",children:"All Progress"}),L.jsx("option",{value:"completed",children:"Completed (100%)"}),L.jsx("option",{value:"in_progress",children:"In Progress"}),L.jsx("option",{value:"not_started",children:"Not Started"})]})]})})}),L.jsx(As,{children:l?L.jsxs("div",{className:"text-center py-8",children:[L.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),L.jsx("p",{className:"text-gray-500 mt-2",children:"Loading enumerators..."})]}):L.jsx("div",{className:"space-y-4",children:C.map(e=>{const s=S(e),t=e.surveys.filter(e=>"completed"===e.status).length,a=e.surveys.length;return L.jsxs("div",{className:"border border-gray-200 rounded-lg p-6 hover:shadow-md transition-shadow",children:[L.jsxs("div",{className:"flex items-center justify-between",children:[L.jsxs("div",{className:"flex items-center space-x-4",children:[L.jsx("div",{className:"w-16 h-16 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full flex items-center justify-center",children:L.jsx(ns,{className:"w-8 h-8 text-white"})}),L.jsxs("div",{children:[L.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:e.user.name}),L.jsxs("div",{className:"flex items-center space-x-4 text-sm text-gray-500 mt-1",children:[L.jsxs("div",{className:"flex items-center space-x-1",children:[L.jsx(Pe,{className:"w-4 h-4"}),L.jsx("span",{children:e.user.email})]}),e.user.phoneNumber&&L.jsxs("div",{className:"flex items-center space-x-1",children:[L.jsx(Ue,{className:"w-4 h-4"}),L.jsx("span",{children:e.user.phoneNumber})]}),e.user.jurisdiction&&L.jsxs("div",{className:"flex items-center space-x-1",children:[L.jsx(Oe,{className:"w-4 h-4"}),L.jsx("span",{children:e.user.jurisdiction})]})]}),L.jsxs("p",{className:"text-xs text-gray-400 mt-1",children:["Employee ID: ",e.user.employeeId||"N/A"]})]})]}),L.jsxs("div",{className:"flex items-center space-x-6",children:[L.jsxs("div",{className:"text-center",children:[L.jsxs("p",{className:"text-2xl font-bold text-blue-600",children:[e.overallProgress,"%"]}),L.jsx("p",{className:"text-sm text-gray-500",children:"Progress"})]}),L.jsxs("div",{className:"text-center",children:[L.jsxs("p",{className:"text-2xl font-bold text-green-600",children:[t,"/",a]}),L.jsx("p",{className:"text-sm text-gray-500",children:"Completed"})]}),L.jsxs("div",{className:"text-center",children:[L.jsx("p",{className:"text-2xl font-bold text-purple-600",children:e.totalCertificates}),L.jsx("p",{className:"text-sm text-gray-500",children:"Certificates"})]}),L.jsx("div",{className:"text-center",children:L.jsx("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium "+("excellent"===s?"bg-green-100 text-green-800":"good"===s?"bg-blue-100 text-blue-800":"needs_attention"===s?"bg-orange-100 text-orange-800":"bg-red-100 text-red-800"),children:"excellent"===s?"Excellent":"good"===s?"Good":"needs_attention"===s?"Needs Attention":"Poor"})}),L.jsxs(bs,{variant:"secondary",size:"sm",onClick:()=>(e=>{r(e),c(!0)})(e),className:"flex items-center space-x-2",children:[L.jsx(_e,{className:"w-4 h-4"}),L.jsx("span",{children:"View Details"})]})]})]}),L.jsxs("div",{className:"mt-4",children:[L.jsxs("div",{className:"flex items-center justify-between mb-2",children:[L.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Overall Progress"}),L.jsxs("span",{className:"text-sm text-gray-500",children:[e.overallProgress,"%"]})]}),L.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:L.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:`${e.overallProgress}%`}})})]}),L.jsxs("div",{className:"mt-4 flex flex-wrap gap-2",children:[e.surveys.slice(0,4).map(e=>L.jsxs("div",{className:"flex items-center space-x-2",children:[w(e.status),L.jsx("span",{className:"text-sm text-gray-600",children:e.surveyTitle})]},e.surveyId)),e.surveys.length>4&&L.jsxs("span",{className:"text-sm text-gray-500",children:["+",e.surveys.length-4," more"]})]}),L.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-100 flex items-center justify-between text-sm text-gray-500",children:[L.jsxs("span",{children:["Last Activity: ",js(e.lastActivity)]}),L.jsxs("div",{className:"flex items-center space-x-4",children:[L.jsxs("span",{children:["Surveys: ",e.surveys.length]}),L.jsxs("span",{children:["Avg Score: ",e.surveys.length>0?(e.surveys.reduce((e,s)=>e+(s.bestScore||0),0)/e.surveys.length).toFixed(1)+"%":"N/A"]})]})]})]},e.id)})})}),L.jsx(us,{isOpen:n,onClose:()=>c(!1),title:`Enumerator Details: ${null==a?void 0:a.user.name}`,size:"xl",children:a&&L.jsxs("div",{className:"space-y-6",children:[L.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[L.jsxs("div",{children:[L.jsx("h4",{className:"font-semibold text-gray-900 mb-3",children:"Personal Information"}),L.jsxs("div",{className:"space-y-2 text-sm",children:[L.jsxs("p",{children:[L.jsx("span",{className:"font-medium",children:"Name:"})," ",a.user.name]}),L.jsxs("p",{children:[L.jsx("span",{className:"font-medium",children:"Email:"})," ",a.user.email]}),L.jsxs("p",{children:[L.jsx("span",{className:"font-medium",children:"Phone:"})," ",a.user.phoneNumber||"N/A"]}),L.jsxs("p",{children:[L.jsx("span",{className:"font-medium",children:"Employee ID:"})," ",a.user.employeeId||"N/A"]}),L.jsxs("p",{children:[L.jsx("span",{className:"font-medium",children:"Role:"})," ",a.user.role.name]}),L.jsxs("p",{children:[L.jsx("span",{className:"font-medium",children:"Jurisdiction:"})," ",a.user.jurisdiction||"N/A"]}),L.jsxs("p",{children:[L.jsx("span",{className:"font-medium",children:"Last Activity:"})," ",js(a.lastActivity)]})]})]}),L.jsxs("div",{children:[L.jsx("h4",{className:"font-semibold text-gray-900 mb-3",children:"Performance Summary"}),L.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[L.jsxs("div",{className:"text-center p-3 bg-blue-50 rounded-lg",children:[L.jsxs("p",{className:"text-xl font-bold text-blue-600",children:[a.overallProgress,"%"]}),L.jsx("p",{className:"text-xs text-gray-600",children:"Overall Progress"})]}),L.jsxs("div",{className:"text-center p-3 bg-purple-50 rounded-lg",children:[L.jsx("p",{className:"text-xl font-bold text-purple-600",children:a.totalCertificates}),L.jsx("p",{className:"text-xs text-gray-600",children:"Certificates"})]}),L.jsxs("div",{className:"text-center p-3 bg-green-50 rounded-lg",children:[L.jsx("p",{className:"text-xl font-bold text-green-600",children:a.surveys.filter(e=>"completed"===e.status).length}),L.jsx("p",{className:"text-xs text-gray-600",children:"Completed"})]}),L.jsxs("div",{className:"text-center p-3 bg-yellow-50 rounded-lg",children:[L.jsx("p",{className:"text-xl font-bold text-yellow-600",children:a.surveys.length>0?(a.surveys.reduce((e,s)=>e+(s.bestScore||0),0)/a.surveys.length).toFixed(1)+"%":"N/A"}),L.jsx("p",{className:"text-xs text-gray-600",children:"Avg Score"})]})]})]})]}),L.jsxs("div",{children:[L.jsx("h4",{className:"font-semibold text-gray-900 mb-4",children:"Survey Status"}),L.jsx("div",{className:"space-y-3",children:a.surveys.map(e=>L.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[L.jsxs("div",{className:"flex items-center justify-between mb-3",children:[L.jsxs("div",{className:"flex items-center space-x-3",children:[w(e.status),L.jsx("h5",{className:"font-medium text-gray-900",children:e.surveyTitle})]}),L.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${_(e.status)}`,children:e.status.replace("_"," ").toUpperCase()})]}),L.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[L.jsxs("div",{children:[L.jsx("p",{className:"text-gray-500",children:"Attempts"}),L.jsxs("p",{className:"font-medium",children:[e.attempts,"/",e.maxAttempts]})]}),L.jsxs("div",{children:[L.jsx("p",{className:"text-gray-500",children:"Best Score"}),L.jsx("p",{className:"font-medium",children:e.bestScore?`${e.bestScore}%`:"N/A"})]}),L.jsxs("div",{children:[L.jsx("p",{className:"text-gray-500",children:"Target Date"}),L.jsx("p",{className:"font-medium",children:gs(e.targetDate)})]}),L.jsxs("div",{children:[L.jsx("p",{className:"text-gray-500",children:"Last Attempt"}),L.jsx("p",{className:"font-medium",children:e.lastAttempt?gs(e.lastAttempt):"Never"})]})]}),e.certificateId&&L.jsxs("div",{className:"mt-3 flex items-center space-x-2 text-green-600",children:[L.jsx(ue,{className:"w-4 h-4"}),L.jsx("span",{className:"text-sm font-medium",children:"Certificate Earned"})]})]},e.surveyId))})]}),L.jsxs("div",{className:"flex justify-end space-x-3 pt-4 border-t",children:[L.jsx(bs,{variant:"secondary",onClick:()=>c(!1),children:"Close"}),L.jsxs(bs,{className:"flex items-center space-x-2",children:[L.jsx(we,{className:"w-4 h-4"}),L.jsx("span",{children:"Export Individual Report"})]})]})]})})]})})}function Ws(){const[s,t]=e.useState([]),[a,r]=e.useState([]),[l,i]=e.useState(!0),[n,c]=e.useState(!1),[d,o]=e.useState(!1),[m,x]=e.useState(""),[u,h]=e.useState(!1),[p,g]=e.useState(!1),[j,y]=e.useState(null),[f,v]=e.useState(""),[b,N]=e.useState({name:"",email:"",roleId:"",password:""}),[w,_]=e.useState({name:"",email:"",password:"",roleId:"",jurisdiction:"",zone:"",region:"",district:"",employeeId:"",phoneNumber:""});e.useEffect(()=>{S(),C()},[]);const S=async()=>{try{i(!0);const e=await K.getUsers();t(e.data||[]),e.data&&0!==e.data.length||e.success||v(e.message)}catch(e){v("Failed to load users. Please try again."),t([])}finally{i(!1)}},C=async()=>{try{const e=await W.getRoles();r(e.data||[])}catch(e){r([])}},k=()=>{_({name:"",email:"",password:"",roleId:"",jurisdiction:"",zone:"",region:"",district:"",employeeId:"",phoneNumber:""}),y(null)},A=s.filter(e=>e.name.toLowerCase().includes(m.toLowerCase())||e.email.toLowerCase().includes(m.toLowerCase())||e.role.name.toLowerCase().includes(m.toLowerCase()));return L.jsx(Ms,{children:L.jsxs("div",{className:"p-6",children:[L.jsxs("div",{className:"flex items-center justify-between mb-6",children:[L.jsxs("div",{children:[L.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"User Management"}),L.jsx("p",{className:"text-gray-600 mt-2",children:"Manage system users and their roles"})]}),L.jsxs(bs,{onClick:()=>h(!0),className:"flex items-center space-x-2",children:[L.jsx(ze,{className:"w-4 h-4"}),L.jsx("span",{children:"Add User"})]})]}),L.jsxs(As,{children:[L.jsxs("div",{className:"mb-6",children:[f&&L.jsx("div",{className:"mb-4 p-4 bg-red-50 border border-red-200 rounded-lg",children:L.jsx("p",{className:"text-red-700 text-sm",children:f})}),L.jsxs("div",{className:"relative",children:[L.jsx(Qe,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),L.jsx(Ns,{placeholder:"Search users...",value:m,onChange:e=>x(e.target.value),className:"pl-10"})]})]}),l?L.jsxs("div",{className:"text-center py-8",children:[L.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),L.jsx("p",{className:"text-gray-500 mt-2",children:"Loading users..."})]}):0===A.length?L.jsxs("div",{className:"text-center py-12",children:[L.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4",children:L.jsx(ze,{className:"w-8 h-8 text-gray-400"})}),L.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Users Found"}),L.jsx("p",{className:"text-gray-500 mb-4",children:0===s.length?"No users exist in the system yet. Get started by creating your first user or initializing the database.":"No users match your search criteria."}),0===s.length&&L.jsxs("div",{className:"space-y-2",children:[L.jsxs(bs,{onClick:()=>h(!0),className:"flex items-center space-x-2",children:[L.jsx(ze,{className:"w-4 h-4"}),L.jsx("span",{children:"Create First User"})]}),L.jsxs("p",{className:"text-sm text-gray-500",children:["Or go to the ",L.jsx("a",{href:"/login",className:"text-blue-600 hover:text-blue-700",children:"login page"})," to initialize the database"]})]})]}):L.jsx("div",{className:"overflow-x-auto",children:L.jsxs("table",{className:"w-full",children:[L.jsx("thead",{children:L.jsxs("tr",{className:"border-b border-gray-200",children:[L.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-900",children:"User"}),L.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-900",children:"Role"}),L.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-900",children:"Jurisdiction"}),L.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-900",children:"Status"}),L.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-900",children:"Created"}),L.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-900",children:"Actions"})]})}),L.jsx("tbody",{children:A.map(e=>L.jsxs("tr",{className:"border-b border-gray-100 hover:bg-gray-50",children:[L.jsx("td",{className:"py-3 px-4",children:L.jsxs("div",{children:[L.jsx("p",{className:"font-medium text-gray-900",children:e.name}),L.jsx("p",{className:"text-sm text-gray-500",children:e.email})]})}),L.jsx("td",{className:"py-3 px-4",children:L.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:e.role.name})}),L.jsx("td",{className:"py-3 px-4 text-gray-900",children:e.jurisdiction||"N/A"}),L.jsx("td",{className:"py-3 px-4",children:L.jsxs("span",{className:"inline-flex items-center space-x-1 "+(e.isActive?"text-green-600":"text-red-600"),children:[e.isActive?L.jsx(ls,{className:"w-4 h-4"}):L.jsx(is,{className:"w-4 h-4"}),L.jsx("span",{className:"text-sm",children:e.isActive?"Active":"Inactive"})]})}),L.jsx("td",{className:"py-3 px-4 text-gray-500 text-sm",children:js(e.createdAt)}),L.jsx("td",{className:"py-3 px-4",children:L.jsxs("div",{className:"flex items-center space-x-2",children:[L.jsx("button",{onClick:()=>(e=>{y(e),_({name:e.name,email:e.email,password:"",roleId:e.roleId,jurisdiction:e.jurisdiction||"",zone:e.zone||"",region:e.region||"",district:e.district||"",employeeId:e.employeeId||"",phoneNumber:e.phoneNumber||""}),g(!0)})(e),className:"p-1 text-blue-600 hover:text-blue-700",title:"Edit User",children:L.jsx(Ke,{className:"w-4 h-4"})}),L.jsx("button",{onClick:()=>(async e=>{if(window.confirm("Are you sure you want to delete this user?"))try{(await K.deleteUser(e)).success&&t(s.filter(s=>s.id!==e))}catch(a){}})(e.id),className:"p-1 text-red-600 hover:text-red-700",children:L.jsx(es,{className:"w-4 h-4"})})]})})]},e.id))})]})})]}),L.jsx(us,{isOpen:u,onClose:()=>{h(!1),k()},title:"Create New User",size:"lg",children:L.jsxs("div",{className:"space-y-4",children:[L.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[L.jsx(Ns,{label:"Full Name *",value:w.name,onChange:e=>{_({...w,name:e.target.value}),b.name&&N({...b,name:""})},placeholder:"Enter full name",error:b.name}),L.jsx(Ns,{label:"Email Address *",type:"email",value:w.email,onChange:e=>{_({...w,email:e.target.value}),b.email&&N({...b,email:""})},placeholder:"Enter email address",error:b.email})]}),L.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[L.jsx(Ns,{label:"Password *",type:"password",value:w.password,onChange:e=>{_({...w,password:e.target.value}),b.password&&N({...b,password:""})},placeholder:"Enter password (min 6 characters)",error:b.password}),L.jsxs("div",{children:[L.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Password Strength"}),L.jsxs("div",{className:"text-sm text-gray-600",children:[0===w.password.length&&L.jsx("span",{className:"text-gray-400",children:"Enter a password"}),w.password.length>0&&w.password.length<6&&L.jsx("span",{className:"text-red-600",children:"Too short"}),w.password.length>=6&&w.password.length<8&&L.jsx("span",{className:"text-yellow-600",children:"Weak"}),w.password.length>=8&&!/[A-Z]/.test(w.password)&&L.jsx("span",{className:"text-yellow-600",children:"Add uppercase"}),w.password.length>=8&&/[A-Z]/.test(w.password)&&!/\d/.test(w.password)&&L.jsx("span",{className:"text-blue-600",children:"Add number"}),w.password.length>=8&&/[A-Z]/.test(w.password)&&/\d/.test(w.password)&&L.jsx("span",{className:"text-green-600",children:"Strong"})]})]})]}),L.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[L.jsxs("div",{children:[L.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Role *"}),L.jsxs("select",{value:w.roleId,onChange:e=>{_({...w,roleId:e.target.value}),b.roleId&&N({...b,roleId:""})},className:"block w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 "+(b.roleId?"border-red-300":"border-gray-300"),children:[L.jsx("option",{value:"",children:"Select role"}),a.map(e=>L.jsxs("option",{value:e.id,children:[e.name," (Level ",e.level,")"]},e.id))]}),b.roleId&&L.jsx("p",{className:"text-sm text-red-600 mt-1",children:b.roleId})]}),L.jsx(Ns,{label:"Employee ID",value:w.employeeId,onChange:e=>_({...w,employeeId:e.target.value}),placeholder:"Enter employee ID"})]}),L.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[L.jsx(Ns,{label:"Phone Number",value:w.phoneNumber,onChange:e=>_({...w,phoneNumber:e.target.value}),placeholder:"Enter phone number"}),L.jsx(Ns,{label:"Jurisdiction",value:w.jurisdiction,onChange:e=>_({...w,jurisdiction:e.target.value}),placeholder:"Enter jurisdiction"})]}),L.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[L.jsx(Ns,{label:"Zone",value:w.zone,onChange:e=>_({...w,zone:e.target.value}),placeholder:"e.g., North Zone, South Zone"}),L.jsx(Ns,{label:"Region",value:w.region,onChange:e=>_({...w,region:e.target.value}),placeholder:"e.g., Delhi Region, Mumbai Region"}),L.jsx(Ns,{label:"District",value:w.district,onChange:e=>_({...w,district:e.target.value}),placeholder:"Enter district"})]}),L.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[L.jsx("h4",{className:"font-medium text-yellow-900 mb-2",children:"Survey Assignment"}),L.jsx("p",{className:"text-sm text-yellow-800 mb-2",children:"To ensure the user can access tests, make sure their Zone and Region match the survey assignments:"}),L.jsxs("div",{className:"text-xs text-yellow-700 space-y-1",children:[L.jsxs("p",{children:[L.jsx("strong",{children:"Available Zones:"})," North Zone, South Zone, East Zone"]}),L.jsxs("p",{children:[L.jsx("strong",{children:"Available Regions:"})," Delhi Region, Mumbai Region, Kolkata Region"]}),L.jsxs("p",{children:[L.jsx("strong",{children:"Note:"})," Users without zone/region assignments can access all surveys"]})]})]}),L.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[L.jsx("h4",{className:"font-medium text-blue-900 mb-2",children:"Login Credentials"}),L.jsxs("p",{className:"text-sm text-blue-800",children:[L.jsx("strong",{children:"Password:"})," ",w.password||"Enter password above"," (user should change on first login)"]}),L.jsx("p",{className:"text-xs text-blue-700 mt-1",children:"The user will receive their login credentials and should change the password immediately."})]}),L.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[L.jsx(bs,{variant:"secondary",onClick:()=>{h(!1),k()},disabled:n,children:"Cancel"}),L.jsx(bs,{onClick:async()=>{if(v(""),!w.name.trim())return void v("Name is required");if(!w.email.trim())return void v("Email is required");if(!w.roleId)return void v("Role is required");if(!w.password.trim())return void v("Password is required");if(w.password.length<6)return void v("Password must be at least 6 characters long");if(/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(w.email))try{c(!0);const e=await K.createUser(w);e.success&&e.data?(t([...s,e.data]),h(!1),k(),alert(e.message)):v(e.message)}catch(e){v("Failed to create user. Please try again.")}finally{c(!1)}else v("Please enter a valid email address")},loading:n,disabled:n,children:n?"Creating User...":"Create User"})]})]})}),L.jsx(us,{isOpen:p,onClose:()=>{g(!1),k()},title:"Edit User",size:"lg",children:L.jsxs("div",{className:"space-y-4",children:[L.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[L.jsx(Ns,{label:"Full Name *",value:w.name,onChange:e=>{_({...w,name:e.target.value}),b.name&&N({...b,name:""})},placeholder:"Enter full name",error:b.name}),L.jsx(Ns,{label:"Email Address *",type:"email",value:w.email,onChange:e=>{_({...w,email:e.target.value}),b.email&&N({...b,email:""})},placeholder:"Enter email address",error:b.email})]}),L.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[L.jsx(Ns,{label:"New Password (leave empty to keep current)",type:"password",value:w.password,onChange:e=>{_({...w,password:e.target.value}),b.password&&N({...b,password:""})},placeholder:"Enter new password (optional)",error:b.password}),L.jsxs("div",{children:[L.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Password Strength"}),L.jsxs("div",{className:"text-sm text-gray-600",children:[0===w.password.length&&L.jsx("span",{className:"text-gray-400",children:"Password unchanged"}),w.password.length>0&&w.password.length<6&&L.jsx("span",{className:"text-red-600",children:"Too short"}),w.password.length>=6&&w.password.length<8&&L.jsx("span",{className:"text-yellow-600",children:"Weak"}),w.password.length>=8&&!/[A-Z]/.test(w.password)&&L.jsx("span",{className:"text-yellow-600",children:"Add uppercase"}),w.password.length>=8&&/[A-Z]/.test(w.password)&&!/\d/.test(w.password)&&L.jsx("span",{className:"text-blue-600",children:"Add number"}),w.password.length>=8&&/[A-Z]/.test(w.password)&&/\d/.test(w.password)&&L.jsx("span",{className:"text-green-600",children:"Strong"})]})]})]}),L.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[L.jsxs("div",{children:[L.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Role *"}),L.jsxs("select",{value:w.roleId,onChange:e=>{_({...w,roleId:e.target.value}),b.roleId&&N({...b,roleId:""})},className:"block w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 "+(b.roleId?"border-red-300":"border-gray-300"),children:[L.jsx("option",{value:"",children:"Select role"}),a.map(e=>L.jsxs("option",{value:e.id,children:[e.name," (Level ",e.level,")"]},e.id))]}),b.roleId&&L.jsx("p",{className:"text-sm text-red-600 mt-1",children:b.roleId})]}),L.jsx(Ns,{label:"Employee ID",value:w.employeeId,onChange:e=>_({...w,employeeId:e.target.value}),placeholder:"Enter employee ID"})]}),L.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[L.jsx(Ns,{label:"Phone Number",value:w.phoneNumber,onChange:e=>_({...w,phoneNumber:e.target.value}),placeholder:"Enter phone number"}),L.jsx(Ns,{label:"Jurisdiction",value:w.jurisdiction,onChange:e=>_({...w,jurisdiction:e.target.value}),placeholder:"Enter jurisdiction"})]}),L.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[L.jsx(Ns,{label:"Zone",value:w.zone,onChange:e=>_({...w,zone:e.target.value}),placeholder:"e.g., North Zone, South Zone"}),L.jsx(Ns,{label:"Region",value:w.region,onChange:e=>_({...w,region:e.target.value}),placeholder:"e.g., Delhi Region, Mumbai Region"}),L.jsx(Ns,{label:"District",value:w.district,onChange:e=>_({...w,district:e.target.value}),placeholder:"Enter district"})]}),L.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[L.jsx("h4",{className:"font-medium text-blue-900 mb-2",children:"Edit User Information"}),L.jsx("p",{className:"text-sm text-blue-800",children:"Update user details as needed. Leave password field empty to keep the current password unchanged."})]}),L.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[L.jsx(bs,{variant:"secondary",onClick:()=>{g(!1),k()},disabled:d,children:"Cancel"}),L.jsx(bs,{onClick:async()=>{if(v(""),!w.name.trim())return void v("Name is required");if(!w.email.trim())return void v("Email is required");if(!w.roleId)return void v("Role is required");if(/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(w.email)){if(j)try{o(!0);const e=await K.updateUser(j.id,w);e.success&&e.data?(t(s.map(s=>s.id===j.id?e.data:s)),g(!1),k(),alert("User updated successfully!")):v(e.message)}catch(e){v("Failed to update user. Please try again.")}finally{o(!1)}}else v("Please enter a valid email address")},loading:d,disabled:d,children:d?"Updating User...":"Update User"})]})]})})]})})}function Hs(){const[s,t]=e.useState([]),[a,r]=e.useState([]),[l,i]=e.useState(!0),[n,c]=e.useState(""),[d,o]=e.useState(!1),[m,x]=e.useState(!1),[u,h]=e.useState(null),[p,g]=e.useState({name:"",description:""});e.useEffect(()=>{j(),y()},[]);const j=async()=>{try{i(!0);const e=await W.getRoles();t(e.data||[])}catch(e){t([])}finally{i(!1)}},y=async()=>{try{const e=await W.getPermissions();r(e.data)}catch(e){}},f=()=>{g({name:"",description:""}),h(null)},v=s.filter(e=>e.name.toLowerCase().includes(n.toLowerCase())||e.description.toLowerCase().includes(n.toLowerCase()));return a.reduce((e,s)=>(e[s.module]||(e[s.module]=[]),e[s.module].push(s),e),{}),L.jsx(Ms,{children:L.jsxs("div",{className:"p-6",children:[L.jsxs("div",{className:"flex items-center justify-between mb-6",children:[L.jsxs("div",{children:[L.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Role Management"}),L.jsx("p",{className:"text-gray-600 mt-2",children:"Manage system roles and permissions"})]}),L.jsxs(bs,{onClick:()=>o(!0),className:"flex items-center space-x-2",children:[L.jsx(ze,{className:"w-4 h-4"}),L.jsx("span",{children:"Create Role"})]})]}),L.jsxs(As,{children:[L.jsx("div",{className:"mb-6",children:L.jsxs("div",{className:"relative",children:[L.jsx(Qe,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),L.jsx(Ns,{placeholder:"Search roles...",value:n,onChange:e=>c(e.target.value),className:"pl-10"})]})}),l?L.jsxs("div",{className:"text-center py-8",children:[L.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),L.jsx("p",{className:"text-gray-500 mt-2",children:"Loading roles..."})]}):L.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:v.map(e=>L.jsxs(As,{className:"hover:shadow-md transition-shadow",children:[L.jsxs("div",{className:"flex items-center justify-between mb-4",children:[L.jsxs("div",{className:"flex items-center space-x-3",children:[L.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:L.jsx(Ve,{className:"w-5 h-5 text-blue-600"})}),L.jsxs("div",{children:[L.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:e.name}),L.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-medium "+(e.isActive?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"),children:e.isActive?"Active":"Inactive"})]})]}),L.jsxs("div",{className:"text-sm text-gray-500",children:["Role Level: ",e.level," | Users: ",e.userCount||0]})]}),L.jsx("p",{className:"text-gray-600 text-sm mb-4 line-clamp-2",children:e.description}),L.jsxs("div",{className:"space-y-2 mb-4",children:[L.jsxs("div",{className:"flex items-center text-sm text-gray-500",children:[L.jsx(cs,{className:"w-4 h-4 mr-2"}),L.jsxs("span",{children:[e.userCount||0," users assigned"]})]}),L.jsxs("div",{className:"flex items-center text-sm text-gray-500",children:[L.jsx(Ye,{className:"w-4 h-4 mr-2"}),L.jsxs("span",{children:["Level ",e.level]})]})]}),L.jsxs("div",{className:"text-xs text-gray-500 mb-4",children:["Created: ",js(e.createdAt)]}),L.jsxs("div",{className:"flex items-center justify-between",children:[L.jsxs("span",{className:"text-sm text-gray-500",children:["Created: ",js(e.createdAt).split(",")[0]]}),L.jsxs("div",{className:"flex items-center space-x-2",children:[L.jsx("button",{onClick:()=>(e=>{h(e),g({name:e.name,description:e.description}),x(!0)})(e),className:"p-1 text-blue-600 hover:text-blue-700",children:L.jsx(Ke,{className:"w-4 h-4"})}),L.jsx("button",{onClick:()=>(async e=>{if(window.confirm("Are you sure you want to delete this role? This action cannot be undone."))try{(await W.deleteRole(e)).success&&t(s.filter(s=>s.id!==e))}catch(a){}})(e.id),className:"p-1 text-red-600 hover:text-red-700",children:L.jsx(es,{className:"w-4 h-4"})})]})]})]},e.id))})]}),L.jsx(us,{isOpen:d,onClose:()=>{o(!1),f()},title:"Create New Role",size:"xl",children:L.jsxs("div",{className:"space-y-6",children:[L.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[L.jsx(Ns,{label:"Role Name",value:p.name,onChange:e=>g({...p,name:e.target.value}),placeholder:"Enter role name"}),L.jsxs("div",{children:[L.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),L.jsx("textarea",{value:p.description,onChange:e=>g({...p,description:e.target.value}),placeholder:"Enter role description",rows:3,className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]}),L.jsxs("div",{className:"flex justify-end space-x-3 pt-4 border-t",children:[L.jsx(bs,{variant:"secondary",onClick:()=>{o(!1),f()},children:"Cancel"}),L.jsx(bs,{onClick:async()=>{try{const e=await W.createRole(p);e.success&&e.data&&(t([...s,e.data]),o(!1),f())}catch(e){}},children:"Create Role"})]})]})}),L.jsx(us,{isOpen:m,onClose:()=>{x(!1),f()},title:"Edit Role",size:"xl",children:L.jsxs("div",{className:"space-y-6",children:[L.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[L.jsx(Ns,{label:"Role Name",value:p.name,onChange:e=>g({...p,name:e.target.value}),placeholder:"Enter role name"}),L.jsxs("div",{children:[L.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),L.jsx("textarea",{value:p.description,onChange:e=>g({...p,description:e.target.value}),placeholder:"Enter role description",rows:3,className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]}),L.jsxs("div",{className:"flex justify-end space-x-3 pt-4 border-t",children:[L.jsx(bs,{variant:"secondary",onClick:()=>{x(!1),f()},children:"Cancel"}),L.jsx(bs,{onClick:async()=>{if(u)try{const e=await W.updateRole(u.id,p);e.success&&e.data&&(t(s.map(s=>s.id===u.id?e.data:s)),x(!1),f())}catch(e){}},children:"Update Role"})]})]})})]})})}function Gs(){const{user:s}=_s(),[t,a]=e.useState([]),[r,l]=e.useState(!0),[i,n]=e.useState(""),[c,d]=e.useState(!1),[o,m]=e.useState(!1),[x,u]=e.useState(null),[h,p]=e.useState({title:"",description:"",targetDate:"",duration:35,totalQuestions:30,passingScore:70,maxAttempts:3,assignedZones:[],assignedRegions:[]}),g=["North Zone","South Zone","East Zone","West Zone","Central Zone"],j=["Delhi Region","Mumbai Region","Kolkata Region","Chennai Region","Bangalore Region","Hyderabad Region"];e.useEffect(()=>{y()},[]);const y=async()=>{try{l(!0);const e=await H.getSurveys();a(e.data||[])}catch(e){a([])}finally{l(!1)}},f=()=>{p({title:"",description:"",targetDate:"",duration:35,totalQuestions:30,passingScore:70,maxAttempts:3,assignedZones:[],assignedRegions:[]}),u(null)},v=(e,s)=>{p(t=>({...t,assignedZones:s?[...t.assignedZones,e]:t.assignedZones.filter(s=>s!==e)}))},b=(e,s)=>{p(t=>({...t,assignedRegions:s?[...t.assignedRegions,e]:t.assignedRegions.filter(s=>s!==e)}))},N=t.filter(e=>e.title.toLowerCase().includes(i.toLowerCase())||e.description.toLowerCase().includes(i.toLowerCase()));return L.jsx(Ms,{children:L.jsxs("div",{className:"p-6",children:[L.jsxs("div",{className:"flex items-center justify-between mb-6",children:[L.jsxs("div",{children:[L.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Question Area"}),L.jsx("p",{className:"text-gray-600 mt-2",children:"Create and manage your surveys and assessments"})]}),L.jsxs(bs,{onClick:()=>d(!0),className:"flex items-center space-x-2",children:[L.jsx(ze,{className:"w-4 h-4"}),L.jsx("span",{children:"Create Survey"})]})]}),L.jsxs(As,{children:[L.jsx("div",{className:"mb-6",children:L.jsxs("div",{className:"relative",children:[L.jsx(Qe,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),L.jsx(Ns,{placeholder:"Search surveys...",value:i,onChange:e=>n(e.target.value),className:"pl-10"})]})}),r?L.jsxs("div",{className:"text-center py-8",children:[L.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),L.jsx("p",{className:"text-gray-500 mt-2",children:"Loading surveys..."})]}):L.jsx("div",{className:"overflow-x-auto",children:L.jsxs("table",{className:"w-full",children:[L.jsx("thead",{children:L.jsxs("tr",{className:"border-b border-gray-200",children:[L.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-900",children:"Area"}),L.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-900",children:"Status"}),L.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-900",children:"Questions"}),L.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-900",children:"Duration"}),L.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-900",children:"Target Date"}),L.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-900",children:"Pass Score"}),L.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-900",children:"Actions"})]})}),L.jsx("tbody",{children:N.map(e=>L.jsxs("tr",{className:"border-b border-gray-100 hover:bg-gray-50",children:[L.jsx("td",{className:"py-3 px-4",children:L.jsxs("div",{children:[L.jsx("p",{className:"font-medium text-gray-900",children:e.title}),L.jsx("p",{className:"text-sm text-gray-500 line-clamp-1",children:e.description})]})}),L.jsx("td",{className:"py-3 px-4",children:L.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium "+(e.isActive?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"),children:e.isActive?"Active":"Inactive"})}),L.jsx("td",{className:"py-3 px-4 text-gray-900",children:e.totalQuestions}),L.jsx("td",{className:"py-3 px-4 text-gray-900",children:ys(e.duration)}),L.jsx("td",{className:"py-3 px-4 text-gray-900",children:gs(e.targetDate)}),L.jsxs("td",{className:"py-3 px-4 text-gray-900",children:[e.passingScore,"%"]}),L.jsx("td",{className:"py-3 px-4",children:L.jsxs("div",{className:"flex items-center space-x-2",children:[L.jsx("button",{onClick:s=>((e,s)=>{s.stopPropagation();const t=new Date(e.targetDate),a=isNaN(t.getTime())?"":t.toISOString().split("T")[0];u(e),p({title:e.title,description:e.description,targetDate:a,duration:e.duration,totalQuestions:e.totalQuestions,passingScore:e.passingScore,maxAttempts:e.maxAttempts,assignedZones:e.assignedZones||[],assignedRegions:e.assignedRegions||[]}),m(!0)})(e,s),className:"p-1.5 text-blue-600 hover:text-blue-700 hover:bg-blue-50 rounded-md transition-colors",title:"Edit Survey",children:L.jsx(Ke,{className:"w-4 h-4"})}),L.jsx("button",{onClick:r=>(async(e,r)=>{r.stopPropagation();try{const r={title:`${e.title} (Copy)`,description:e.description,targetDate:e.targetDate,duration:e.duration,totalQuestions:e.totalQuestions,passingScore:e.passingScore,maxAttempts:e.maxAttempts,createdBy:(null==s?void 0:s.id)||"550e8400-e29b-41d4-a716-446655440010"},l=await H.createSurvey(r);l.success&&l.data?(a([...t,l.data]),alert("Survey duplicated successfully!")):alert(`Failed to duplicate survey: ${l.message}`)}catch(l){alert("Failed to duplicate survey. Please try again.")}})(e,r),className:"p-1.5 text-green-600 hover:text-green-700 hover:bg-green-50 rounded-md transition-colors",title:"Duplicate Survey",children:L.jsx(Ne,{className:"w-4 h-4"})}),L.jsx("button",{onClick:s=>(async(e,s)=>{s.stopPropagation();const r=t.find(s=>s.id===e);if(r)try{const s=await H.updateSurvey(e,{...r,isActive:!r.isActive});s.success&&s.data?(a(t.map(s=>s.id===e?{...s,isActive:!s.isActive}:s)),alert(`Survey ${r.isActive?"deactivated":"activated"} successfully!`)):alert(`Failed to update survey status: ${s.message}`)}catch(l){alert("Failed to update survey status. Please try again.")}})(e.id,s),className:"p-1.5 hover:bg-gray-50 rounded-md transition-colors "+(e.isActive?"text-orange-600 hover:text-orange-700":"text-green-600 hover:text-green-700"),title:e.isActive?"Deactivate Survey":"Activate Survey",children:e.isActive?L.jsx(Je,{className:"w-4 h-4"}):L.jsx(Xe,{className:"w-4 h-4"})}),L.jsx("button",{onClick:e=>{e.stopPropagation()},className:"p-1.5 text-gray-600 hover:text-gray-700 hover:bg-gray-50 rounded-md transition-colors",title:"View Details",children:L.jsx(_e,{className:"w-4 h-4"})}),L.jsx("button",{onClick:s=>(async(e,s)=>{if(s.stopPropagation(),window.confirm("Are you sure you want to delete this survey? This will also delete all associated questions and results. This action cannot be undone."))try{const s=await H.deleteSurvey(e);s.success?(a(t.filter(s=>s.id!==e)),alert("Survey deleted successfully!")):alert(`Failed to delete survey: ${s.message}`)}catch(r){alert("Failed to delete survey. Please try again.")}})(e.id,s),className:"p-1.5 text-red-600 hover:text-red-700 hover:bg-red-50 rounded-md transition-colors",title:"Delete Survey",children:L.jsx(es,{className:"w-4 h-4"})})]})})]},e.id))})]})}),0===N.length&&!r&&L.jsxs("div",{className:"text-center py-12",children:[L.jsx(Se,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),L.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Surveys Found"}),L.jsx("p",{className:"text-gray-500 mb-4",children:i?"No surveys match your search criteria.":"Get started by creating your first survey."}),!i&&L.jsxs(bs,{onClick:()=>d(!0),className:"flex items-center space-x-2",children:[L.jsx(ze,{className:"w-4 h-4"}),L.jsx("span",{children:"Create Survey"})]})]})]}),L.jsx(us,{isOpen:c,onClose:()=>{d(!1),f()},title:"Create New Survey",size:"lg",children:L.jsxs("div",{className:"space-y-4",children:[L.jsx(Ns,{label:"Survey Title",value:h.title,onChange:e=>p({...h,title:e.target.value}),placeholder:"Enter survey title"}),L.jsxs("div",{children:[L.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),L.jsx("textarea",{value:h.description,onChange:e=>p({...h,description:e.target.value}),placeholder:"Enter survey description",rows:3,className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),L.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[L.jsx(Ns,{label:"Target Date",type:"date",value:h.targetDate,onChange:e=>p({...h,targetDate:e.target.value})}),L.jsx(Ns,{label:"Duration (minutes)",type:"number",value:h.duration,onChange:e=>p({...h,duration:parseInt(e.target.value)}),min:"1"})]}),L.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[L.jsx(Ns,{label:"Total Questions",type:"number",value:h.totalQuestions,onChange:e=>p({...h,totalQuestions:parseInt(e.target.value)}),min:"1"}),L.jsx(Ns,{label:"Passing Score (%)",type:"number",value:h.passingScore,onChange:e=>p({...h,passingScore:parseInt(e.target.value)}),min:"1",max:"100"}),L.jsx(Ns,{label:"Max Attempts",type:"number",value:h.maxAttempts,onChange:e=>p({...h,maxAttempts:parseInt(e.target.value)}),min:"1"})]}),L.jsxs("div",{children:[L.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Assigned Zones"}),L.jsx("div",{className:"grid grid-cols-2 gap-2 p-3 border border-gray-300 rounded-md max-h-32 overflow-y-auto",children:g.map(e=>L.jsxs("label",{className:"flex items-center space-x-2",children:[L.jsx("input",{type:"checkbox",checked:h.assignedZones.includes(e),onChange:s=>v(e,s.target.checked),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),L.jsx("span",{className:"text-sm text-gray-700",children:e})]},e))}),L.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Leave empty to make available to all zones"})]}),L.jsxs("div",{children:[L.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Assigned Regions"}),L.jsx("div",{className:"grid grid-cols-2 gap-2 p-3 border border-gray-300 rounded-md max-h-32 overflow-y-auto",children:j.map(e=>L.jsxs("label",{className:"flex items-center space-x-2",children:[L.jsx("input",{type:"checkbox",checked:h.assignedRegions.includes(e),onChange:s=>b(e,s.target.checked),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),L.jsx("span",{className:"text-sm text-gray-700",children:e})]},e))}),L.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Leave empty to make available to all regions"})]}),L.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[L.jsx(bs,{variant:"secondary",onClick:()=>{d(!1),f()},children:"Cancel"}),L.jsx(bs,{onClick:async()=>{if(h.title&&h.description&&h.targetDate)try{const e=await H.createSurvey({...h,targetDate:new Date(h.targetDate),createdBy:(null==s?void 0:s.id)||"550e8400-e29b-41d4-a716-446655440010",assignedZones:h.assignedZones,assignedRegions:h.assignedRegions});e.success&&e.data?(a([...t,e.data]),d(!1),f(),alert("Survey created successfully!")):alert(`Failed to create survey: ${e.message}`)}catch(e){alert("Failed to create survey. Please try again.")}else alert("Please fill in all required fields")},children:"Create Survey"})]})]})}),L.jsx(us,{isOpen:o,onClose:()=>{m(!1),f()},title:"Edit Survey",size:"lg",children:L.jsxs("div",{className:"space-y-4",children:[L.jsx(Ns,{label:"Survey Title",value:h.title,onChange:e=>p({...h,title:e.target.value}),placeholder:"Enter survey title"}),L.jsxs("div",{children:[L.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),L.jsx("textarea",{value:h.description,onChange:e=>p({...h,description:e.target.value}),placeholder:"Enter survey description",rows:3,className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),L.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[L.jsx(Ns,{label:"Target Date",type:"date",value:h.targetDate,onChange:e=>p({...h,targetDate:e.target.value})}),L.jsx(Ns,{label:"Duration (minutes)",type:"number",value:h.duration,onChange:e=>p({...h,duration:parseInt(e.target.value)}),min:"1"})]}),L.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[L.jsx(Ns,{label:"Total Questions",type:"number",value:h.totalQuestions,onChange:e=>p({...h,totalQuestions:parseInt(e.target.value)}),min:"1"}),L.jsx(Ns,{label:"Passing Score (%)",type:"number",value:h.passingScore,onChange:e=>p({...h,passingScore:parseInt(e.target.value)}),min:"1",max:"100"}),L.jsx(Ns,{label:"Max Attempts",type:"number",value:h.maxAttempts,onChange:e=>p({...h,maxAttempts:parseInt(e.target.value)}),min:"1"})]}),L.jsxs("div",{children:[L.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Assigned Zones"}),L.jsx("div",{className:"grid grid-cols-2 gap-2 p-3 border border-gray-300 rounded-md max-h-32 overflow-y-auto",children:g.map(e=>L.jsxs("label",{className:"flex items-center space-x-2",children:[L.jsx("input",{type:"checkbox",checked:h.assignedZones.includes(e),onChange:s=>v(e,s.target.checked),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),L.jsx("span",{className:"text-sm text-gray-700",children:e})]},e))}),L.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Leave empty to make available to all zones"})]}),L.jsxs("div",{children:[L.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Assigned Regions"}),L.jsx("div",{className:"grid grid-cols-2 gap-2 p-3 border border-gray-300 rounded-md max-h-32 overflow-y-auto",children:j.map(e=>L.jsxs("label",{className:"flex items-center space-x-2",children:[L.jsx("input",{type:"checkbox",checked:h.assignedRegions.includes(e),onChange:s=>b(e,s.target.checked),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),L.jsx("span",{className:"text-sm text-gray-700",children:e})]},e))}),L.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Leave empty to make available to all regions"})]}),L.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[L.jsx(bs,{variant:"secondary",onClick:()=>{m(!1),f()},children:"Cancel"}),L.jsx(bs,{onClick:async()=>{if(x)if(h.title&&h.description&&h.targetDate)try{const e=await H.updateSurvey(x.id,{...h,targetDate:new Date(h.targetDate),assignedZones:h.assignedZones,assignedRegions:h.assignedRegions});e.success&&e.data?(a(t.map(s=>s.id===x.id?e.data:s)),m(!1),f(),alert("Survey updated successfully!")):alert(`Failed to update survey: ${e.message}`)}catch(e){alert("Failed to update survey. Please try again.")}else alert("Please fill in all required fields")},children:"Update Survey"})]})]})})]})})}function Xs(){const[s,t]=e.useState([]),[a,r]=e.useState([]),[l,i]=e.useState([]),[n,c]=e.useState(""),[d,o]=e.useState(""),[m,x]=e.useState(!0),[u,h]=e.useState(""),[p,g]=e.useState(!1),[j,y]=e.useState(!1),[f,v]=e.useState(!1),[b,N]=e.useState(!1),[w,_]=e.useState(!1),[S,C]=e.useState(null),[k,A]=e.useState(null),[E,D]=e.useState({title:"",description:"",questionsCount:10,sectionOrder:1}),[R,T]=e.useState({text:"",type:"single_choice",complexity:"medium",points:1,explanation:"",options:[{text:"",isCorrect:!1},{text:"",isCorrect:!1},{text:"",isCorrect:!1},{text:"",isCorrect:!1}]});e.useEffect(()=>{I()},[]),e.useEffect(()=>{n?P():(i([]),o(""),t([]))},[n]),e.useEffect(()=>{d?O():t([])},[d]);const I=async()=>{try{x(!0);const e=await H.getSurveys();r(e.data||[])}catch(e){}finally{x(!1)}},P=async()=>{try{if(!n)return;const e=await H.getSurveySections(n);e.success&&e.data&&i(e.data)}catch(e){}},O=async()=>{try{if(!d)return;x(!0);const e=await G.getQuestions(d);e.success&&e.data&&t(e.data)}catch(e){}finally{x(!1)}},q=()=>{T({text:"",type:"single_choice",complexity:"medium",points:1,explanation:"",options:[{text:"",isCorrect:!1},{text:"",isCorrect:!1},{text:"",isCorrect:!1},{text:"",isCorrect:!1}]}),C(null)},M=(e,s,t)=>{const a=[...R.options];a[e]={...a[e],[s]:t},"isCorrect"===s&&!0===t&&"single_choice"===R.type&&a.forEach((s,t)=>{t!==e&&(s.isCorrect=!1)}),T({...R,options:a})},U=()=>{T({...R,options:[...R.options,{text:"",isCorrect:!1}]})},F=e=>{if(R.options.length>2){const s=R.options.filter((s,t)=>t!==e);T({...R,options:s})}},z=()=>{D({title:"",description:"",questionsCount:10,sectionOrder:1}),A(null)},B=s.filter(e=>e.text.toLowerCase().includes(u.toLowerCase())),$=a.find(e=>e.id===n),Z=l.find(e=>e.id===d);return L.jsx(Ms,{children:L.jsxs("div",{className:"p-6",children:[L.jsxs("div",{className:"flex items-center justify-between mb-6",children:[L.jsxs("div",{children:[L.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Question Bank"}),L.jsx("p",{className:"text-gray-600 mt-2",children:"Manage questions for your surveys"})]}),L.jsxs("div",{className:"flex items-center space-x-3",children:[L.jsxs(bs,{variant:"secondary",onClick:()=>N(!0),className:"flex items-center space-x-2",disabled:!n,children:[L.jsx(ze,{className:"w-4 h-4"}),L.jsx("span",{children:"Add Section"})]}),L.jsxs(bs,{variant:"secondary",onClick:()=>v(!0),className:"flex items-center space-x-2",disabled:!d,children:[L.jsx(rs,{className:"w-4 h-4"}),L.jsx("span",{children:"Bulk Upload"})]}),L.jsxs(bs,{onClick:()=>g(!0),className:"flex items-center space-x-2",disabled:!d,children:[L.jsx(ze,{className:"w-4 h-4"}),L.jsx("span",{children:"Add Question"})]})]})]}),L.jsxs(As,{className:"mb-6",children:[L.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[L.jsxs("div",{children:[L.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Survey"}),L.jsxs("select",{value:n,onChange:e=>c(e.target.value),className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[L.jsx("option",{value:"",children:"Choose a survey..."}),a.map(e=>L.jsx("option",{value:e.id,children:e.title},e.id))]})]}),L.jsxs("div",{children:[L.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Section"}),L.jsxs("div",{className:"flex items-center space-x-2",children:[L.jsxs("select",{value:d,onChange:e=>o(e.target.value),disabled:!n,className:"flex-1 px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 disabled:bg-gray-100",children:[L.jsx("option",{value:"",children:"Choose a section..."}),l.map(e=>L.jsxs("option",{value:e.id,children:[e.title," (",e.questions_count," questions)"]},e.id))]}),d&&L.jsxs(bs,{variant:"secondary",size:"sm",onClick:()=>{const e=l.find(e=>e.id===d);e&&(e=>{A(e),D({title:e.title,description:e.description||"",questionsCount:e.questions_count,sectionOrder:e.section_order}),_(!0)})(e)},className:"flex items-center space-x-1",children:[L.jsx(Ke,{className:"w-4 h-4"}),L.jsx("span",{children:"Edit"})]})]})]})]}),$&&L.jsxs("div",{className:"mt-4 p-4 bg-blue-50 rounded-lg",children:[L.jsx("h3",{className:"font-medium text-blue-900 mb-2",children:$.title}),L.jsx("p",{className:"text-sm text-blue-800 mb-2",children:$.description}),L.jsxs("div",{className:"grid grid-cols-4 gap-4 text-sm",children:[L.jsxs("div",{className:"flex items-center space-x-1",children:[L.jsx(He,{className:"w-4 h-4 text-blue-600"}),L.jsxs("span",{children:["Pass: ",$.passingScore,"%"]})]}),L.jsxs("div",{className:"flex items-center space-x-1",children:[L.jsx(be,{className:"w-4 h-4 text-blue-600"}),L.jsxs("span",{children:["Duration: ",$.duration,"m"]})]}),L.jsxs("div",{className:"flex items-center space-x-1",children:[L.jsx(Se,{className:"w-4 h-4 text-blue-600"}),L.jsxs("span",{children:["Questions: ",$.totalQuestions]})]}),L.jsxs("div",{className:"flex items-center space-x-1",children:[L.jsx(je,{className:"w-4 h-4 text-blue-600"}),L.jsxs("span",{children:["Sections: ",l.length]})]})]})]}),Z&&L.jsxs("div",{className:"mt-4 p-4 bg-green-50 rounded-lg",children:[L.jsx("h4",{className:"font-medium text-green-900 mb-1",children:Z.title}),L.jsx("p",{className:"text-sm text-green-800",children:Z.description}),L.jsxs("p",{className:"text-xs text-green-700 mt-1",children:["Target Questions: ",Z.questions_count," | Current Questions: ",s.length]})]})]}),L.jsx(As,{children:d?L.jsxs(L.Fragment,{children:[L.jsxs("div",{className:"flex items-center justify-between mb-6",children:[L.jsxs("div",{className:"relative",children:[L.jsx(Qe,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),L.jsx(Ns,{placeholder:"Search questions...",value:u,onChange:e=>h(e.target.value),className:"pl-10 w-64"})]}),L.jsx("div",{className:"flex items-center space-x-2",children:L.jsxs("span",{className:"text-sm text-gray-600",children:[s.length," question",1!==s.length?"s":""," in this section"]})})]}),m?L.jsxs("div",{className:"text-center py-8",children:[L.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),L.jsx("p",{className:"text-gray-500 mt-2",children:"Loading questions..."})]}):0===B.length?L.jsxs("div",{className:"text-center py-12",children:[L.jsx(Se,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),L.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:u?"No Questions Found":"No Questions in This Section"}),L.jsx("p",{className:"text-gray-500 mb-4",children:u?"No questions match your search criteria.":"Get started by adding your first question to this section."}),!u&&L.jsxs(bs,{onClick:()=>g(!0),className:"flex items-center space-x-2",children:[L.jsx(ze,{className:"w-4 h-4"}),L.jsx("span",{children:"Add First Question"})]})]}):L.jsx("div",{className:"space-y-4",children:B.map((e,a)=>L.jsx("div",{className:"border border-gray-200 rounded-lg p-6 hover:shadow-md transition-shadow",children:L.jsxs("div",{className:"flex items-start justify-between mb-4",children:[L.jsxs("div",{className:"flex-1",children:[L.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[L.jsxs("span",{className:"px-2 py-1 bg-gray-100 text-gray-700 text-xs font-medium rounded-full",children:["Question ",a+1]}),L.jsx("span",{className:"px-2 py-1 text-xs font-medium rounded-full "+("single_choice"===e.type?"bg-blue-100 text-blue-800":"bg-purple-100 text-purple-800"),children:"single_choice"===e.type?"Single Choice":"Multiple Choice"}),L.jsx("span",{className:"px-2 py-1 text-xs font-medium rounded-full "+("easy"===e.complexity?"bg-green-100 text-green-800":"medium"===e.complexity?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"),children:e.complexity.charAt(0).toUpperCase()+e.complexity.slice(1)}),L.jsxs("span",{className:"text-xs text-gray-500",children:[e.points," point",1!==e.points?"s":""]})]}),L.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-3",children:e.text}),L.jsx("div",{className:"space-y-2",children:e.options.map((e,s)=>L.jsxs("div",{className:"flex items-center space-x-2 p-2 rounded "+(e.isCorrect?"bg-green-50 border border-green-200":"bg-gray-50"),children:[L.jsx("span",{className:"w-6 h-6 rounded-full flex items-center justify-center text-xs font-medium "+(e.isCorrect?"bg-green-600 text-white":"bg-gray-300 text-gray-600"),children:String.fromCharCode(65+s)}),L.jsx("span",{className:"text-gray-900",children:e.text}),e.isCorrect&&L.jsx("span",{className:"text-xs text-green-600 font-medium",children:"✓ Correct"})]},s))}),e.explanation&&L.jsx("div",{className:"mt-3 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:L.jsxs("p",{className:"text-sm text-blue-800",children:[L.jsx("strong",{children:"Explanation:"})," ",e.explanation]})})]}),L.jsxs("div",{className:"flex items-center space-x-2",children:[L.jsx("button",{onClick:()=>(e=>{C(e),T({text:e.text,type:e.type,complexity:e.complexity,points:e.points,explanation:e.explanation||"",options:e.options.length>0?e.options:[{text:"",isCorrect:!1},{text:"",isCorrect:!1},{text:"",isCorrect:!1},{text:"",isCorrect:!1}]}),y(!0)})(e),className:"p-2 text-blue-600 hover:text-blue-700 hover:bg-blue-50 rounded-md transition-colors",title:"Edit Question",children:L.jsx(Ke,{className:"w-4 h-4"})}),L.jsx("button",{onClick:()=>(async e=>{if(window.confirm("Are you sure you want to delete this question? This action cannot be undone."))try{const a=await G.deleteQuestion(e);a.success?(t(s.filter(s=>s.id!==e)),alert("Question deleted successfully!")):alert(`Failed to delete question: ${a.message}`)}catch(a){alert("Failed to delete question. Please try again.")}})(e.id),className:"p-2 text-red-600 hover:text-red-700 hover:bg-red-50 rounded-md transition-colors",title:"Delete Question",children:L.jsx(es,{className:"w-4 h-4"})})]})]})},e.id))})]}):L.jsxs("div",{className:"text-center py-12",children:[L.jsx(je,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),L.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Select Survey and Section"}),L.jsx("p",{className:"text-gray-500",children:"Choose a survey and section to view and manage questions"})]})}),L.jsx(us,{isOpen:p,onClose:()=>{g(!1),q()},title:"Create New Question",size:"xl",children:L.jsxs("div",{className:"space-y-6",children:[L.jsxs("div",{children:[L.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Question Text"}),L.jsx("textarea",{value:R.text,onChange:e=>T({...R,text:e.target.value}),placeholder:"Enter your question...",rows:3,className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),L.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[L.jsxs("div",{children:[L.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Question Type"}),L.jsxs("select",{value:R.type,onChange:e=>T({...R,type:e.target.value}),className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[L.jsx("option",{value:"single_choice",children:"Single Choice"}),L.jsx("option",{value:"multiple_choice",children:"Multiple Choice"})]})]}),L.jsxs("div",{children:[L.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Complexity"}),L.jsxs("select",{value:R.complexity,onChange:e=>T({...R,complexity:e.target.value}),className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[L.jsx("option",{value:"easy",children:"Easy"}),L.jsx("option",{value:"medium",children:"Medium"}),L.jsx("option",{value:"hard",children:"Hard"})]})]}),L.jsxs("div",{children:[L.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Points"}),L.jsx("input",{type:"number",min:"1",value:R.points,onChange:e=>T({...R,points:parseInt(e.target.value)}),className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]}),L.jsxs("div",{children:[L.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Answer Options"}),L.jsx("div",{className:"space-y-3",children:R.options.map((e,s)=>L.jsxs("div",{className:"flex items-center space-x-3",children:[L.jsx("span",{className:"w-8 h-8 bg-gray-100 rounded-full flex items-center justify-center text-sm font-medium",children:String.fromCharCode(65+s)}),L.jsx("input",{type:"text",value:e.text,onChange:e=>M(s,"text",e.target.value),placeholder:`Option ${String.fromCharCode(65+s)}`,className:"flex-1 px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"}),L.jsxs("label",{className:"flex items-center space-x-2",children:[L.jsx("input",{type:"single_choice"===R.type?"radio":"checkbox",name:"correct-answer",checked:e.isCorrect,onChange:e=>M(s,"isCorrect",e.target.checked),className:"rounded border-gray-300 text-green-600 focus:ring-green-500"}),L.jsx("span",{className:"text-sm text-gray-700",children:"Correct"})]}),R.options.length>2&&L.jsx("button",{onClick:()=>F(s),className:"p-1 text-red-600 hover:text-red-700",children:L.jsx(es,{className:"w-4 h-4"})})]},s))}),R.options.length<6&&L.jsxs(bs,{variant:"secondary",size:"sm",onClick:U,className:"mt-3",children:[L.jsx(ze,{className:"w-4 h-4 mr-2"}),"Add Option"]})]}),L.jsxs("div",{children:[L.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Explanation (Optional)"}),L.jsx("textarea",{value:R.explanation,onChange:e=>T({...R,explanation:e.target.value}),placeholder:"Provide an explanation for the correct answer...",rows:2,className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),L.jsxs("div",{className:"flex justify-end space-x-3 pt-4 border-t",children:[L.jsx(bs,{variant:"secondary",onClick:()=>{g(!1),q()},children:"Cancel"}),L.jsx(bs,{onClick:async()=>{if(!d)return void alert("Please select a section first");if(!R.text.trim())return void alert("Question text is required");const e=R.options.filter(e=>e.text.trim());if(e.length<2)return void alert("At least 2 options are required");if(0!==e.filter(e=>e.isCorrect).length)try{const a=await G.createQuestion({sectionId:d,text:R.text,type:R.type,complexity:R.complexity,points:R.points,explanation:R.explanation,options:e});a.success&&a.data?(t([...s,a.data]),g(!1),q(),alert("Question created successfully!")):alert(`Failed to create question: ${a.message}`)}catch(a){alert("Failed to create question. Please try again.")}else alert("At least one correct option is required")},children:"Create Question"})]})]})}),L.jsx(us,{isOpen:j,onClose:()=>{y(!1),q()},title:"Edit Question",size:"xl",children:L.jsxs("div",{className:"space-y-6",children:[L.jsxs("div",{children:[L.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Question Text"}),L.jsx("textarea",{value:R.text,onChange:e=>T({...R,text:e.target.value}),placeholder:"Enter your question...",rows:3,className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),L.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[L.jsxs("div",{children:[L.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Question Type"}),L.jsxs("select",{value:R.type,onChange:e=>T({...R,type:e.target.value}),className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[L.jsx("option",{value:"single_choice",children:"Single Choice"}),L.jsx("option",{value:"multiple_choice",children:"Multiple Choice"})]})]}),L.jsxs("div",{children:[L.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Complexity"}),L.jsxs("select",{value:R.complexity,onChange:e=>T({...R,complexity:e.target.value}),className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[L.jsx("option",{value:"easy",children:"Easy"}),L.jsx("option",{value:"medium",children:"Medium"}),L.jsx("option",{value:"hard",children:"Hard"})]})]}),L.jsxs("div",{children:[L.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Points"}),L.jsx("input",{type:"number",min:"1",value:R.points,onChange:e=>T({...R,points:parseInt(e.target.value)}),className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]}),L.jsxs("div",{children:[L.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Answer Options"}),L.jsx("div",{className:"space-y-3",children:R.options.map((e,s)=>L.jsxs("div",{className:"flex items-center space-x-3",children:[L.jsx("span",{className:"w-8 h-8 bg-gray-100 rounded-full flex items-center justify-center text-sm font-medium",children:String.fromCharCode(65+s)}),L.jsx("input",{type:"text",value:e.text,onChange:e=>M(s,"text",e.target.value),placeholder:`Option ${String.fromCharCode(65+s)}`,className:"flex-1 px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"}),L.jsxs("label",{className:"flex items-center space-x-2",children:[L.jsx("input",{type:"single_choice"===R.type?"radio":"checkbox",name:"correct-answer",checked:e.isCorrect,onChange:e=>M(s,"isCorrect",e.target.checked),className:"rounded border-gray-300 text-green-600 focus:ring-green-500"}),L.jsx("span",{className:"text-sm text-gray-700",children:"Correct"})]}),R.options.length>2&&L.jsx("button",{onClick:()=>F(s),className:"p-1 text-red-600 hover:text-red-700",children:L.jsx(es,{className:"w-4 h-4"})})]},s))}),R.options.length<6&&L.jsxs(bs,{variant:"secondary",size:"sm",onClick:U,className:"mt-3",children:[L.jsx(ze,{className:"w-4 h-4 mr-2"}),"Add Option"]})]}),L.jsxs("div",{children:[L.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Explanation (Optional)"}),L.jsx("textarea",{value:R.explanation,onChange:e=>T({...R,explanation:e.target.value}),placeholder:"Provide an explanation for the correct answer...",rows:2,className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),L.jsxs("div",{className:"flex justify-end space-x-3 pt-4 border-t",children:[L.jsx(bs,{variant:"secondary",onClick:()=>{y(!1),q()},children:"Cancel"}),L.jsx(bs,{onClick:async()=>{if(!S)return;if(!R.text.trim())return void alert("Question text is required");const e=R.options.filter(e=>e.text.trim());if(e.length<2)return void alert("At least 2 options are required");if(0!==e.filter(e=>e.isCorrect).length)try{const a=await G.updateQuestion(S.id,{text:R.text,type:R.type,complexity:R.complexity,points:R.points,explanation:R.explanation,options:e});a.success&&a.data?(t(s.map(e=>e.id===S.id?a.data:e)),y(!1),q(),alert("Question updated successfully!")):alert(`Failed to update question: ${a.message}`)}catch(a){alert("Failed to update question. Please try again.")}else alert("At least one correct option is required")},children:"Update Question"})]})]})}),L.jsx(us,{isOpen:b,onClose:()=>{N(!1),z()},title:"Create New Section",size:"lg",children:L.jsxs("div",{className:"space-y-4",children:[L.jsx(Ns,{label:"Section Title",value:E.title,onChange:e=>D({...E,title:e.target.value}),placeholder:"Enter section title"}),L.jsxs("div",{children:[L.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),L.jsx("textarea",{value:E.description,onChange:e=>D({...E,description:e.target.value}),placeholder:"Enter section description",rows:3,className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),L.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[L.jsx(Ns,{label:"Target Questions Count",type:"number",min:"1",value:E.questionsCount,onChange:e=>D({...E,questionsCount:parseInt(e.target.value)}),placeholder:"Number of questions for this section"}),L.jsx(Ns,{label:"Section Order",type:"number",min:"1",value:E.sectionOrder,onChange:e=>D({...E,sectionOrder:parseInt(e.target.value)}),placeholder:"Display order of this section"})]}),L.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[L.jsx("h4",{className:"font-medium text-blue-900 mb-2",children:"Section Information"}),L.jsxs("p",{className:"text-sm text-blue-800",children:['This section will be part of "',null==$?void 0:$.title,'". The questions count determines how many questions will be randomly selected from this section during tests.']})]}),L.jsxs("div",{className:"flex justify-end space-x-3 pt-4 border-t",children:[L.jsx(bs,{variant:"secondary",onClick:()=>{N(!1),z()},children:"Cancel"}),L.jsx(bs,{onClick:async()=>{if(n)if(E.title.trim())try{const e=await H.createSection({surveyId:n,title:E.title,description:E.description,questionsCount:E.questionsCount,sectionOrder:E.sectionOrder});e.success&&e.data?(i([...l,e.data]),N(!1),z(),alert("Section created successfully!")):alert(`Failed to create section: ${e.message}`)}catch(e){alert("Failed to create section. Please try again.")}else alert("Section title is required");else alert("Please select a survey first")},children:"Create Section"})]})]})}),L.jsx(us,{isOpen:w,onClose:()=>{_(!1),z()},title:"Edit Section",size:"lg",children:L.jsxs("div",{className:"space-y-4",children:[L.jsx(Ns,{label:"Section Title",value:E.title,onChange:e=>D({...E,title:e.target.value}),placeholder:"Enter section title"}),L.jsxs("div",{children:[L.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),L.jsx("textarea",{value:E.description,onChange:e=>D({...E,description:e.target.value}),placeholder:"Enter section description",rows:3,className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),L.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[L.jsx(Ns,{label:"Target Questions Count",type:"number",min:"1",value:E.questionsCount,onChange:e=>D({...E,questionsCount:parseInt(e.target.value)}),placeholder:"Number of questions for this section"}),L.jsx(Ns,{label:"Section Order",type:"number",min:"1",value:E.sectionOrder,onChange:e=>D({...E,sectionOrder:parseInt(e.target.value)}),placeholder:"Display order of this section"})]}),L.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[L.jsx("h4",{className:"font-medium text-yellow-900 mb-2",children:"Current Section Status"}),L.jsxs("div",{className:"text-sm text-yellow-800 space-y-1",children:[L.jsxs("p",{children:["Current Questions: ",s.length]}),L.jsxs("p",{children:["Target Questions: ",E.questionsCount]}),s.length!==E.questionsCount&&L.jsx("p",{className:"font-medium",children:s.length<E.questionsCount?`Need ${E.questionsCount-s.length} more questions`:s.length-E.questionsCount+" questions above target"})]})]}),L.jsxs("div",{className:"flex justify-end space-x-3 pt-4 border-t",children:[L.jsx(bs,{variant:"danger",onClick:()=>{k&&((async e=>{if(window.confirm("Are you sure you want to delete this section? This will also delete all questions in this section. This action cannot be undone."))try{const s=await H.deleteSection(e);s.success?(i(l.filter(s=>s.id!==e)),d===e&&(o(""),t([])),alert("Section deleted successfully!")):alert(`Failed to delete section: ${s.message}`)}catch(s){alert("Failed to delete section. Please try again.")}})(k.id),_(!1),z())},className:"mr-auto",children:"Delete Section"}),L.jsx(bs,{variant:"secondary",onClick:()=>{_(!1),z()},children:"Cancel"}),L.jsx(bs,{onClick:async()=>{if(k)if(E.title.trim())try{const e=await H.updateSection(k.id,{title:E.title,description:E.description,questionsCount:E.questionsCount,sectionOrder:E.sectionOrder});e.success&&e.data?(i(l.map(s=>s.id===k.id?e.data:s)),_(!1),z(),alert("Section updated successfully!")):alert(`Failed to update section: ${e.message}`)}catch(e){alert("Failed to update section. Please try again.")}else alert("Section title is required")},children:"Update Section"})]})]})}),L.jsx(us,{isOpen:f,onClose:()=>v(!1),title:"Bulk Upload Questions",size:"lg",children:L.jsxs("div",{className:"space-y-4",children:[L.jsxs("div",{className:"flex items-center justify-between mb-4",children:[L.jsx("h4",{className:"font-medium text-gray-900",children:"Upload Questions"}),L.jsxs(bs,{variant:"secondary",size:"sm",onClick:()=>{if(!d||!Z)return void alert("Please select a section first");let e=["Question","Type","Complexity","OptionA","OptionB","OptionC","OptionD","CorrectAnswer","Points","Explanation"].join(",")+"\n";if(s.forEach(s=>{var t,a,r,l;const i=s.options||[],n=i.map((e,s)=>e.isCorrect?String.fromCharCode(65+s):"").filter(e=>e).join(""),c=[`"${s.text.replace(/"/g,'""')}"`,s.type,s.complexity,`"${((null==(t=i[0])?void 0:t.text)||"").replace(/"/g,'""')}"`,`"${((null==(a=i[1])?void 0:a.text)||"").replace(/"/g,'""')}"`,`"${((null==(r=i[2])?void 0:r.text)||"").replace(/"/g,'""')}"`,`"${((null==(l=i[3])?void 0:l.text)||"").replace(/"/g,'""')}"`,n,s.points,`"${(s.explanation||"").replace(/"/g,'""')}"`];e+=c.join(",")+"\n"}),0===s.length){[['"What is the primary function of an operating system?"',"single_choice","easy",'"To manage hardware and software resources"','"To create documents"','"To browse the internet"','"To play games"',"A","1",'"An operating system manages all hardware and software resources of a computer."'],['"Which of the following are input devices? (Select all that apply)"',"multiple_choice","medium",'"Keyboard"','"Mouse"','"Monitor"','"Microphone"',"ABD","2",'"Input devices allow users to provide data to the computer. Monitor is an output device."']].forEach(s=>{e+=s.join(",")+"\n"})}const t=new Blob([e],{type:"text/csv;charset=utf-8;"}),a=document.createElement("a"),r=URL.createObjectURL(t);a.setAttribute("href",r),a.setAttribute("download",`questions_template_${Z.title.replace(/[^a-zA-Z0-9]/g,"_")}.csv`),a.style.visibility="hidden",document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(r)},className:"flex items-center space-x-2",children:[L.jsx(we,{className:"w-4 h-4"}),L.jsx("span",{children:"Download Template"})]})]}),L.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[L.jsx("h4",{className:"font-medium text-blue-900 mb-2",children:"CSV Format Requirements"}),L.jsx("p",{className:"text-sm text-blue-800 mb-2",children:"Your CSV file should have the following columns:"}),L.jsx("div",{className:"text-xs text-blue-700 font-mono bg-blue-100 p-2 rounded",children:"Question,Type,Complexity,OptionA,OptionB,OptionC,OptionD,CorrectAnswer,Points,Explanation"}),L.jsx("p",{className:"text-xs text-blue-700 mt-2",children:"Download the template above to get a CSV file with existing questions from this section, or use it as a format reference for new questions."})]}),L.jsxs("div",{children:[L.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Upload CSV File"}),L.jsx("input",{type:"file",accept:".csv",className:"block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"})]}),L.jsxs("div",{className:"flex justify-end space-x-3 pt-4 border-t",children:[L.jsx(bs,{variant:"secondary",onClick:()=>v(!1),children:"Cancel"}),L.jsx(bs,{children:"Upload Questions"})]})]})})]})})}function Js(){var s,t,a,r,l,i,n;const[c,d]=e.useState([]),[o,m]=e.useState(null),[x,u]=e.useState(!0),[C,k]=e.useState(""),[A,E]=e.useState(null),[D,R]=e.useState(!1),[T,I]=e.useState(!1),[P,O]=e.useState({dateRange:{start:new Date(Date.now()-2592e6),end:new Date}});e.useEffect(()=>{q(),M()},[P]);const q=async()=>{try{u(!0);const e=await re.getResults(P);d(e.data||[])}catch(e){}finally{u(!1)}},M=async()=>{try{const e=await re.getAnalytics(P);m(e.data)}catch(e){}},U=c.filter(e=>{var s,t,a;return""===C||((null==(s=e.user)?void 0:s.name)||e.userName||"").toLowerCase().includes(C.toLowerCase())||((null==(t=e.user)?void 0:t.email)||e.userEmail||"").toLowerCase().includes(C.toLowerCase())||((null==(a=e.survey)?void 0:a.title)||e.surveyTitle||"").toLowerCase().includes(C.toLowerCase())}),F=["#3B82F6","#10B981","#F59E0B","#EF4444","#8B5CF6"];return L.jsx(Ms,{children:L.jsxs("div",{className:"p-6",children:[L.jsxs("div",{className:"flex items-center justify-between mb-6",children:[L.jsxs("div",{children:[L.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Results & Analytics"}),L.jsx("p",{className:"text-gray-600 mt-2",children:"Comprehensive test results and performance analytics"})]}),L.jsxs("div",{className:"flex items-center space-x-3",children:[L.jsxs(bs,{variant:"secondary",onClick:()=>I(!0),className:"flex items-center space-x-2",children:[L.jsx(Ce,{className:"w-4 h-4"}),L.jsx("span",{children:"Filters"})]}),L.jsxs(bs,{onClick:async()=>{try{const e=await re.exportResults(P),s=new Blob([e.data],{type:"text/csv"}),t=URL.createObjectURL(s),a=document.createElement("a");a.href=t,a.download=`results_${(new Date).toISOString().split("T")[0]}.csv`,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(t)}catch(e){}},className:"flex items-center space-x-2",children:[L.jsx(we,{className:"w-4 h-4"}),L.jsx("span",{children:"Download"})]})]})]}),o&&L.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[L.jsx(As,{children:L.jsxs("div",{className:"flex items-center justify-between",children:[L.jsxs("div",{children:[L.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Attempts"}),L.jsx("p",{className:"text-3xl font-bold text-gray-900",children:o.overview.totalAttempts})]}),L.jsx("div",{className:"p-3 rounded-full bg-blue-100",children:L.jsx(cs,{className:"w-6 h-6 text-blue-600"})})]})}),L.jsx(As,{children:L.jsxs("div",{className:"flex items-center justify-between",children:[L.jsxs("div",{children:[L.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Pass Rate"}),L.jsxs("p",{className:"text-3xl font-bold text-green-600",children:[o.overview.passRate.toFixed(1),"%"]})]}),L.jsx("div",{className:"p-3 rounded-full bg-green-100",children:L.jsx(He,{className:"w-6 h-6 text-green-600"})})]})}),L.jsx(As,{children:L.jsxs("div",{className:"flex items-center justify-between",children:[L.jsxs("div",{children:[L.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Average Score"}),L.jsxs("p",{className:"text-3xl font-bold text-yellow-600",children:[o.overview.averageScore.toFixed(1),"%"]})]}),L.jsx("div",{className:"p-3 rounded-full bg-yellow-100",children:L.jsx(ue,{className:"w-6 h-6 text-yellow-600"})})]})}),L.jsx(As,{children:L.jsxs("div",{className:"flex items-center justify-between",children:[L.jsxs("div",{children:[L.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Avg. Time"}),L.jsx("p",{className:"text-3xl font-bold text-purple-600",children:ys(o.overview.averageTime)})]}),L.jsx("div",{className:"p-3 rounded-full bg-purple-100",children:L.jsx(be,{className:"w-6 h-6 text-purple-600"})})]})})]}),o&&L.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8",children:[L.jsxs(As,{children:[L.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Performance by Role"}),L.jsx("div",{className:"h-64",children:L.jsx(h,{width:"100%",height:"100%",children:L.jsxs(p,{data:o.performanceByRole,children:[L.jsx(g,{strokeDasharray:"3 3"}),L.jsx(j,{dataKey:"name"}),L.jsx(y,{}),L.jsx(f,{formatter:e=>[`${e}%`,"Pass Rate"]}),L.jsx(v,{dataKey:"percentage",fill:"#3B82F6",radius:[4,4,0,0]})]})})})]}),L.jsxs(As,{children:[L.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Performance by Question Area"}),L.jsx("div",{className:"h-64",children:L.jsx(h,{width:"100%",height:"100%",children:L.jsxs(b,{children:[L.jsx(N,{data:o.performanceBySurvey,cx:"50%",cy:"50%",labelLine:!1,label:({name:e,percentage:s})=>`${e}: ${s}%`,outerRadius:80,fill:"#8884d8",dataKey:"percentage",children:o.performanceBySurvey.map((e,s)=>L.jsx(w,{fill:F[s%F.length]},`cell-${s}`))}),L.jsx(f,{})]})})})]})]}),o&&o.timeSeriesData.length>0&&L.jsxs(As,{className:"mb-8",children:[L.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Performance Trends"}),L.jsx("div",{className:"h-64",children:L.jsx(h,{width:"100%",height:"100%",children:L.jsxs(_,{data:o.timeSeriesData,children:[L.jsx(g,{strokeDasharray:"3 3"}),L.jsx(j,{dataKey:"date"}),L.jsx(y,{}),L.jsx(f,{}),L.jsx(S,{type:"monotone",dataKey:"attempts",stroke:"#3B82F6",name:"Attempts"}),L.jsx(S,{type:"monotone",dataKey:"passed",stroke:"#10B981",name:"Passed"}),L.jsx(S,{type:"monotone",dataKey:"averageScore",stroke:"#F59E0B",name:"Avg Score"})]})})})]}),o&&L.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8",children:[L.jsxs(As,{children:[L.jsxs("div",{className:"flex items-center justify-between mb-4",children:[L.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Top Performers"}),L.jsx(ts,{className:"w-5 h-5 text-green-600"})]}),L.jsx("div",{className:"space-y-3",children:o.topPerformers.map((e,s)=>L.jsxs("div",{className:"flex items-center justify-between p-3 bg-green-50 rounded-lg",children:[L.jsxs("div",{className:"flex items-center space-x-3",children:[L.jsx("div",{className:"w-8 h-8 bg-green-600 rounded-full flex items-center justify-center text-white font-bold text-sm",children:s+1}),L.jsxs("div",{children:[L.jsx("p",{className:"font-medium text-gray-900",children:e.userName}),L.jsxs("p",{className:"text-sm text-gray-500",children:[e.totalAttempts," attempts"]})]})]}),L.jsxs("div",{className:"text-right",children:[L.jsxs("p",{className:"font-bold text-green-600",children:[e.averageScore.toFixed(1),"%"]}),L.jsxs("p",{className:"text-sm text-gray-500",children:[e.passRate.toFixed(1),"% pass rate"]})]})]},e.userId))})]}),L.jsxs(As,{children:[L.jsxs("div",{className:"flex items-center justify-between mb-4",children:[L.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Needs Improvement"}),L.jsx(ss,{className:"w-5 h-5 text-red-600"})]}),L.jsx("div",{className:"space-y-3",children:o.lowPerformers.map((e,s)=>L.jsxs("div",{className:"flex items-center justify-between p-3 bg-red-50 rounded-lg",children:[L.jsxs("div",{className:"flex items-center space-x-3",children:[L.jsx("div",{className:"w-8 h-8 bg-red-600 rounded-full flex items-center justify-center text-white font-bold text-sm",children:s+1}),L.jsxs("div",{children:[L.jsx("p",{className:"font-medium text-gray-900",children:e.userName}),L.jsxs("p",{className:"text-sm text-gray-500",children:[e.totalAttempts," attempts"]})]})]}),L.jsxs("div",{className:"text-right",children:[L.jsxs("p",{className:"font-bold text-red-600",children:[e.averageScore.toFixed(1),"%"]}),L.jsxs("p",{className:"text-sm text-gray-500",children:[e.passRate.toFixed(1),"% pass rate"]})]})]},e.userId))})]})]}),L.jsxs(As,{children:[L.jsxs("div",{className:"flex items-center justify-between mb-6",children:[L.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Test Results"}),L.jsxs("div",{className:"relative",children:[L.jsx(Qe,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),L.jsx(Ns,{placeholder:"Search results...",value:C,onChange:e=>k(e.target.value),className:"pl-10 w-64"})]})]}),x?L.jsxs("div",{className:"text-center py-8",children:[L.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),L.jsx("p",{className:"text-gray-500 mt-2",children:"Loading results..."})]}):L.jsx("div",{className:"overflow-x-auto",children:L.jsxs("table",{className:"w-full",children:[L.jsx("thead",{children:L.jsxs("tr",{className:"border-b border-gray-200",children:[L.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-900",children:"User"}),L.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-900",children:"Question Area"}),L.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-900",children:"Score"}),L.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-900",children:"Status"}),L.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-900",children:"Attempt"}),L.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-900",children:"Time Spent"}),L.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-900",children:"Completed"}),L.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-900",children:"Actions"})]})}),L.jsx("tbody",{children:U.map(e=>{var s,t,a,r,l,i;return L.jsxs("tr",{className:"border-b border-gray-100 hover:bg-gray-50",children:[L.jsx("td",{className:"py-3 px-4",children:L.jsxs("div",{children:[L.jsx("p",{className:"font-medium text-gray-900",children:(null==(s=e.user)?void 0:s.name)||e.userName||"Unknown User"}),L.jsx("p",{className:"text-sm text-gray-500",children:(null==(t=e.user)?void 0:t.email)||e.userEmail||"No email"})]})}),L.jsxs("td",{className:"py-3 px-4",children:[L.jsx("p",{className:"font-medium text-gray-900",children:(null==(a=e.survey)?void 0:a.title)||e.surveyTitle||"Unknown Survey"}),L.jsx("p",{className:"text-sm text-gray-500",children:(null==(l=null==(r=e.user)?void 0:r.role)?void 0:l.name)||e.roleName||"Unknown Role"})]}),L.jsx("td",{className:"py-3 px-4",children:L.jsxs("div",{className:"flex items-center space-x-2",children:[L.jsxs("span",{className:`text-lg font-bold ${vs(e.score)}`,children:[e.score,"%"]}),L.jsxs("span",{className:"text-sm text-gray-500",children:["(",e.correctAnswers,"/",e.totalQuestions,")"]})]})}),L.jsx("td",{className:"py-3 px-4",children:L.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium "+(e.isPassed?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:e.isPassed?"Passed":"Failed"})}),L.jsxs("td",{className:"py-3 px-4 text-gray-900",children:[e.attemptNumber,"/",(null==(i=e.survey)?void 0:i.maxAttempts)||e.maxAttempts||"N/A"]}),L.jsx("td",{className:"py-3 px-4 text-gray-900",children:ys(Math.floor(e.timeSpent/60))}),L.jsx("td",{className:"py-3 px-4 text-gray-500 text-sm",children:js(e.completedAt)}),L.jsx("td",{className:"py-3 px-4",children:L.jsxs("div",{className:"flex items-center space-x-2",children:[L.jsx("button",{onClick:()=>(e=>{E(e),R(!0)})(e),className:"p-1 text-blue-600 hover:text-blue-700",children:L.jsx(_e,{className:"w-4 h-4"})}),e.certificateId&&L.jsx("button",{className:"p-1 text-green-600 hover:text-green-700",children:L.jsx(ue,{className:"w-4 h-4"})})]})})]},e.id)})})]})})]}),L.jsx(us,{isOpen:D,onClose:()=>R(!1),title:"Test Result Details",size:"xl",children:A&&L.jsxs("div",{className:"space-y-6",children:[L.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[L.jsxs("div",{children:[L.jsx("h4",{className:"font-semibold text-gray-900 mb-2",children:"User Information"}),L.jsxs("div",{className:"space-y-2 text-sm",children:[L.jsxs("p",{children:[L.jsx("span",{className:"font-medium",children:"Name:"})," ",(null==(s=A.user)?void 0:s.name)||A.userName||"Unknown"]}),L.jsxs("p",{children:[L.jsx("span",{className:"font-medium",children:"Email:"})," ",(null==(t=A.user)?void 0:t.email)||A.userEmail||"Unknown"]}),L.jsxs("p",{children:[L.jsx("span",{className:"font-medium",children:"Role:"})," ",(null==(r=null==(a=A.user)?void 0:a.role)?void 0:r.name)||A.roleName||"Unknown"]}),L.jsxs("p",{children:[L.jsx("span",{className:"font-medium",children:"Jurisdiction:"})," ",(null==(l=A.user)?void 0:l.jurisdiction)||A.userJurisdiction||"N/A"]})]})]}),L.jsxs("div",{children:[L.jsx("h4",{className:"font-semibold text-gray-900 mb-2",children:"Test Information"}),L.jsxs("div",{className:"space-y-2 text-sm",children:[L.jsxs("p",{children:[L.jsx("span",{className:"font-medium",children:"Survey:"})," ",(null==(i=A.survey)?void 0:i.title)||A.surveyTitle||"Unknown"]}),L.jsxs("p",{children:[L.jsx("span",{className:"font-medium",children:"Attempt:"})," ",A.attemptNumber,"/",(null==(n=A.survey)?void 0:n.maxAttempts)||A.maxAttempts||"N/A"]}),L.jsxs("p",{children:[L.jsx("span",{className:"font-medium",children:"Time Spent:"})," ",ys(Math.floor(A.timeSpent/60))]}),L.jsxs("p",{children:[L.jsx("span",{className:"font-medium",children:"Completed:"})," ",js(A.completedAt)]})]})]})]}),L.jsxs("div",{children:[L.jsx("h4",{className:"font-semibold text-gray-900 mb-4",children:"Overall Performance"}),L.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[L.jsxs("div",{className:"text-center p-4 bg-blue-50 rounded-lg",children:[L.jsxs("p",{className:"text-2xl font-bold text-blue-600",children:[A.score,"%"]}),L.jsx("p",{className:"text-sm text-gray-600",children:"Overall Score"})]}),L.jsxs("div",{className:"text-center p-4 bg-green-50 rounded-lg",children:[L.jsx("p",{className:"text-2xl font-bold text-green-600",children:A.correctAnswers}),L.jsx("p",{className:"text-sm text-gray-600",children:"Correct Answers"})]}),L.jsxs("div",{className:"text-center p-4 bg-yellow-50 rounded-lg",children:[L.jsx("p",{className:"text-2xl font-bold text-yellow-600",children:A.totalQuestions-A.correctAnswers}),L.jsx("p",{className:"text-sm text-gray-600",children:"Incorrect Answers"})]}),L.jsxs("div",{className:"text-center p-4 bg-purple-50 rounded-lg",children:[L.jsx("p",{className:"text-2xl font-bold text-purple-600",children:A.grade||"N/A"}),L.jsx("p",{className:"text-sm text-gray-600",children:"Grade"})]})]})]}),L.jsxs("div",{children:[L.jsx("h4",{className:"font-semibold text-gray-900 mb-4",children:"Section-wise Performance"}),L.jsx("div",{className:"space-y-3",children:A.sectionScores.map(e=>L.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[L.jsxs("div",{className:"flex items-center justify-between mb-2",children:[L.jsx("h5",{className:"font-medium text-gray-900",children:e.sectionTitle}),L.jsxs("span",{className:`font-bold ${vs(e.score)}`,children:[e.score,"%"]})]}),L.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-600",children:[L.jsxs("span",{children:[e.correctAnswers,"/",e.totalQuestions," correct"]}),L.jsx("div",{className:"w-32 bg-gray-200 rounded-full h-2",children:L.jsx("div",{className:"bg-blue-600 h-2 rounded-full",style:{width:`${e.score}%`}})})]})]},e.sectionId))})]})]})}),L.jsx(us,{isOpen:T,onClose:()=>I(!1),title:"Filter Results",children:L.jsxs("div",{className:"space-y-4",children:[L.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[L.jsx(Ns,{label:"Start Date",type:"date",value:P.dateRange.start.toISOString().split("T")[0],onChange:e=>O({...P,dateRange:{...P.dateRange,start:new Date(e.target.value)}})}),L.jsx(Ns,{label:"End Date",type:"date",value:P.dateRange.end.toISOString().split("T")[0],onChange:e=>O({...P,dateRange:{...P.dateRange,end:new Date(e.target.value)}})})]}),L.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[L.jsx(bs,{variant:"secondary",onClick:()=>I(!1),children:"Cancel"}),L.jsx(bs,{onClick:()=>{I(!1),q(),M()},children:"Apply Filters"})]})]})})]})})}function et(){const[s,t]=e.useState([]),[a,r]=e.useState(!0),[l,i]=e.useState(""),[n,c]=e.useState(null),[d,o]=e.useState(!1),[m,x]=e.useState("all");e.useEffect(()=>{u()},[]);const u=async()=>{try{r(!0);const e=await se.getDashboardData("30");e.success&&e.data?t(e.data.enumeratorStatus||[]):t([])}catch(e){t([])}finally{r(!1)}},h=e=>{switch(e){case"completed":return L.jsx(ve,{className:"w-4 h-4 text-green-600"});case"in_progress":return L.jsx(be,{className:"w-4 h-4 text-yellow-600"});case"failed":return L.jsx(ms,{className:"w-4 h-4 text-red-600"});case"expired":return L.jsx(oe,{className:"w-4 h-4 text-orange-600"});default:return L.jsx(be,{className:"w-4 h-4 text-gray-600"})}},p=e=>{switch(e){case"completed":return"bg-green-100 text-green-800";case"in_progress":return"bg-yellow-100 text-yellow-800";case"failed":return"bg-red-100 text-red-800";case"expired":return"bg-orange-100 text-orange-800";default:return"bg-gray-100 text-gray-800"}},g=e=>{const s=e.surveys.length,t=e.surveys.filter(e=>"completed"===e.status).length,a=e.surveys.filter(e=>"failed"===e.status).length,r=e.surveys.filter(e=>"expired"===e.status).length;return t===s?"excellent":a>0||r>0?"needs_attention":t>s/2?"good":"poor"},j=s.filter(e=>{const s=e.user.name.toLowerCase().includes(l.toLowerCase())||e.user.email.toLowerCase().includes(l.toLowerCase());if("all"===m)return s;const t=g(e);return s&&t===m});return L.jsx(Ms,{children:L.jsxs("div",{className:"p-6",children:[L.jsx("div",{className:"flex items-center justify-between mb-6",children:L.jsxs("div",{children:[L.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Candidate Status"}),L.jsx("p",{className:"text-gray-600 mt-2",children:"Track examination progress and performance of all candidates"})]})}),L.jsx(As,{className:"mb-6",children:L.jsxs("div",{className:"flex items-center justify-between",children:[L.jsxs("div",{className:"flex items-center space-x-4",children:[L.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Candidates"}),L.jsxs("div",{className:"relative",children:[L.jsx(Qe,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),L.jsx(Ns,{placeholder:"Search enumerators...",value:l,onChange:e=>i(e.target.value),className:"pl-10 w-64"})]})]}),L.jsx("div",{children:L.jsxs("select",{value:m,onChange:e=>x(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[L.jsx("option",{value:"all",children:"All Status"}),L.jsx("option",{value:"excellent",children:"Excellent"}),L.jsx("option",{value:"good",children:"Good"}),L.jsx("option",{value:"needs_attention",children:"Needs Attention"}),L.jsx("option",{value:"poor",children:"Poor"})]})})]})}),L.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8",children:[L.jsx(As,{children:L.jsxs("div",{className:"flex items-center justify-between",children:[L.jsxs("div",{children:[L.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Candidates"}),L.jsx("p",{className:"text-3xl font-bold text-gray-900",children:s.length})]}),L.jsx("div",{className:"p-3 rounded-full bg-blue-100",children:L.jsx(ns,{className:"w-6 h-6 text-blue-600"})})]})}),L.jsx(As,{children:L.jsxs("div",{className:"flex items-center justify-between",children:[L.jsxs("div",{children:[L.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Completed All"}),L.jsx("p",{className:"text-3xl font-bold text-green-600",children:s.filter(e=>"excellent"===g(e)).length})]}),L.jsx("div",{className:"p-3 rounded-full bg-green-100",children:L.jsx(ve,{className:"w-6 h-6 text-green-600"})})]})}),L.jsx(As,{children:L.jsxs("div",{className:"flex items-center justify-between",children:[L.jsxs("div",{children:[L.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Need Attention"}),L.jsx("p",{className:"text-3xl font-bold text-orange-600",children:s.filter(e=>"needs_attention"===g(e)).length})]}),L.jsx("div",{className:"p-3 rounded-full bg-orange-100",children:L.jsx(oe,{className:"w-6 h-6 text-orange-600"})})]})}),L.jsx(As,{children:L.jsxs("div",{className:"flex items-center justify-between",children:[L.jsxs("div",{children:[L.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Certificates"}),L.jsx("p",{className:"text-3xl font-bold text-purple-600",children:s.reduce((e,s)=>e+s.totalCertificates,0)})]}),L.jsx("div",{className:"p-3 rounded-full bg-purple-100",children:L.jsx(ue,{className:"w-6 h-6 text-purple-600"})})]})})]}),L.jsx(As,{children:a?L.jsxs("div",{className:"text-center py-8",children:[L.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),L.jsx("p",{className:"text-gray-500 mt-2",children:"Loading enumerator status..."})]}):L.jsx("div",{className:"space-y-4",children:j.map(e=>{const s=g(e),t=e.surveys.filter(e=>"completed"===e.status).length,a=e.surveys.length;return L.jsxs("div",{className:"border border-gray-200 rounded-lg p-6 hover:shadow-md transition-shadow",children:[L.jsxs("div",{className:"flex items-center justify-between",children:[L.jsxs("div",{className:"flex items-center space-x-4",children:[L.jsx("div",{className:"w-12 h-12 bg-blue-600 rounded-full flex items-center justify-center",children:L.jsx(ns,{className:"w-6 h-6 text-white"})}),L.jsxs("div",{children:[L.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:e.user.name}),L.jsx("p",{className:"text-sm text-gray-500",children:e.user.email}),L.jsx("p",{className:"text-sm text-gray-500",children:e.user.jurisdiction||"No jurisdiction"})]})]}),L.jsxs("div",{className:"flex items-center space-x-6",children:[L.jsxs("div",{className:"text-center",children:[L.jsxs("p",{className:"text-2xl font-bold text-blue-600",children:[e.overallProgress,"%"]}),L.jsx("p",{className:"text-sm text-gray-500",children:"Progress"})]}),L.jsxs("div",{className:"text-center",children:[L.jsxs("p",{className:"text-2xl font-bold text-green-600",children:[t,"/",a]}),L.jsx("p",{className:"text-sm text-gray-500",children:"Completed"})]}),L.jsxs("div",{className:"text-center",children:[L.jsx("p",{className:"text-2xl font-bold text-purple-600",children:e.totalCertificates}),L.jsx("p",{className:"text-sm text-gray-500",children:"Certificates"})]}),L.jsx("div",{className:"text-center",children:L.jsx("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium "+("excellent"===s?"bg-green-100 text-green-800":"good"===s?"bg-blue-100 text-blue-800":"needs_attention"===s?"bg-orange-100 text-orange-800":"bg-red-100 text-red-800"),children:"excellent"===s?"Excellent":"good"===s?"Good":"needs_attention"===s?"Needs Attention":"Poor"})}),L.jsxs(bs,{variant:"secondary",size:"sm",onClick:()=>(e=>{c(e),o(!0)})(e),className:"flex items-center space-x-2",children:[L.jsx(_e,{className:"w-4 h-4"}),L.jsx("span",{children:"View Details"})]})]})]}),L.jsxs("div",{className:"mt-4",children:[L.jsxs("div",{className:"flex items-center justify-between mb-2",children:[L.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Overall Progress"}),L.jsxs("span",{className:"text-sm text-gray-500",children:[e.overallProgress,"%"]})]}),L.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:L.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:`${e.overallProgress}%`}})})]}),L.jsxs("div",{className:"mt-4 flex flex-wrap gap-2",children:[e.surveys.slice(0,3).map(e=>L.jsxs("div",{className:"flex items-center space-x-2",children:[h(e.status),L.jsx("span",{className:"text-sm text-gray-600",children:e.surveyTitle})]},e.surveyId)),e.surveys.length>3&&L.jsxs("span",{className:"text-sm text-gray-500",children:["+",e.surveys.length-3," more"]})]})]},e.id)})})}),L.jsx(us,{isOpen:d,onClose:()=>o(!1),title:"Enumerator Details",size:"xl",children:n&&L.jsxs("div",{className:"space-y-6",children:[L.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[L.jsxs("div",{children:[L.jsx("h4",{className:"font-semibold text-gray-900 mb-3",children:"Personal Information"}),L.jsxs("div",{className:"space-y-2 text-sm",children:[L.jsxs("p",{children:[L.jsx("span",{className:"font-medium",children:"Name:"})," ",n.user.name]}),L.jsxs("p",{children:[L.jsx("span",{className:"font-medium",children:"Email:"})," ",n.user.email]}),L.jsxs("p",{children:[L.jsx("span",{className:"font-medium",children:"Role:"})," ",n.user.role.name]}),L.jsxs("p",{children:[L.jsx("span",{className:"font-medium",children:"Jurisdiction:"})," ",n.user.jurisdiction||"N/A"]}),L.jsxs("p",{children:[L.jsx("span",{className:"font-medium",children:"Last Activity:"})," ",js(n.lastActivity)]})]})]}),L.jsxs("div",{children:[L.jsx("h4",{className:"font-semibold text-gray-900 mb-3",children:"Performance Summary"}),L.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[L.jsxs("div",{className:"text-center p-3 bg-blue-50 rounded-lg",children:[L.jsxs("p",{className:"text-xl font-bold text-blue-600",children:[n.overallProgress,"%"]}),L.jsx("p",{className:"text-xs text-gray-600",children:"Overall Progress"})]}),L.jsxs("div",{className:"text-center p-3 bg-purple-50 rounded-lg",children:[L.jsx("p",{className:"text-xl font-bold text-purple-600",children:n.totalCertificates}),L.jsx("p",{className:"text-xs text-gray-600",children:"Certificates"})]})]})]})]}),L.jsxs("div",{children:[L.jsx("h4",{className:"font-semibold text-gray-900 mb-4",children:"Survey Status"}),L.jsx("div",{className:"space-y-3",children:n.surveys.map(e=>L.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[L.jsxs("div",{className:"flex items-center justify-between mb-3",children:[L.jsxs("div",{className:"flex items-center space-x-3",children:[h(e.status),L.jsx("h5",{className:"font-medium text-gray-900",children:e.surveyTitle})]}),L.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${p(e.status)}`,children:e.status.replace("_"," ").toUpperCase()})]}),L.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[L.jsxs("div",{children:[L.jsx("p",{className:"text-gray-500",children:"Attempts"}),L.jsxs("p",{className:"font-medium",children:[e.attempts,"/",e.maxAttempts]})]}),L.jsxs("div",{children:[L.jsx("p",{className:"text-gray-500",children:"Best Score"}),L.jsx("p",{className:"font-medium",children:e.bestScore?`${e.bestScore}%`:"N/A"})]}),L.jsxs("div",{children:[L.jsx("p",{className:"text-gray-500",children:"Target Date"}),L.jsx("p",{className:"font-medium",children:gs(e.targetDate)})]}),L.jsxs("div",{children:[L.jsx("p",{className:"text-gray-500",children:"Last Attempt"}),L.jsx("p",{className:"font-medium",children:e.lastAttempt?gs(e.lastAttempt):"Never"})]})]}),e.certificateId&&L.jsxs("div",{className:"mt-3 flex items-center space-x-2 text-green-600",children:[L.jsx(ue,{className:"w-4 h-4"}),L.jsx("span",{className:"text-sm font-medium",children:"Certificate Earned"})]})]},e.surveyId))})]})]})})]})})}function st(){const[s,t]=e.useState([]),[a,r]=e.useState(!0),[l,i]=e.useState(""),[n,c]=e.useState(null),[d,o]=e.useState(!1),[m,x]=e.useState("all"),[u,h]=e.useState("all");e.useEffect(()=>{p()},[]);const p=async()=>{try{r(!0);const e=await le.getCertificates();t(e.data)}catch(e){}finally{r(!1)}},g=async e=>{try{const a=await le.downloadCertificate(e),r=new Blob([a.data],{type:"application/pdf"}),l=URL.createObjectURL(r),i=document.createElement("a");i.href=l,i.download=`certificate_${e}.pdf`,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(l),t(s.map(s=>s.id===e?{...s,downloadCount:s.downloadCount+1}:s))}catch(a){}},j=e=>{switch(e){case"active":return"bg-green-100 text-green-800";case"revoked":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},y=s.filter(e=>{const s=e.user.name.toLowerCase().includes(l.toLowerCase())||e.survey.title.toLowerCase().includes(l.toLowerCase())||e.certificateNumber.toLowerCase().includes(l.toLowerCase()),t="all"===m||e.status===m;let a=!0;if("all"!==u){const s=new Date,t=new Date(e.issuedAt);switch(u){case"today":a=t.toDateString()===s.toDateString();break;case"week":a=t>=new Date(s.getTime()-6048e5);break;case"month":a=t>=new Date(s.getTime()-2592e6)}}return s&&t&&a}),f=s.length,v=s.filter(e=>"active"===e.status).length,b=s.filter(e=>"revoked"===e.status).length,N=s.reduce((e,s)=>e+s.downloadCount,0);return L.jsx(Ms,{children:L.jsxs("div",{className:"p-6",children:[L.jsxs("div",{className:"flex items-center justify-between mb-6",children:[L.jsxs("div",{children:[L.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Certificate Management"}),L.jsx("p",{className:"text-gray-600 mt-2",children:"Manage and track all issued certificates"})]}),L.jsxs(bs,{onClick:p,className:"flex items-center space-x-2",children:[L.jsx(Be,{className:"w-4 h-4"}),L.jsx("span",{children:"Refresh"})]})]}),L.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8",children:[L.jsx(As,{children:L.jsxs("div",{className:"flex items-center justify-between",children:[L.jsxs("div",{children:[L.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Certificates"}),L.jsx("p",{className:"text-3xl font-bold text-gray-900",children:f})]}),L.jsx("div",{className:"p-3 rounded-full bg-blue-100",children:L.jsx(ue,{className:"w-6 h-6 text-blue-600"})})]})}),L.jsx(As,{children:L.jsxs("div",{className:"flex items-center justify-between",children:[L.jsxs("div",{children:[L.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Active"}),L.jsx("p",{className:"text-3xl font-bold text-green-600",children:v})]}),L.jsx("div",{className:"p-3 rounded-full bg-green-100",children:L.jsx(Se,{className:"w-6 h-6 text-green-600"})})]})}),L.jsx(As,{children:L.jsxs("div",{className:"flex items-center justify-between",children:[L.jsxs("div",{children:[L.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Revoked"}),L.jsx("p",{className:"text-3xl font-bold text-red-600",children:b})]}),L.jsx("div",{className:"p-3 rounded-full bg-red-100",children:L.jsx(Be,{className:"w-6 h-6 text-red-600"})})]})}),L.jsx(As,{children:L.jsxs("div",{className:"flex items-center justify-between",children:[L.jsxs("div",{children:[L.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Downloads"}),L.jsx("p",{className:"text-3xl font-bold text-purple-600",children:N})]}),L.jsx("div",{className:"p-3 rounded-full bg-purple-100",children:L.jsx(we,{className:"w-6 h-6 text-purple-600"})})]})})]}),L.jsx(As,{className:"mb-6",children:L.jsx("div",{className:"flex items-center justify-between",children:L.jsxs("div",{className:"flex items-center space-x-4",children:[L.jsxs("div",{className:"relative",children:[L.jsx(Qe,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),L.jsx(Ns,{placeholder:"Search certificates...",value:l,onChange:e=>i(e.target.value),className:"pl-10 w-64"})]}),L.jsxs("select",{value:m,onChange:e=>x(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[L.jsx("option",{value:"all",children:"All Status"}),L.jsx("option",{value:"active",children:"Active"}),L.jsx("option",{value:"revoked",children:"Revoked"}),L.jsx("option",{value:"expired",children:"Expired"})]}),L.jsxs("select",{value:u,onChange:e=>h(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[L.jsx("option",{value:"all",children:"All Time"}),L.jsx("option",{value:"today",children:"Today"}),L.jsx("option",{value:"week",children:"This Week"}),L.jsx("option",{value:"month",children:"This Month"})]})]})})}),L.jsx(As,{children:a?L.jsxs("div",{className:"text-center py-8",children:[L.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),L.jsx("p",{className:"text-gray-500 mt-2",children:"Loading certificates..."})]}):L.jsx("div",{className:"overflow-x-auto",children:L.jsxs("table",{className:"w-full",children:[L.jsx("thead",{children:L.jsxs("tr",{className:"border-b border-gray-200",children:[L.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-900",children:"Certificate"}),L.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-900",children:"User"}),L.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-900",children:"Survey"}),L.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-900",children:"Status"}),L.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-900",children:"Issued"}),L.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-900",children:"Downloads"}),L.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-900",children:"Actions"})]})}),L.jsx("tbody",{children:y.map(e=>L.jsxs("tr",{className:"border-b border-gray-100 hover:bg-gray-50",children:[L.jsx("td",{className:"py-3 px-4",children:L.jsxs("div",{className:"flex items-center space-x-3",children:[L.jsx("div",{className:"p-2 bg-yellow-100 rounded-lg",children:L.jsx(ue,{className:"w-5 h-5 text-yellow-600"})}),L.jsxs("div",{children:[L.jsx("p",{className:"font-medium text-gray-900",children:e.certificateNumber}),L.jsxs("p",{className:"text-sm text-gray-500",children:["ID: ",e.id]})]})]})}),L.jsx("td",{className:"py-3 px-4",children:L.jsxs("div",{children:[L.jsx("p",{className:"font-medium text-gray-900",children:e.user.name}),L.jsx("p",{className:"text-sm text-gray-500",children:e.user.email})]})}),L.jsx("td",{className:"py-3 px-4",children:L.jsxs("div",{children:[L.jsx("p",{className:"font-medium text-gray-900",children:e.survey.title}),L.jsx("p",{className:"text-sm text-gray-500",children:e.user.role.name})]})}),L.jsx("td",{className:"py-3 px-4",children:L.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${j(e.status)}`,children:e.status.charAt(0).toUpperCase()+e.status.slice(1)})}),L.jsx("td",{className:"py-3 px-4",children:L.jsxs("div",{children:[L.jsx("p",{className:"text-sm text-gray-900",children:gs(e.issuedAt)}),L.jsx("p",{className:"text-xs text-gray-500",children:js(e.issuedAt)})]})}),L.jsx("td",{className:"py-3 px-4",children:L.jsx("span",{className:"text-sm font-medium text-gray-900",children:e.downloadCount})}),L.jsx("td",{className:"py-3 px-4",children:L.jsxs("div",{className:"flex items-center space-x-2",children:[L.jsx("button",{onClick:()=>(e=>{c(e),o(!0)})(e),className:"p-1 text-blue-600 hover:text-blue-700",title:"Preview Certificate",children:L.jsx(_e,{className:"w-4 h-4"})}),L.jsx("button",{onClick:()=>g(e.id),className:"p-1 text-green-600 hover:text-green-700",title:"Download Certificate",disabled:"revoked"===e.status,children:L.jsx(we,{className:"w-4 h-4"})}),"active"===e.status&&L.jsx("button",{onClick:()=>(async e=>{if(window.confirm("Are you sure you want to revoke this certificate? This action cannot be undone."))try{(await le.revokeCertificate(e)).success&&t(s.map(s=>s.id===e?{...s,status:"revoked"}:s))}catch(a){}})(e.id),className:"p-1 text-red-600 hover:text-red-700",title:"Revoke Certificate",children:L.jsx(Be,{className:"w-4 h-4"})})]})})]},e.id))})]})})}),L.jsx(us,{isOpen:d,onClose:()=>o(!1),title:"Certificate Preview",size:"xl",children:n&&L.jsxs("div",{className:"space-y-6",children:[L.jsx("div",{className:"bg-gradient-to-br from-blue-50 to-indigo-100 p-8 rounded-lg border-2 border-blue-200",children:L.jsxs("div",{className:"text-center space-y-4",children:[L.jsx("div",{className:"flex justify-center",children:L.jsx("div",{className:"w-16 h-16 bg-blue-600 rounded-full flex items-center justify-center",children:L.jsx(ue,{className:"w-8 h-8 text-white"})})}),L.jsxs("div",{children:[L.jsx("h2",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Certificate of Completion"}),L.jsx("p",{className:"text-lg text-gray-600",children:"eSigma Survey Platform"})]}),L.jsxs("div",{className:"py-6",children:[L.jsx("p",{className:"text-lg text-gray-700 mb-2",children:"This is to certify that"}),L.jsx("h3",{className:"text-2xl font-bold text-blue-600 mb-2",children:n.user.name}),L.jsx("p",{className:"text-lg text-gray-700 mb-2",children:"has successfully completed"}),L.jsx("h4",{className:"text-xl font-semibold text-gray-900 mb-4",children:n.survey.title})]}),L.jsxs("div",{className:"flex justify-between items-center pt-6 border-t border-blue-200",children:[L.jsxs("div",{children:[L.jsx("p",{className:"text-sm text-gray-600",children:"Certificate Number"}),L.jsx("p",{className:"font-mono text-sm font-medium",children:n.certificateNumber})]}),L.jsxs("div",{children:[L.jsx("p",{className:"text-sm text-gray-600",children:"Date Issued"}),L.jsx("p",{className:"text-sm font-medium",children:gs(n.issuedAt)})]})]})]})}),L.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[L.jsxs("div",{children:[L.jsx("h4",{className:"font-semibold text-gray-900 mb-3",children:"Certificate Information"}),L.jsxs("div",{className:"space-y-2 text-sm",children:[L.jsxs("p",{children:[L.jsx("span",{className:"font-medium",children:"Number:"})," ",n.certificateNumber]}),L.jsxs("p",{children:[L.jsx("span",{className:"font-medium",children:"Status:"}),L.jsx("span",{className:`ml-2 inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium ${j(n.status)}`,children:n.status.charAt(0).toUpperCase()+n.status.slice(1)})]}),L.jsxs("p",{children:[L.jsx("span",{className:"font-medium",children:"Issued:"})," ",js(n.issuedAt)]}),L.jsxs("p",{children:[L.jsx("span",{className:"font-medium",children:"Downloads:"})," ",n.downloadCount]}),n.validUntil&&L.jsxs("p",{children:[L.jsx("span",{className:"font-medium",children:"Valid Until:"})," ",gs(n.validUntil)]})]})]}),L.jsxs("div",{children:[L.jsx("h4",{className:"font-semibold text-gray-900 mb-3",children:"Recipient Information"}),L.jsxs("div",{className:"space-y-2 text-sm",children:[L.jsxs("p",{children:[L.jsx("span",{className:"font-medium",children:"Name:"})," ",n.user.name]}),L.jsxs("p",{children:[L.jsx("span",{className:"font-medium",children:"Email:"})," ",n.user.email]}),L.jsxs("p",{children:[L.jsx("span",{className:"font-medium",children:"Role:"})," ",n.user.role.name]}),L.jsxs("p",{children:[L.jsx("span",{className:"font-medium",children:"Jurisdiction:"})," ",n.user.jurisdiction||"N/A"]})]})]})]}),L.jsxs("div",{className:"flex justify-end space-x-3 pt-4 border-t",children:[L.jsx(bs,{variant:"secondary",onClick:()=>o(!1),children:"Close"}),L.jsxs(bs,{onClick:()=>g(n.id),disabled:"revoked"===n.status,className:"flex items-center space-x-2",children:[L.jsx(we,{className:"w-4 h-4"}),L.jsx("span",{children:"Download PDF"})]})]})]})})]})})}function tt(){const[s,t]=e.useState([]),[a,r]=e.useState(!0),[l,i]=e.useState(null),[n,c]=e.useState(!1),[d,o]=e.useState(""),[m,x]=e.useState(!1);e.useEffect(()=>{u()},[]);const u=async()=>{try{r(!0);const e=await ie.getSettings();e.success&&e.data&&t(e.data)}catch(e){}finally{r(!1)}},h=e=>{switch(e.toLowerCase()){case"general":return L.jsx(Ae,{className:"w-5 h-5 text-purple-600"});case"test":return L.jsx(be,{className:"w-5 h-5 text-yellow-600"});case"security":return L.jsx(Ve,{className:"w-5 h-5 text-red-600"});default:return L.jsx(Ye,{className:"w-5 h-5 text-gray-600"})}},p=s.reduce((e,s)=>(e[s.category]||(e[s.category]=[]),e[s.category].push(s),e),{}),g=e=>{switch(e.type){case"boolean":return L.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium "+("true"===e.value?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:"true"===e.value?"Enabled":"Disabled"});case"number":return L.jsx("span",{className:"font-mono text-sm font-medium text-blue-600",children:e.value});case"color":return L.jsxs("div",{className:"flex items-center space-x-2",children:[L.jsx("div",{className:"w-6 h-6 rounded border border-gray-300",style:{backgroundColor:e.value}}),L.jsx("span",{className:"font-mono text-sm",children:e.value})]});case"json":return L.jsx("span",{className:"font-mono text-xs text-gray-600 truncate",children:e.value});default:return L.jsx("span",{className:"text-sm font-medium",children:e.value})}};return L.jsx(Ms,{children:L.jsxs("div",{className:"p-6",children:[L.jsxs("div",{className:"flex items-center justify-between mb-6",children:[L.jsxs("div",{children:[L.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"System Settings"}),L.jsx("p",{className:"text-gray-600 mt-2",children:"Configure system-wide settings and preferences"})]}),L.jsxs("div",{className:"flex items-center space-x-3",children:[m&&L.jsxs("div",{className:"flex items-center space-x-2 text-green-600",children:[L.jsx(Ze,{className:"w-4 h-4"}),L.jsx("span",{className:"text-sm",children:"Changes saved"})]}),L.jsxs(bs,{variant:"secondary",onClick:u,className:"flex items-center space-x-2",children:[L.jsx(Be,{className:"w-4 h-4"}),L.jsx("span",{children:"Refresh"})]})]})]}),a?L.jsxs("div",{className:"text-center py-8",children:[L.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),L.jsx("p",{className:"text-gray-500 mt-2",children:"Loading settings..."})]}):L.jsx("div",{className:"space-y-8",children:Object.entries(p).map(([e,s])=>L.jsxs(As,{children:[L.jsxs("div",{className:"flex items-center space-x-3 mb-6",children:[h(e),L.jsxs("h2",{className:"text-xl font-semibold text-gray-900 capitalize",children:[e," Settings"]})]}),L.jsx("div",{className:"space-y-4",children:s.map(e=>L.jsxs("div",{className:"flex items-center justify-between p-4 border border-gray-200 rounded-lg hover:bg-gray-50",children:[L.jsxs("div",{className:"flex-1",children:[L.jsxs("div",{className:"flex items-center space-x-3",children:[L.jsx("h3",{className:"font-medium text-gray-900",children:e.key}),L.jsx("span",{className:"px-2 py-1 text-xs rounded-full font-medium "+("boolean"===e.type?"bg-green-100 text-green-700":"number"===e.type?"bg-blue-100 text-blue-700":"color"===e.type?"bg-purple-100 text-purple-700":"email"===e.type?"bg-teal-100 text-teal-700":"url"===e.type?"bg-indigo-100 text-indigo-700":"json"===e.type?"bg-orange-100 text-orange-700":"bg-gray-100 text-gray-600"),children:e.type}),!e.isEditable&&L.jsx("span",{className:"px-2 py-1 bg-red-100 text-red-600 text-xs rounded-full font-medium",children:"Read Only"})]}),L.jsx("p",{className:"text-sm text-gray-600 mt-1",children:e.description}),L.jsx("div",{className:"mt-2",children:g(e)}),L.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:["Last updated: ",js(e.updatedAt),e.updatedBy&&` by ${e.updatedBy}`]})]}),L.jsx("div",{className:"flex items-center space-x-2",children:e.isEditable?L.jsxs(bs,{variant:"secondary",size:"sm",onClick:()=>(e=>{i(e),o(e.value),c(!0)})(e),className:"flex items-center space-x-2",children:[L.jsx(Ke,{className:"w-4 h-4"}),L.jsx("span",{children:"Edit"})]}):L.jsx("span",{className:"text-xs text-gray-500 px-3 py-1 bg-gray-100 rounded-full",children:"Read Only"})})]},e.id))})]},e))}),L.jsx(us,{isOpen:n,onClose:()=>{c(!1),i(null),o("")},title:"Edit Setting",children:l&&L.jsxs("div",{className:"space-y-4",children:[L.jsxs("div",{children:[L.jsx("h3",{className:"text-lg font-medium text-gray-900",children:l.key}),L.jsx("p",{className:"text-sm text-gray-600 mt-1",children:l.description}),L.jsxs("div",{className:"mt-2 flex items-center space-x-2",children:[L.jsx("span",{className:"px-2 py-1 bg-gray-100 text-gray-600 text-xs rounded-full",children:l.type}),L.jsx("span",{className:"px-2 py-1 bg-blue-100 text-blue-600 text-xs rounded-full",children:l.category})]})]}),L.jsxs("div",{children:[L.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Current Value"}),L.jsx("div",{className:"p-3 bg-gray-50 rounded-lg",children:g(l)})]}),L.jsxs("div",{children:[L.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"New Value"}),(()=>{if(!l)return null;switch(l.type){case"boolean":return L.jsxs("select",{value:d,onChange:e=>o(e.target.value),className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[L.jsx("option",{value:"true",children:"Enabled"}),L.jsx("option",{value:"false",children:"Disabled"})]});case"number":return L.jsx(Ns,{type:"number",value:d,onChange:e=>o(e.target.value),placeholder:"Enter number value"});case"color":return L.jsxs("div",{className:"space-y-2",children:[L.jsx(Ns,{type:"color",value:d,onChange:e=>o(e.target.value),className:"h-12"}),L.jsx(Ns,{type:"text",value:d,onChange:e=>o(e.target.value),placeholder:"Enter hex color code"})]});case"email":return L.jsx(Ns,{type:"email",value:d,onChange:e=>o(e.target.value),placeholder:"Enter email address"});case"url":return L.jsx(Ns,{type:"url",value:d,onChange:e=>o(e.target.value),placeholder:"Enter URL"});case"select":const e=l.options||[];return L.jsx("select",{value:d,onChange:e=>o(e.target.value),className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:e.map(e=>L.jsx("option",{value:e,children:e},e))});case"json":return L.jsx("textarea",{value:d,onChange:e=>o(e.target.value),placeholder:"Enter JSON value",rows:6,className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 font-mono text-sm"});default:return L.jsx(Ns,{value:d,onChange:e=>o(e.target.value),placeholder:"Enter value"})}})()]}),L.jsxs("div",{className:"flex justify-end space-x-3 pt-4 border-t",children:[L.jsx(bs,{variant:"secondary",onClick:()=>{c(!1),i(null),o("")},children:"Cancel"}),L.jsx(bs,{onClick:async()=>{if(l)try{(await ie.updateSetting(l.id,d)).success&&(t(s.map(e=>e.id===l.id?{...e,value:d,updatedAt:new Date}:e)),c(!1),i(null),o(""),x(!0))}catch(e){}},disabled:d===l.value,children:"Update Setting"})]})]})})]})})}function at(){const s=c(),[t,a]=e.useState([]),[r,l]=e.useState(null),[i,n]=e.useState(!0),[d,o]=e.useState(!1),[m,x]=e.useState(!1),[u,h]=e.useState(""),[p,g]=e.useState("all");e.useEffect(()=>{j()},[]);const j=async()=>{try{n(!0);const e=await ee.getDashboardData();e.success&&e.data&&a(e.data.availableTests)}catch(e){}finally{n(!1)}},y=async e=>{try{x(!0);const a=t.find(s=>s.surveyId===e);if(!a||!a.isEligible||0===a.attemptsLeft)return void alert(`You are not eligible to take this test or have no attempts remaining. Attempts left: ${(null==a?void 0:a.attemptsLeft)||0}`);const r=await X.createTestSession(e);if(!r.success||!r.data)return void alert(`Failed to start test: ${r.message}`);const l=r.data.id;s(`/test/${l}`)}catch(a){alert(`Failed to start test: ${a instanceof Error?a.message:"Please try again."}`)}finally{x(!1),o(!1)}},f=e=>{if(!e.isEligible)return"bg-gray-100 text-gray-800";if(0===e.attemptsLeft)return"bg-red-100 text-red-800";return Math.ceil((new Date(e.targetDate).getTime()-(new Date).getTime())/864e5)<=3?"bg-orange-100 text-orange-800":"bg-green-100 text-green-800"},v=e=>{if(!e.isEligible)return"Not Eligible";if(0===e.attemptsLeft)return"No Attempts Left";const s=Math.ceil((new Date(e.targetDate).getTime()-(new Date).getTime())/864e5);return s<=0?"Overdue":s<=3?`${s} days left`:"Available"},b=t.filter(e=>{const s=e.title.toLowerCase().includes(u.toLowerCase())||e.description.toLowerCase().includes(u.toLowerCase());if("all"===p)return s;const t=Math.ceil((new Date(e.targetDate).getTime()-(new Date).getTime())/864e5);switch(p){case"urgent":return s&&t<=3&&t>0;case"available":return s&&e.isEligible&&e.attemptsLeft>0;case"overdue":return s&&t<=0;default:return s}}),N=t.filter(e=>{const s=Math.ceil((new Date(e.targetDate).getTime()-(new Date).getTime())/864e5);return s<=3&&s>0});return L.jsx(Ms,{children:L.jsxs("div",{className:"p-6",children:[L.jsxs("div",{className:"flex items-center justify-between mb-8",children:[L.jsxs("div",{children:[L.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Available Tests"}),L.jsx("p",{className:"text-gray-600 mt-2",children:"View and start your assigned tests"})]}),L.jsx("div",{className:"flex items-center space-x-3",children:L.jsxs(bs,{variant:"secondary",className:"flex items-center space-x-2",children:[L.jsx(ge,{className:"w-4 h-4"}),L.jsx("span",{children:"Study Materials"})]})})]}),L.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8",children:[L.jsx(As,{children:L.jsxs("div",{className:"flex items-center justify-between",children:[L.jsxs("div",{children:[L.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Tests"}),L.jsx("p",{className:"text-3xl font-bold text-blue-600",children:t.length})]}),L.jsx("div",{className:"p-3 rounded-full bg-blue-100",children:L.jsx(Se,{className:"w-6 h-6 text-blue-600"})})]})}),L.jsx(As,{children:L.jsxs("div",{className:"flex items-center justify-between",children:[L.jsxs("div",{children:[L.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Available"}),L.jsx("p",{className:"text-3xl font-bold text-green-600",children:t.filter(e=>e.isEligible&&e.attemptsLeft>0).length})]}),L.jsx("div",{className:"p-3 rounded-full bg-green-100",children:L.jsx(ve,{className:"w-6 h-6 text-green-600"})})]})}),L.jsx(As,{children:L.jsxs("div",{className:"flex items-center justify-between",children:[L.jsxs("div",{children:[L.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Urgent"}),L.jsx("p",{className:"text-3xl font-bold text-orange-600",children:N.length})]}),L.jsx("div",{className:"p-3 rounded-full bg-orange-100",children:L.jsx(oe,{className:"w-6 h-6 text-orange-600"})})]})}),L.jsx(As,{children:L.jsxs("div",{className:"flex items-center justify-between",children:[L.jsxs("div",{children:[L.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Overdue"}),L.jsx("p",{className:"text-3xl font-bold text-red-600",children:t.filter(e=>Math.ceil((new Date(e.targetDate).getTime()-(new Date).getTime())/864e5)<=0).length})]}),L.jsx("div",{className:"p-3 rounded-full bg-red-100",children:L.jsx(be,{className:"w-6 h-6 text-red-600"})})]})})]}),N.length>0&&L.jsxs(As,{className:"mb-8 border-l-4 border-orange-500 bg-orange-50",children:[L.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[L.jsx(oe,{className:"w-6 h-6 text-orange-600"}),L.jsx("h3",{className:"text-lg font-semibold text-orange-900",children:"Urgent: Tests Due Soon"})]}),L.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:N.map(e=>L.jsxs("div",{className:"bg-white rounded-lg p-4 border border-orange-200",children:[L.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:e.title}),L.jsxs("div",{className:"space-y-1 text-sm",children:[L.jsxs("p",{className:"text-gray-600",children:[L.jsx(fe,{className:"w-4 h-4 inline mr-1"}),"Due: ",gs(e.targetDate)]}),L.jsxs("p",{className:"font-medium text-orange-600",children:[Math.ceil((new Date(e.targetDate).getTime()-(new Date).getTime())/864e5)," days left"]})]}),L.jsxs(bs,{onClick:()=>y(e.surveyId),disabled:!e.isEligible||0===e.attemptsLeft,size:"sm",className:"w-full mt-3",children:[L.jsx(Fe,{className:"w-4 h-4 mr-2"}),"Start Test"]})]},e.surveyId))})]}),L.jsx(As,{className:"mb-6",children:L.jsx("div",{className:"flex items-center justify-between",children:L.jsxs("div",{className:"flex items-center space-x-4",children:[L.jsxs("div",{className:"relative",children:[L.jsx(Qe,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),L.jsx(Ns,{placeholder:"Search tests...",value:u,onChange:e=>h(e.target.value),className:"pl-10 w-64"})]}),L.jsxs("select",{value:p,onChange:e=>g(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[L.jsx("option",{value:"all",children:"All Tests"}),L.jsx("option",{value:"available",children:"Available"}),L.jsx("option",{value:"urgent",children:"Urgent (Due Soon)"}),L.jsx("option",{value:"overdue",children:"Overdue"})]})]})})}),L.jsx(As,{children:i?L.jsxs("div",{className:"text-center py-8",children:[L.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),L.jsx("p",{className:"text-gray-500 mt-2",children:"Loading tests..."})]}):L.jsx("div",{className:"space-y-4",children:b.map(e=>L.jsx("div",{className:"border border-gray-200 rounded-lg p-6 hover:shadow-md transition-shadow",children:L.jsxs("div",{className:"flex items-center justify-between mb-4",children:[L.jsxs("div",{className:"flex-1",children:[L.jsx("h4",{className:"text-lg font-semibold text-gray-900 mb-2",children:e.title}),L.jsx("p",{className:"text-gray-600 text-sm mb-3",children:e.description}),L.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[L.jsxs("div",{className:"flex items-center space-x-2",children:[L.jsx(fe,{className:"w-4 h-4 text-gray-400"}),L.jsxs("span",{children:["Due: ",gs(e.targetDate)]})]}),L.jsxs("div",{className:"flex items-center space-x-2",children:[L.jsx(be,{className:"w-4 h-4 text-gray-400"}),L.jsxs("span",{children:["Duration: ",ys(e.duration)]})]}),L.jsxs("div",{className:"flex items-center space-x-2",children:[L.jsx(Se,{className:"w-4 h-4 text-gray-400"}),L.jsxs("span",{children:[e.totalQuestions," Questions"]})]}),L.jsxs("div",{className:"flex items-center space-x-2",children:[L.jsx(He,{className:"w-4 h-4 text-gray-400"}),L.jsxs("span",{children:["Pass: ",e.passingScore,"%"]})]})]})]}),L.jsxs("div",{className:"flex items-center space-x-4",children:[L.jsxs("div",{className:"text-center",children:[L.jsx("span",{className:`inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ${f(e)}`,children:v(e)}),L.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[e.attemptsLeft,"/",e.maxAttempts," attempts left"]})]}),L.jsxs("div",{className:"flex flex-col space-y-2",children:[L.jsxs(bs,{onClick:()=>(e=>{l(e),o(!0)})(e),variant:"secondary",size:"sm",className:"flex items-center space-x-2",children:[L.jsx(_e,{className:"w-4 h-4"}),L.jsx("span",{children:"Details"})]}),L.jsxs(bs,{onClick:()=>y(e.surveyId),disabled:!e.isEligible||0===e.attemptsLeft||m,loading:m&&(null==r?void 0:r.surveyId)===e.surveyId,size:"sm",className:"flex items-center space-x-2",children:[L.jsx(Fe,{className:"w-4 h-4"}),L.jsx("span",{children:"Start Test"})]})]})]})]})},e.surveyId))})}),L.jsx(us,{isOpen:d,onClose:()=>o(!1),title:`Test Details: ${null==r?void 0:r.title}`,size:"lg",children:r&&L.jsxs("div",{className:"space-y-6",children:[L.jsxs("div",{children:[L.jsx("h4",{className:"font-semibold text-gray-900 mb-2",children:"Description"}),L.jsx("p",{className:"text-gray-600",children:r.description})]}),L.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[L.jsxs("div",{children:[L.jsx("h4",{className:"font-semibold text-gray-900 mb-3",children:"Test Information"}),L.jsxs("div",{className:"space-y-2 text-sm",children:[L.jsxs("p",{children:[L.jsx("span",{className:"font-medium",children:"Duration:"})," ",ys(r.duration)]}),L.jsxs("p",{children:[L.jsx("span",{className:"font-medium",children:"Questions:"})," ",r.totalQuestions]}),L.jsxs("p",{children:[L.jsx("span",{className:"font-medium",children:"Passing Score:"})," ",r.passingScore,"%"]}),L.jsxs("p",{children:[L.jsx("span",{className:"font-medium",children:"Target Date:"})," ",gs(r.targetDate)]})]})]}),L.jsxs("div",{children:[L.jsx("h4",{className:"font-semibold text-gray-900 mb-3",children:"Attempt Information"}),L.jsxs("div",{className:"space-y-2 text-sm",children:[L.jsxs("p",{children:[L.jsx("span",{className:"font-medium",children:"Attempts Left:"})," ",r.attemptsLeft,"/",r.maxAttempts]}),L.jsxs("p",{children:[L.jsx("span",{className:"font-medium",children:"Eligibility:"}),L.jsx("span",{className:"ml-2 "+(r.isEligible?"text-green-600":"text-red-600"),children:r.isEligible?"Eligible":"Not Eligible"})]})]})]})]}),L.jsxs("div",{className:"flex justify-end space-x-3 pt-4 border-t",children:[L.jsx(bs,{variant:"secondary",onClick:()=>o(!1),children:"Close"}),L.jsxs(bs,{onClick:()=>{y(r.surveyId)},disabled:!r.isEligible||0===r.attemptsLeft||m,loading:m&&(null==r?void 0:r.surveyId)===r.surveyId,className:"flex items-center space-x-2",children:[L.jsx(Fe,{className:"w-4 h-4"}),L.jsx("span",{children:"Start Test"})]})]})]})})]})})}function rt(){const[s,t]=e.useState([]),[a,r]=e.useState(null),[l,i]=e.useState(!0),[n,c]=e.useState(!1),[d,o]=e.useState(""),[m,x]=e.useState("all"),[u,p]=e.useState(!1),[v,b]=e.useState(""),[N,w]=e.useState(!1);e.useEffect(()=>{var e;C();const s=(null==(e=window.history.state)?void 0:e.usr)||window.history.state;(null==s?void 0:s.message)&&(b(s.message),p(!0),s.showCertificate&&w(!0),window.history.replaceState({},document.title),setTimeout(()=>{p(!1),w(!1)},5e3))},[]);const C=async()=>{try{i(!0);const e=await ee.getDashboardData();e.success&&e.data&&t(e.data.completedTests)}catch(e){}finally{i(!1)}},k=s.filter(e=>{const s=e.surveyTitle.toLowerCase().includes(d.toLowerCase());return"all"===m?s:"passed"===m?s&&e.isPassed:"failed"===m?s&&!e.isPassed:s}),A=s.filter(e=>e.isPassed).length;s.filter(e=>!e.isPassed).length;const E=s.length>0?s.reduce((e,s)=>e+s.score,0)/s.length:0,D=s.filter(e=>e.certificateId).length,R=s.map((e,s)=>({attempt:s+1,score:e.score,name:e.surveyTitle.substring(0,15)+"...",isPassed:e.isPassed}));return L.jsx(Ms,{children:L.jsxs("div",{className:"p-6",children:[L.jsxs("div",{className:"flex items-center justify-between mb-8",children:[L.jsxs("div",{children:[L.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"My Results"}),L.jsx("p",{className:"text-gray-600 mt-2",children:"View your test performance and progress"})]}),L.jsx("div",{className:"flex items-center space-x-3",children:L.jsxs(bs,{variant:"secondary",className:"flex items-center space-x-2",children:[L.jsx(we,{className:"w-4 h-4"}),L.jsx("span",{children:"Export Results"})]})})]}),L.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8",children:[L.jsx(As,{children:L.jsxs("div",{className:"flex items-center justify-between",children:[L.jsxs("div",{children:[L.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Tests"}),L.jsx("p",{className:"text-3xl font-bold text-blue-600",children:s.length})]}),L.jsx("div",{className:"p-3 rounded-full bg-blue-100",children:L.jsx(he,{className:"w-6 h-6 text-blue-600"})})]})}),L.jsx(As,{children:L.jsxs("div",{className:"flex items-center justify-between",children:[L.jsxs("div",{children:[L.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Passed"}),L.jsx("p",{className:"text-3xl font-bold text-green-600",children:A})]}),L.jsx("div",{className:"p-3 rounded-full bg-green-100",children:L.jsx(ve,{className:"w-6 h-6 text-green-600"})})]})}),L.jsx(As,{children:L.jsxs("div",{className:"flex items-center justify-between",children:[L.jsxs("div",{children:[L.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Average Score"}),L.jsxs("p",{className:"text-3xl font-bold text-yellow-600",children:[E.toFixed(1),"%"]})]}),L.jsx("div",{className:"p-3 rounded-full bg-yellow-100",children:L.jsx(He,{className:"w-6 h-6 text-yellow-600"})})]})}),L.jsx(As,{children:L.jsxs("div",{className:"flex items-center justify-between",children:[L.jsxs("div",{children:[L.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Certificates"}),L.jsx("p",{className:"text-3xl font-bold text-purple-600",children:D})]}),L.jsx("div",{className:"p-3 rounded-full bg-purple-100",children:L.jsx(as,{className:"w-6 h-6 text-purple-600"})})]})})]}),u&&L.jsx("div",{className:"mb-6",children:L.jsxs("div",{className:"bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded-lg flex items-center space-x-2",children:[L.jsx(ve,{className:"w-5 h-5"}),L.jsx("span",{children:v})]})}),N&&L.jsx("div",{className:"mb-6",children:L.jsxs("div",{className:"bg-yellow-100 border border-yellow-400 text-yellow-700 px-4 py-3 rounded-lg flex items-center justify-between",children:[L.jsxs("div",{className:"flex items-center space-x-2",children:[L.jsx(as,{className:"w-5 h-5"}),L.jsx("span",{children:"Congratulations! You've earned a certificate for passing this test."})]}),L.jsxs(bs,{size:"sm",onClick:()=>window.location.href="/my-certificates",className:"flex items-center space-x-2",children:[L.jsx(ue,{className:"w-4 h-4"}),L.jsx("span",{children:"View Certificate"})]})]})}),s.length>0&&L.jsxs(As,{className:"mb-8",children:[L.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Performance Trend"}),L.jsx("div",{className:"h-64",children:L.jsx(h,{width:"100%",height:"100%",children:L.jsxs(_,{data:R,children:[L.jsx(g,{strokeDasharray:"3 3"}),L.jsx(j,{dataKey:"attempt"}),L.jsx(y,{domain:[0,100]}),L.jsx(f,{formatter:(e,s)=>[`${e}%`,"Score"]}),L.jsx(S,{type:"monotone",dataKey:"score",stroke:"#3B82F6",strokeWidth:2,dot:{fill:"#3B82F6",strokeWidth:2,r:4}})]})})})]}),L.jsx(As,{className:"mb-6",children:L.jsx("div",{className:"flex items-center justify-between",children:L.jsxs("div",{className:"flex items-center space-x-4",children:[L.jsxs("div",{className:"relative",children:[L.jsx(Qe,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),L.jsx(Ns,{placeholder:"Search results...",value:d,onChange:e=>o(e.target.value),className:"pl-10 w-64"})]}),L.jsxs("select",{value:m,onChange:e=>x(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[L.jsx("option",{value:"all",children:"All Results"}),L.jsx("option",{value:"passed",children:"Passed"}),L.jsx("option",{value:"failed",children:"Failed"})]})]})})}),L.jsx(As,{children:l?L.jsxs("div",{className:"text-center py-8",children:[L.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),L.jsx("p",{className:"text-gray-500 mt-2",children:"Loading results..."})]}):0===k.length?L.jsxs("div",{className:"text-center py-8",children:[L.jsx(he,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),L.jsx("p",{className:"text-gray-500",children:"No test results found"}),L.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"Complete some tests to see your results here"})]}):L.jsx("div",{className:"space-y-4",children:k.map(e=>L.jsx("div",{className:"border border-gray-200 rounded-lg p-6 hover:shadow-md transition-shadow",children:L.jsxs("div",{className:"flex items-center justify-between",children:[L.jsxs("div",{className:"flex-1",children:[L.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[L.jsx("h4",{className:"text-lg font-semibold text-gray-900",children:e.surveyTitle}),e.isPassed?L.jsx(ve,{className:"w-5 h-5 text-green-600"}):L.jsx(ms,{className:"w-5 h-5 text-red-600"}),e.certificateId&&L.jsx(ue,{className:"w-5 h-5 text-yellow-600"})]}),L.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm text-gray-600",children:[L.jsxs("div",{children:[L.jsx("span",{className:"font-medium",children:"Score:"}),L.jsxs("span",{className:`ml-2 font-bold ${vs(e.score)}`,children:[e.score,"%"]})]}),L.jsxs("div",{children:[L.jsx("span",{className:"font-medium",children:"Status:"}),L.jsx("span",{className:"ml-2 font-medium "+(e.isPassed?"text-green-600":"text-red-600"),children:e.isPassed?"Passed":"Failed"})]}),L.jsxs("div",{children:[L.jsx("span",{className:"font-medium",children:"Attempt:"}),L.jsx("span",{className:"ml-2",children:e.attemptNumber})]}),L.jsxs("div",{children:[L.jsx("span",{className:"font-medium",children:"Completed:"}),L.jsx("span",{className:"ml-2",children:gs(e.completedAt)})]})]})]}),L.jsxs("div",{className:"flex items-center space-x-4",children:[L.jsxs("div",{className:"text-center",children:[L.jsxs("div",{className:`text-3xl font-bold ${vs(e.score)}`,children:[e.score,"%"]}),L.jsx("p",{className:"text-xs text-gray-500",children:"Score"})]}),L.jsxs("div",{className:"flex flex-col space-y-2",children:[L.jsxs(bs,{onClick:()=>(r(e),void c(!0)),variant:"secondary",size:"sm",className:"flex items-center space-x-2",children:[L.jsx(_e,{className:"w-4 h-4"}),L.jsx("span",{children:"View Details"})]}),e.certificateId&&L.jsxs(bs,{size:"sm",className:"flex items-center space-x-2",children:[L.jsx(ue,{className:"w-4 h-4"}),L.jsx("span",{children:"Certificate"})]})]})]})]})},e.resultId))})}),L.jsx(us,{isOpen:n,onClose:()=>c(!1),title:"Test Result Details",size:"lg",children:a&&L.jsxs("div",{className:"space-y-6",children:[L.jsxs("div",{className:"text-center",children:[L.jsxs("div",{className:`text-6xl font-bold ${vs(a.score)} mb-2`,children:[a.score,"%"]}),L.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-1",children:a.surveyTitle}),L.jsx("div",{className:"flex items-center justify-center space-x-2",children:a.isPassed?L.jsxs(L.Fragment,{children:[L.jsx(ve,{className:"w-5 h-5 text-green-600"}),L.jsx("span",{className:"text-green-600 font-medium",children:"Passed"})]}):L.jsxs(L.Fragment,{children:[L.jsx(ms,{className:"w-5 h-5 text-red-600"}),L.jsx("span",{className:"text-red-600 font-medium",children:"Failed"})]})})]}),L.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[L.jsxs("div",{children:[L.jsx("h4",{className:"font-semibold text-gray-900 mb-3",children:"Test Information"}),L.jsxs("div",{className:"space-y-2 text-sm",children:[L.jsxs("p",{children:[L.jsx("span",{className:"font-medium",children:"Attempt Number:"})," ",a.attemptNumber]}),L.jsxs("p",{children:[L.jsx("span",{className:"font-medium",children:"Completed:"})," ",gs(a.completedAt)]}),L.jsxs("p",{children:[L.jsx("span",{className:"font-medium",children:"Score:"}),L.jsxs("span",{className:`ml-2 font-bold ${vs(a.score)}`,children:[a.score,"%"]})]}),L.jsxs("p",{children:[L.jsx("span",{className:"font-medium",children:"Status:"}),L.jsx("span",{className:"ml-2 font-medium "+(a.isPassed?"text-green-600":"text-red-600"),children:a.isPassed?"Passed":"Failed"})]})]})]}),L.jsxs("div",{children:[L.jsx("h4",{className:"font-semibold text-gray-900 mb-3",children:"Achievement"}),L.jsx("div",{className:"space-y-2 text-sm",children:a.certificateId?L.jsxs("div",{className:"flex items-center space-x-2 text-green-600",children:[L.jsx(ue,{className:"w-5 h-5"}),L.jsx("span",{className:"font-medium",children:"Certificate Earned"})]}):L.jsxs("div",{className:"flex items-center space-x-2 text-gray-500",children:[L.jsx(ue,{className:"w-5 h-5"}),L.jsx("span",{children:"No certificate earned"})]})})]})]}),L.jsxs("div",{className:"flex justify-end space-x-3 pt-4 border-t",children:[L.jsx(bs,{variant:"secondary",onClick:()=>c(!1),children:"Close"}),a.certificateId&&L.jsxs(bs,{className:"flex items-center space-x-2",children:[L.jsx(ue,{className:"w-4 h-4"}),L.jsx("span",{children:"View Certificate"})]})]})]})})]})})}function lt(){const[s,t]=e.useState([]),[a,r]=e.useState(null),[l,i]=e.useState(!0),[n,c]=e.useState(!1),[d,o]=e.useState("");e.useEffect(()=>{var e;m();const s=(null==(e=window.history.state)?void 0:e.usr)||window.history.state;(null==s?void 0:s.newCertificate)&&(setTimeout(()=>{m()},1e3),window.history.replaceState({},document.title))},[]);const m=async()=>{try{i(!0);const e=await ee.getDashboardData();e.success&&e.data&&t(e.data.certificates)}catch(e){}finally{i(!1)}},x=async e=>{try{const a=(await le.downloadCertificate(e)).data,r=URL.createObjectURL(a),l=document.createElement("a");l.href=r;const i=s.find(s=>s.id===e),n=i?`${i.certificateNumber}_${i.survey.title.replace(/[^a-zA-Z0-9]/g,"_")}.pdf`:`certificate_${e}.pdf`;l.download=n,document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(r),t(s.map(s=>s.id===e?{...s,downloadCount:s.downloadCount+1}:s))}catch(a){alert("Failed to download certificate. Please try again.")}},u=s.filter(e=>e.survey.title.toLowerCase().includes(d.toLowerCase())||e.certificateNumber.toLowerCase().includes(d.toLowerCase())),h=s.filter(e=>"active"===e.status).length,p=s.reduce((e,s)=>e+s.downloadCount,0);return L.jsx(Ms,{children:L.jsxs("div",{className:"p-6",children:[L.jsxs("div",{className:"flex items-center justify-between mb-8",children:[L.jsxs("div",{children:[L.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"My Certificates"}),L.jsx("p",{className:"text-gray-600 mt-2",children:"View and download your earned certificates"})]}),L.jsx("div",{className:"flex items-center space-x-3",children:L.jsxs(bs,{variant:"secondary",className:"flex items-center space-x-2",children:[L.jsx(we,{className:"w-4 h-4"}),L.jsx("span",{children:"Download All"})]})})]}),L.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[L.jsx(As,{children:L.jsxs("div",{className:"flex items-center justify-between",children:[L.jsxs("div",{children:[L.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Certificates"}),L.jsx("p",{className:"text-3xl font-bold text-purple-600",children:s.length})]}),L.jsx("div",{className:"p-3 rounded-full bg-purple-100",children:L.jsx(as,{className:"w-6 h-6 text-purple-600"})})]})}),L.jsx(As,{children:L.jsxs("div",{className:"flex items-center justify-between",children:[L.jsxs("div",{children:[L.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Active"}),L.jsx("p",{className:"text-3xl font-bold text-green-600",children:h})]}),L.jsx("div",{className:"p-3 rounded-full bg-green-100",children:L.jsx(ve,{className:"w-6 h-6 text-green-600"})})]})}),L.jsx(As,{children:L.jsxs("div",{className:"flex items-center justify-between",children:[L.jsxs("div",{children:[L.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Downloads"}),L.jsx("p",{className:"text-3xl font-bold text-blue-600",children:p})]}),L.jsx("div",{className:"p-3 rounded-full bg-blue-100",children:L.jsx(we,{className:"w-6 h-6 text-blue-600"})})]})})]}),L.jsx(As,{className:"mb-6",children:L.jsxs("div",{className:"relative",children:[L.jsx(Qe,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),L.jsx(Ns,{placeholder:"Search certificates...",value:d,onChange:e=>o(e.target.value),className:"pl-10"})]})}),L.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:l?Array.from({length:6}).map((e,s)=>L.jsx(As,{className:"animate-pulse",children:L.jsx("div",{className:"h-48 bg-gray-200 rounded-lg"})},s)):0===u.length?L.jsxs("div",{className:"col-span-full text-center py-12",children:[L.jsx(as,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),L.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Certificates Yet"}),L.jsx("p",{className:"text-gray-500",children:"Complete tests to earn certificates"})]}):u.map(e=>L.jsxs(As,{className:"hover:shadow-lg transition-shadow overflow-hidden",children:[L.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-purple-100 p-6 text-center border-b",children:[L.jsx("div",{className:"w-16 h-16 bg-yellow-100 rounded-full flex items-center justify-center mx-auto mb-4",children:L.jsx(ue,{className:"w-8 h-8 text-yellow-600"})}),L.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-1",children:"Certificate of Completion"}),L.jsx("p",{className:"text-sm text-gray-600",children:"eSigma Survey Platform"})]}),L.jsxs("div",{className:"p-6",children:[L.jsx("h4",{className:"font-semibold text-gray-900 mb-2",children:e.survey.title}),L.jsxs("div",{className:"space-y-2 text-sm text-gray-600 mb-4",children:[L.jsxs("p",{children:[L.jsx("span",{className:"font-medium",children:"Certificate #:"})," ",e.certificateNumber]}),L.jsxs("p",{children:[L.jsx("span",{className:"font-medium",children:"Issued:"})," ",gs(e.issuedAt)]}),L.jsxs("p",{children:[L.jsx("span",{className:"font-medium",children:"Status:"}),L.jsx("span",{className:"ml-2 px-2 py-1 rounded-full text-xs font-medium "+("active"===e.status?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"),children:e.status.charAt(0).toUpperCase()+e.status.slice(1)})]}),L.jsxs("p",{children:[L.jsx("span",{className:"font-medium",children:"Downloads:"})," ",e.downloadCount]})]}),L.jsxs("div",{className:"flex space-x-2",children:[L.jsxs(bs,{onClick:()=>(e=>{r(e),c(!0)})(e),variant:"secondary",size:"sm",className:"flex-1 flex items-center justify-center space-x-2",children:[L.jsx(_e,{className:"w-4 h-4"}),L.jsx("span",{children:"Preview"})]}),L.jsxs(bs,{onClick:()=>x(e.id),size:"sm",className:"flex-1 flex items-center justify-center space-x-2",disabled:"active"!==e.status,children:[L.jsx(we,{className:"w-4 h-4"}),L.jsx("span",{children:"Download"})]})]})]})]},e.id))}),L.jsx(us,{isOpen:n,onClose:()=>c(!1),title:"Certificate Preview",size:"xl",children:a&&L.jsxs("div",{className:"space-y-6",children:[L.jsx("div",{className:"bg-gradient-to-br from-blue-50 to-indigo-100 p-8 rounded-lg border-2 border-blue-200",children:L.jsxs("div",{className:"text-center space-y-4",children:[L.jsx("div",{className:"flex justify-center",children:L.jsx("div",{className:"w-20 h-20 bg-blue-600 rounded-full flex items-center justify-center",children:L.jsx(ue,{className:"w-10 h-10 text-white"})})}),L.jsxs("div",{children:[L.jsx("h2",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Certificate of Completion"}),L.jsx("p",{className:"text-lg text-gray-600",children:"eSigma Survey Platform"})]}),L.jsxs("div",{className:"py-6",children:[L.jsx("p",{className:"text-lg text-gray-700 mb-2",children:"This is to certify that"}),L.jsx("h3",{className:"text-2xl font-bold text-blue-600 mb-2",children:a.user.name}),L.jsx("p",{className:"text-lg text-gray-700 mb-2",children:"has successfully completed"}),L.jsx("h4",{className:"text-xl font-semibold text-gray-900 mb-4",children:a.survey.title}),L.jsxs("div",{className:"flex items-center justify-center space-x-2 text-green-600",children:[L.jsx(We,{className:"w-5 h-5 fill-current"}),L.jsx("span",{className:"font-medium",children:"With Excellence"}),L.jsx(We,{className:"w-5 h-5 fill-current"})]})]}),L.jsxs("div",{className:"flex justify-between items-center pt-6 border-t border-blue-200",children:[L.jsxs("div",{children:[L.jsx("p",{className:"text-sm text-gray-600",children:"Certificate Number"}),L.jsx("p",{className:"font-mono text-sm font-medium",children:a.certificateNumber})]}),L.jsxs("div",{children:[L.jsx("p",{className:"text-sm text-gray-600",children:"Date Issued"}),L.jsx("p",{className:"text-sm font-medium",children:gs(a.issuedAt)})]})]})]})}),L.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[L.jsxs("div",{children:[L.jsx("h4",{className:"font-semibold text-gray-900 mb-3",children:"Certificate Details"}),L.jsxs("div",{className:"space-y-2 text-sm",children:[L.jsxs("p",{children:[L.jsx("span",{className:"font-medium",children:"Number:"})," ",a.certificateNumber]}),L.jsxs("p",{children:[L.jsx("span",{className:"font-medium",children:"Survey:"})," ",a.survey.title]}),L.jsxs("p",{children:[L.jsx("span",{className:"font-medium",children:"Issued:"})," ",gs(a.issuedAt)]}),L.jsxs("p",{children:[L.jsx("span",{className:"font-medium",children:"Status:"}),L.jsx("span",{className:"ml-2 px-2 py-1 rounded-full text-xs font-medium "+("active"===a.status?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"),children:a.status.charAt(0).toUpperCase()+a.status.slice(1)})]}),L.jsxs("p",{children:[L.jsx("span",{className:"font-medium",children:"Downloads:"})," ",a.downloadCount]})]})]}),L.jsxs("div",{children:[L.jsx("h4",{className:"font-semibold text-gray-900 mb-3",children:"Verification"}),L.jsxs("div",{className:"space-y-2 text-sm",children:[L.jsxs("p",{children:[L.jsx("span",{className:"font-medium",children:"Recipient:"})," ",a.user.name]}),L.jsxs("p",{children:[L.jsx("span",{className:"font-medium",children:"Email:"})," ",a.user.email]}),L.jsxs("p",{children:[L.jsx("span",{className:"font-medium",children:"Role:"})," ",a.user.role.name]}),L.jsxs("div",{className:"flex items-center space-x-2 text-green-600 mt-3",children:[L.jsx(ve,{className:"w-4 h-4"}),L.jsx("span",{className:"text-sm font-medium",children:"Verified Certificate"})]})]})]})]}),L.jsxs("div",{className:"flex justify-end space-x-3 pt-4 border-t",children:[L.jsx(bs,{variant:"secondary",onClick:()=>c(!1),children:"Close"}),L.jsxs(bs,{onClick:()=>x(a.id),disabled:"active"!==a.status,className:"flex items-center space-x-2",children:[L.jsx(we,{className:"w-4 h-4"}),L.jsx("span",{children:"Download PDF"})]})]})]})})]})})}function it(){const[s,t]=e.useState([]),[a,r]=e.useState(!0);e.useEffect(()=>{l()},[]);const l=async()=>{try{r(!0);const e=await ee.getDashboardData();e.success&&e.data&&t(e.data.upcomingTests)}catch(e){}finally{r(!1)}},i=e=>e.isOverdue?"bg-red-100 text-red-800":e.daysLeft<=3?"bg-orange-100 text-orange-800":e.daysLeft<=7?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800",n=e=>e.isOverdue?L.jsx(oe,{className:"w-4 h-4"}):e.daysLeft<=3?L.jsx(be,{className:"w-4 h-4"}):L.jsx(ve,{className:"w-4 h-4"}),c=e=>e.isOverdue?"Overdue":0===e.daysLeft?"Due Today":1===e.daysLeft?"Due Tomorrow":`${e.daysLeft} days left`,d=s.filter(e=>e.daysLeft<=3||e.isOverdue),o=s.filter(e=>e.daysLeft<=7&&e.daysLeft>3),m=s.filter(e=>e.daysLeft>7);return L.jsx(Ms,{children:L.jsxs("div",{className:"p-6",children:[L.jsxs("div",{className:"flex items-center justify-between mb-8",children:[L.jsxs("div",{children:[L.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Test Schedule"}),L.jsx("p",{className:"text-gray-600 mt-2",children:"View your upcoming test deadlines and plan accordingly"})]}),L.jsx("div",{className:"flex items-center space-x-3",children:L.jsxs(bs,{variant:"secondary",className:"flex items-center space-x-2",children:[L.jsx(fe,{className:"w-4 h-4"}),L.jsx("span",{children:"Calendar View"})]})})]}),L.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8",children:[L.jsx(As,{children:L.jsxs("div",{className:"flex items-center justify-between",children:[L.jsxs("div",{children:[L.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Upcoming"}),L.jsx("p",{className:"text-3xl font-bold text-blue-600",children:s.length})]}),L.jsx("div",{className:"p-3 rounded-full bg-blue-100",children:L.jsx(Ge,{className:"w-6 h-6 text-blue-600"})})]})}),L.jsx(As,{children:L.jsxs("div",{className:"flex items-center justify-between",children:[L.jsxs("div",{children:[L.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Urgent"}),L.jsx("p",{className:"text-3xl font-bold text-red-600",children:d.length})]}),L.jsx("div",{className:"p-3 rounded-full bg-red-100",children:L.jsx(oe,{className:"w-6 h-6 text-red-600"})})]})}),L.jsx(As,{children:L.jsxs("div",{className:"flex items-center justify-between",children:[L.jsxs("div",{children:[L.jsx("p",{className:"text-sm font-medium text-gray-600",children:"This Week"}),L.jsx("p",{className:"text-3xl font-bold text-yellow-600",children:o.length})]}),L.jsx("div",{className:"p-3 rounded-full bg-yellow-100",children:L.jsx(be,{className:"w-6 h-6 text-yellow-600"})})]})}),L.jsx(As,{children:L.jsxs("div",{className:"flex items-center justify-between",children:[L.jsxs("div",{children:[L.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Later"}),L.jsx("p",{className:"text-3xl font-bold text-green-600",children:m.length})]}),L.jsx("div",{className:"p-3 rounded-full bg-green-100",children:L.jsx(ve,{className:"w-6 h-6 text-green-600"})})]})})]}),a?L.jsx(As,{children:L.jsxs("div",{className:"text-center py-8",children:[L.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),L.jsx("p",{className:"text-gray-500 mt-2",children:"Loading test schedule..."})]})}):0===s.length?L.jsx(As,{children:L.jsxs("div",{className:"text-center py-12",children:[L.jsx(fe,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),L.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Upcoming Tests"}),L.jsx("p",{className:"text-gray-500",children:"You have no scheduled tests at the moment"})]})}):L.jsxs("div",{className:"space-y-8",children:[d.length>0&&L.jsxs("div",{children:[L.jsxs("h2",{className:"text-xl font-semibold text-red-900 mb-4 flex items-center space-x-2",children:[L.jsx(oe,{className:"w-5 h-5"}),L.jsx("span",{children:"Urgent - Immediate Action Required"})]}),L.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:d.map(e=>L.jsxs(As,{className:"border-l-4 border-red-500 bg-red-50",children:[L.jsxs("div",{className:"flex items-center justify-between mb-3",children:[L.jsx("h3",{className:"font-semibold text-gray-900",children:e.title}),L.jsxs("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${i(e)}`,children:[n(e),L.jsx("span",{className:"ml-1",children:c(e)})]})]}),L.jsx("div",{className:"space-y-2 text-sm text-gray-600 mb-4",children:L.jsxs("p",{className:"flex items-center space-x-2",children:[L.jsx(fe,{className:"w-4 h-4"}),L.jsxs("span",{children:["Due: ",gs(e.targetDate)]})]})}),L.jsxs("div",{className:"flex space-x-2",children:[L.jsxs(bs,{size:"sm",className:"flex-1",children:[L.jsx(Fe,{className:"w-4 h-4 mr-1"}),"Start Now"]}),L.jsx(bs,{variant:"secondary",size:"sm",children:L.jsx(_e,{className:"w-4 h-4"})})]})]},e.surveyId))})]}),o.length>0&&L.jsxs("div",{children:[L.jsxs("h2",{className:"text-xl font-semibold text-yellow-900 mb-4 flex items-center space-x-2",children:[L.jsx(be,{className:"w-5 h-5"}),L.jsx("span",{children:"This Week"})]}),L.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:o.map(e=>L.jsxs(As,{className:"border-l-4 border-yellow-500",children:[L.jsxs("div",{className:"flex items-center justify-between mb-3",children:[L.jsx("h3",{className:"font-semibold text-gray-900",children:e.title}),L.jsxs("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${i(e)}`,children:[n(e),L.jsx("span",{className:"ml-1",children:c(e)})]})]}),L.jsx("div",{className:"space-y-2 text-sm text-gray-600 mb-4",children:L.jsxs("p",{className:"flex items-center space-x-2",children:[L.jsx(fe,{className:"w-4 h-4"}),L.jsxs("span",{children:["Due: ",gs(e.targetDate)]})]})}),L.jsxs("div",{className:"flex space-x-2",children:[L.jsxs(bs,{variant:"secondary",size:"sm",className:"flex-1",children:[L.jsx(Fe,{className:"w-4 h-4 mr-1"}),"Start Test"]}),L.jsx(bs,{variant:"secondary",size:"sm",children:L.jsx(_e,{className:"w-4 h-4"})})]})]},e.surveyId))})]}),m.length>0&&L.jsxs("div",{children:[L.jsxs("h2",{className:"text-xl font-semibold text-green-900 mb-4 flex items-center space-x-2",children:[L.jsx(ve,{className:"w-5 h-5"}),L.jsx("span",{children:"Coming Up"})]}),L.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:m.map(e=>L.jsxs(As,{className:"border-l-4 border-green-500",children:[L.jsxs("div",{className:"flex items-center justify-between mb-3",children:[L.jsx("h3",{className:"font-semibold text-gray-900",children:e.title}),L.jsxs("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${i(e)}`,children:[n(e),L.jsx("span",{className:"ml-1",children:c(e)})]})]}),L.jsx("div",{className:"space-y-2 text-sm text-gray-600 mb-4",children:L.jsxs("p",{className:"flex items-center space-x-2",children:[L.jsx(fe,{className:"w-4 h-4"}),L.jsxs("span",{children:["Due: ",gs(e.targetDate)]})]})}),L.jsx("div",{className:"flex space-x-2",children:L.jsxs(bs,{variant:"secondary",size:"sm",className:"flex-1",children:[L.jsx(_e,{className:"w-4 h-4 mr-1"}),"View Details"]})})]},e.surveyId))})]})]})]})})}function nt(){const{sessionId:s}=d(),t=c();o();const[a,r]=e.useState(null),[l,i]=e.useState([]),[n,m]=e.useState(0),[x,u]=e.useState({}),[h,p]=e.useState(0),[g,j]=e.useState(!0),[y,f]=e.useState(!1),[v,b]=e.useState(!1),[N,w]=e.useState(!1),[_,S]=e.useState(!1),[C,k]=e.useState(new Set),[A,E]=e.useState(navigator.onLine),[D,R]=e.useState(null),[T,I]=e.useState(null),[P,O]=e.useState(!1),[q,M]=e.useState(null);e.useState({});const[U,F]=e.useState([]),[z,B]=e.useState(!1);e.useEffect(()=>{const e=e=>(e.ctrlKey||e.metaKey)&&["c","v","x","a","s","p"].includes(e.key.toLowerCase())?(e.preventDefault(),$(`Attempted keyboard shortcut: Ctrl+${e.key.toUpperCase()}`),!1):"F12"===e.key?(e.preventDefault(),$("Attempted to open Developer Tools (F12)"),!1):e.ctrlKey&&e.shiftKey&&"I"===e.key?(e.preventDefault(),$("Attempted to open Developer Tools (Ctrl+Shift+I)"),!1):e.ctrlKey&&"u"===e.key?(e.preventDefault(),$("Attempted to view page source (Ctrl+U)"),!1):"PrintScreen"===e.key?(e.preventDefault(),$("Attempted to take screenshot (Print Screen)"),!1):void 0,s=e=>(e.preventDefault(),$("Attempted to open context menu (right-click)"),!1),t=e=>(e.preventDefault(),$("Attempted to copy content"),!1),a=e=>(e.preventDefault(),$("Attempted to paste content"),!1),r=e=>(e.preventDefault(),$("Attempted to cut content"),!1),l=e=>(e.preventDefault(),!1),i=e=>(e.preventDefault(),!1),n=e=>(e.preventDefault(),e.returnValue="Are you sure you want to leave? Your test progress will be saved but the test will be paused.",e.returnValue),c=e=>(e.preventDefault(),$("Attempted to navigate away from test"),!1),d=window.open;return window.open=function(...e){return $("Attempted to open new window/tab"),null},document.addEventListener("keydown",e),document.addEventListener("contextmenu",s),document.addEventListener("copy",t),document.addEventListener("paste",a),document.addEventListener("cut",r),document.addEventListener("selectstart",l),document.addEventListener("dragstart",i),window.addEventListener("beforeunload",n),window.addEventListener("popstate",c),document.body.style.userSelect="none",document.body.style.webkitUserSelect="none",document.body.style.mozUserSelect="none",document.body.style.msUserSelect="none",()=>{document.removeEventListener("keydown",e),document.removeEventListener("contextmenu",s),document.removeEventListener("copy",t),document.removeEventListener("paste",a),document.removeEventListener("cut",r),document.removeEventListener("selectstart",l),document.removeEventListener("dragstart",i),window.removeEventListener("beforeunload",n),window.removeEventListener("popstate",c),window.open=d,document.body.style.userSelect="",document.body.style.webkitUserSelect="",document.body.style.mozUserSelect="",document.body.style.msUserSelect=""}},[]);const $=e=>{F(s=>[...s,e]),B(!0),setTimeout(()=>{B(!1)},3e3),a&&X.logSecurityViolation(a.id,e).catch(console.error)};e.useEffect(()=>{const e=()=>{E(!0),X.syncOfflineData()},s=()=>{E(!1),a&&!P&&h>0&&(O(!0),M(h))};return window.addEventListener("online",e),window.addEventListener("offline",s),()=>{window.removeEventListener("online",e),window.removeEventListener("offline",s)}},[a,P,h,q]);const Z=e.useCallback(async()=>{if(a&&!P)try{I("saving"),await X.updateSession(a.id,{currentQuestionIndex:n,timeRemaining:h,answers:Object.keys(x).map(e=>({questionId:e,selectedOptions:x[e],isCorrect:!1,timeSpent:0,answered:!0}))}),R(new Date),I("saved"),setTimeout(()=>I(null),2e3)}catch(e){I("error"),setTimeout(()=>I(null),3e3)}},[a,n,h,x,P]);e.useEffect(()=>{if(!a||P)return;const e=setInterval(Z,3e4);return()=>clearInterval(e)},[Z,a,P]),e.useEffect(()=>{if(a&&Object.keys(x).length>0&&!P){const e=setTimeout(Z,2e3);return()=>clearTimeout(e)}},[x,Z,a,P]),e.useEffect(()=>{s&&Q()},[s]),e.useEffect(()=>{if(h>0&&!P&&A){const e=setInterval(()=>{p(e=>{const s=e-1;return s<=0?(Y(),0):(300!==s||N||w(!0),s)})},1e3);return()=>clearInterval(e)}},[h,N,P,A]);const Q=async()=>{try{if(j(!0),!s)throw new Error("Session ID not provided");const e=await X.getSession(s);if(!e.success||!e.data)throw new Error("Session not found or invalid");const t=e.data;if(r(t),await(async e=>{try{j(!0);const s=await H.getSurveySections(e);if(!s.success||!s.data)throw new Error("Failed to load survey sections");const t=s.data;let a=[];for(const e of t){const s=await G.getQuestions(e.id);if(s.success&&s.data){const t=s.data,r=Math.min(e.questions_count,t.length),l=[...t].sort(()=>.5-Math.random()).slice(0,r).map((s,t)=>({...s,order:1e3*e.section_order+t}));a=[...a,...l]}}if(a.sort((e,s)=>(e.order||0)-(s.order||0)),0===a.length)throw new Error("No questions found for this survey");i(a),j(!1)}catch(s){throw j(!1),s}})(t.surveyId),p(t.timeRemaining||2100),m(t.currentQuestionIndex||0),t.answers&&t.answers.length>0){const e={};t.answers.forEach(s=>{e[s.questionId]=s.selectedOptions||[]}),u(e),Object.keys(e).length>0&&S(!0)}}catch(e){j(!1)}},Y=async()=>{try{await X.submitTest(s),t("/my-results",{state:{message:"Test auto-submitted due to time expiry.",autoSubmitted:!0,showCertificate:!1}})}catch(e){}},V=()=>{S(!1),O(!1)},K=e=>{switch(e){case"answered":return"bg-green-500 text-white";case"flagged":return"bg-yellow-500 text-white";case"flagged-answered":return"bg-orange-500 text-white";default:return"bg-gray-200 text-gray-700"}},W=l.filter(e=>x[e.id]&&x[e.id].length>0).length,J=l.length-W;if(g)return L.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:L.jsxs("div",{className:"text-center",children:[L.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),L.jsx("p",{className:"text-gray-600",children:"Loading test session and questions..."}),a&&L.jsxs("p",{className:"text-sm text-gray-500 mt-2",children:["Session ID: ",a.id]})]})});if(!a||0===l.length)return L.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:L.jsxs(As,{className:"max-w-md w-full text-center",children:[L.jsx(oe,{className:"w-12 h-12 text-red-600 mx-auto mb-4"}),L.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Test Not Found"}),L.jsx("p",{className:"text-gray-600 mb-4",children:"The test session could not be loaded."}),L.jsx(bs,{onClick:()=>t("/available-tests"),children:"Back to Available Tests"})]})});const ee=l[n];return L.jsxs("div",{className:"min-h-screen bg-gray-50",children:[L.jsx("div",{className:"bg-white border-b border-gray-200 px-6 py-4",children:L.jsxs("div",{className:"flex items-center justify-between",children:[L.jsx("div",{className:"flex items-center space-x-4",children:L.jsxs("div",{children:[L.jsx("h1",{className:"text-xl font-semibold text-gray-900",children:"Digital Literacy Assessment"}),L.jsxs("p",{className:"text-sm text-gray-600",children:["Attempt ",a.attemptNumber]})]})}),L.jsxs("div",{className:"flex items-center space-x-6",children:[L.jsx("div",{className:"flex items-center",children:A?L.jsxs("div",{className:"flex items-center text-green-600",children:[L.jsx(os,{className:"w-4 h-4 mr-1"}),L.jsx("span",{className:"text-xs",children:"Online"})]}):L.jsxs("div",{className:"flex items-center text-red-600",children:[L.jsx(ds,{className:"w-4 h-4 mr-1"}),L.jsx("span",{className:"text-xs",children:"Offline"})]})}),L.jsxs("div",{className:"flex items-center",children:["saving"===T&&L.jsxs("div",{className:"flex items-center text-blue-600",children:[L.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border-b-2 border-blue-600 mr-1"}),L.jsx("span",{className:"text-xs",children:"Saving..."})]}),"saved"===T&&L.jsxs("div",{className:"flex items-center text-green-600",children:[L.jsx(Ze,{className:"w-3 h-3 mr-1"}),L.jsx("span",{className:"text-xs",children:"Saved"})]}),"error"===T&&L.jsxs("div",{className:"flex items-center text-red-600",children:[L.jsx(oe,{className:"w-3 h-3 mr-1"}),L.jsx("span",{className:"text-xs",children:"Save failed"})]}),D&&!T&&L.jsxs("div",{className:"text-xs text-gray-500",children:["Last saved: ",D.toLocaleTimeString()]})]}),L.jsxs("div",{className:"text-center",children:[L.jsxs("div",{className:"text-2xl font-bold "+(h<=300?"text-red-600":"text-gray-900"),children:[fs(h),P&&L.jsx("span",{className:"text-sm text-orange-600 block",children:"PAUSED"})]}),L.jsx("p",{className:"text-xs text-gray-500",children:"Time Remaining"})]}),L.jsxs("div",{className:"text-center",children:[L.jsxs("div",{className:"text-lg font-semibold text-gray-900",children:[n+1," / ",l.length]}),L.jsx("p",{className:"text-xs text-gray-500",children:"Question"})]})]})]})}),L.jsxs("div",{className:"flex",children:[L.jsxs("div",{className:"w-64 bg-white border-r border-gray-200 p-4",children:[L.jsx("h3",{className:"font-semibold text-gray-900 mb-4",children:"Question Navigator"}),L.jsxs("div",{className:"mb-4 text-sm",children:[L.jsxs("div",{className:"flex justify-between mb-2",children:[L.jsx("span",{children:"Answered:"}),L.jsx("span",{className:"font-medium text-green-600",children:W})]}),L.jsxs("div",{className:"flex justify-between mb-2",children:[L.jsx("span",{children:"Unanswered:"}),L.jsx("span",{className:"font-medium text-red-600",children:J})]}),L.jsxs("div",{className:"flex justify-between",children:[L.jsx("span",{children:"Flagged:"}),L.jsx("span",{className:"font-medium text-yellow-600",children:C.size})]})]}),L.jsx("div",{className:"space-y-4",children:Object.entries(l.reduce((e,s,t)=>{const a=`Section ${Math.floor((s.order||0)/1e3)}`;return e[a]||(e[a]=[]),e[a].push({question:s,index:t}),e},{})).sort(([e],[s])=>e.localeCompare(s)).map(([e,s])=>L.jsxs("div",{className:"mb-4",children:[L.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:e}),L.jsx("div",{className:"grid grid-cols-5 gap-2",children:s.map(({question:e,index:s})=>{const t=(e=>{const s=l[e];if(!s)return"unanswered";const t=x[s.id]&&x[s.id].length>0,a=C.has(e);return a&&t?"flagged-answered":a?"flagged":t?"answered":"unanswered"})(s);return L.jsx("button",{onClick:()=>(e=>{P||m(e)})(s),disabled:P,className:`w-10 h-10 rounded text-sm font-medium transition-colors ${s===n?"ring-2 ring-blue-500 ring-offset-2":""} ${K(t)} ${P?"opacity-50 cursor-not-allowed":""}`,children:s+1},s)})})]},e))}),L.jsxs("div",{className:"mt-6 space-y-2 text-xs",children:[L.jsxs("div",{className:"flex items-center space-x-2",children:[L.jsx("div",{className:"w-4 h-4 bg-green-500 rounded"}),L.jsx("span",{children:"Answered"})]}),L.jsxs("div",{className:"flex items-center space-x-2",children:[L.jsx("div",{className:"w-4 h-4 bg-yellow-500 rounded"}),L.jsx("span",{children:"Flagged"})]}),L.jsxs("div",{className:"flex items-center space-x-2",children:[L.jsx("div",{className:"w-4 h-4 bg-orange-500 rounded"}),L.jsx("span",{children:"Flagged & Answered"})]}),L.jsxs("div",{className:"flex items-center space-x-2",children:[L.jsx("div",{className:"w-4 h-4 bg-gray-200 rounded"}),L.jsx("span",{children:"Unanswered"})]})]}),L.jsxs("div",{className:"mt-6",children:[L.jsxs(bs,{variant:"secondary",size:"sm",className:"w-full flex items-center justify-center space-x-2",onClick:Z,disabled:P,children:[L.jsx(Ze,{className:"w-4 h-4"}),L.jsx("span",{children:"Save Progress"})]}),L.jsx("p",{className:"text-xs text-gray-500 mt-2 text-center",children:"Progress is auto-saved every 30 seconds"})]}),P&&L.jsxs("div",{className:"mt-4 p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:[L.jsx("p",{className:"text-sm font-medium text-yellow-800 text-center",children:"Test is paused due to network connectivity"}),L.jsx("p",{className:"text-xs text-yellow-700 text-center mt-1",children:"Test will resume automatically when connection is restored"})]})]}),L.jsx("div",{className:"flex-1 p-6",children:L.jsx(As,{className:"max-w-4xl mx-auto",children:P?L.jsxs("div",{className:"text-center py-12",children:[L.jsx(Me,{className:"w-16 h-16 text-yellow-500 mx-auto mb-4"}),L.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Test Automatically Paused"}),L.jsx("p",{className:"text-gray-600 mb-6",children:"Your test has been paused due to network connectivity issues. The timer has been stopped and will resume automatically when your connection is restored."}),L.jsxs("div",{className:"flex items-center justify-center space-x-2 text-orange-600",children:[L.jsx(ds,{className:"w-5 h-5"}),L.jsx("span",{className:"text-sm font-medium",children:"Waiting for network connection..."})]})]}):L.jsxs(L.Fragment,{children:[L.jsxs("div",{className:"flex items-center justify-between mb-6",children:[L.jsxs("div",{className:"flex items-center space-x-2",children:[L.jsxs("span",{className:"px-2 py-1 bg-gray-100 text-gray-700 text-xs font-medium rounded-full",children:["Section ",Math.floor((ee.order||0)/1e3)]}),L.jsxs("span",{className:"px-3 py-1 bg-blue-100 text-blue-800 text-sm font-medium rounded-full",children:["Question ",n+1]}),L.jsx("span",{className:"px-3 py-1 text-sm font-medium rounded-full "+("easy"===ee.complexity?"bg-green-100 text-green-800":"medium"===ee.complexity?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"),children:ee.complexity.charAt(0).toUpperCase()+ee.complexity.slice(1)}),L.jsxs("span",{className:"text-sm text-gray-500",children:[ee.points," point",1!==ee.points?"s":""]})]}),L.jsxs(bs,{variant:"secondary",size:"sm",onClick:()=>{return e=n,void(P||k(s=>{const t=new Set(s);return t.has(e)?t.delete(e):t.add(e),t}));var e},className:"flex items-center space-x-2 "+(C.has(n)?"bg-yellow-100 text-yellow-800":""),children:[L.jsx(ke,{className:"w-4 h-4"}),L.jsx("span",{children:C.has(n)?"Unflag":"Flag"})]})]}),L.jsxs("div",{className:"mb-8",children:[L.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:ee.text}),L.jsx("div",{className:"space-y-3",children:ee.options.map(e=>{var s;return L.jsxs("label",{className:"flex items-start space-x-3 p-4 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer transition-colors",children:[L.jsx("input",{type:"multiple_choice"===ee.type?"checkbox":"radio",name:`question-${ee.id}`,value:e.id,checked:(null==(s=x[ee.id])?void 0:s.includes(e.id))||!1,onChange:()=>(async(e,s,t)=>{if(P)return;const r={...x};if(t){const t=r[e]||[];r[e]=t.includes(s)?t.filter(e=>e!==s):[...t,s]}else r[e]=[s];u(r);try{await X.saveAnswer(a.id,e,r[e])}catch(l){}})(ee.id,e.id,"multiple_choice"===ee.type),className:"mt-1 rounded border-gray-300 text-blue-600 focus:ring-blue-500",disabled:P}),L.jsx("span",{className:"text-gray-900",children:e.text})]},e.id)})}),"multiple_choice"===ee.type&&L.jsxs("p",{className:"text-sm text-gray-500 mt-3",children:[L.jsx("strong",{children:"Note:"})," This is a multiple choice question. You can select more than one answer."]}),ee.explanation&&L.jsx("div",{className:"mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:L.jsxs("p",{className:"text-sm text-blue-800",children:[L.jsx("strong",{children:"Hint:"})," ",ee.explanation]})})]}),L.jsxs("div",{className:"flex items-center justify-between pt-6 border-t border-gray-200",children:[L.jsxs(bs,{variant:"secondary",onClick:()=>{P||n>0&&m(e=>e-1)},disabled:0===n||P,className:"flex items-center space-x-2",children:[L.jsx(me,{className:"w-4 h-4"}),L.jsx("span",{children:"Previous"})]}),L.jsxs("div",{className:"flex items-center space-x-4",children:[L.jsxs(bs,{variant:"secondary",onClick:()=>b(!0),disabled:P,className:"flex items-center space-x-2",children:[L.jsx(ve,{className:"w-4 h-4"}),L.jsx("span",{children:"Submit Test"})]}),n<l.length-1?L.jsxs(bs,{onClick:()=>{P||n<l.length-1&&m(e=>e+1)},disabled:P,className:"flex items-center space-x-2",children:[L.jsx("span",{children:"Next"}),L.jsx(xe,{className:"w-4 h-4"})]}):L.jsxs(bs,{onClick:()=>b(!0),disabled:P,className:"flex items-center space-x-2",children:[L.jsx(ve,{className:"w-4 h-4"}),L.jsx("span",{children:"Finish Test"})]})]})]})]})})})]}),z&&L.jsxs("div",{className:"fixed top-4 right-4 bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg shadow-lg z-50 flex items-center space-x-2",children:[L.jsx(oe,{className:"w-5 h-5"}),L.jsxs("div",{children:[L.jsx("p",{className:"font-bold",children:"Security Alert"}),L.jsx("p",{className:"text-sm",children:"Unauthorized action detected. This has been logged."})]})]}),!A&&L.jsxs("div",{className:"fixed bottom-4 right-4 bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg shadow-lg flex items-center space-x-2",children:[L.jsx(ds,{className:"w-5 h-5"}),L.jsxs("div",{children:[L.jsx("p",{className:"font-bold",children:"You are offline"}),L.jsx("p",{className:"text-sm",children:"Test is paused. Progress saved locally and will sync when you're back online."})]})]}),L.jsx(us,{isOpen:_,onClose:V,title:"Resume Test Session",children:L.jsxs("div",{className:"text-center",children:[L.jsx($e,{className:"w-12 h-12 text-blue-600 mx-auto mb-4"}),L.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Resume Previous Session?"}),L.jsx("p",{className:"text-gray-600 mb-4",children:"We found a saved test session. Would you like to resume from where you left off?"}),L.jsxs("div",{className:"flex justify-center space-x-4",children:[L.jsx(bs,{variant:"secondary",onClick:()=>{m(0),u({}),k(new Set),p(2100),S(!1),O(!1)},children:"Start Fresh"}),L.jsx(bs,{onClick:V,children:"Resume Session"})]})]})}),L.jsx(us,{isOpen:N,onClose:()=>w(!1),title:"Time Warning",children:L.jsxs("div",{className:"text-center",children:[L.jsx(be,{className:"w-12 h-12 text-orange-600 mx-auto mb-4"}),L.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"5 Minutes Remaining!"}),L.jsx("p",{className:"text-gray-600 mb-4",children:"You have only 5 minutes left to complete the test. Please review your answers and submit soon."}),L.jsx(bs,{onClick:()=>w(!1),children:"Continue Test"})]})}),L.jsx(us,{isOpen:v,onClose:()=>b(!1),title:"Submit Test",children:L.jsxs("div",{className:"space-y-4",children:[L.jsxs("div",{className:"text-center",children:[L.jsx(oe,{className:"w-12 h-12 text-yellow-600 mx-auto mb-4"}),L.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Submit Test?"}),L.jsx("p",{className:"text-gray-600",children:"Are you sure you want to submit your test? This action cannot be undone."})]}),L.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[L.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Test Summary:"}),L.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[L.jsxs("div",{children:[L.jsx("span",{className:"text-gray-600",children:"Total Questions:"}),L.jsx("span",{className:"ml-2 font-medium",children:l.length})]}),L.jsxs("div",{children:[L.jsx("span",{className:"text-gray-600",children:"Answered:"}),L.jsx("span",{className:"ml-2 font-medium text-green-600",children:W})]}),L.jsxs("div",{children:[L.jsx("span",{className:"text-gray-600",children:"Unanswered:"}),L.jsx("span",{className:"ml-2 font-medium text-red-600",children:J})]}),L.jsxs("div",{children:[L.jsx("span",{className:"text-gray-600",children:"Flagged:"}),L.jsx("span",{className:"ml-2 font-medium text-yellow-600",children:C.size})]})]})]}),J>0&&L.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-3",children:L.jsxs("p",{className:"text-yellow-800 text-sm",children:[L.jsx("strong",{children:"Warning:"})," You have ",J," unanswered question",1!==J?"s":"",". These will be marked as incorrect."]})}),L.jsxs("div",{className:"flex justify-end space-x-3 pt-4 border-t",children:[L.jsx(bs,{variant:"secondary",onClick:()=>b(!1),children:"Continue Test"}),L.jsxs(bs,{onClick:async()=>{var e,a;try{f(!0);const r=await X.submitTest(s);r.success&&t("/my-results",{state:{message:"Test submitted successfully!",result:r.data,showCertificate:(null==(e=r.data)?void 0:e.isPassed)&&(null==(a=r.data)?void 0:a.certificateId)}})}catch(r){alert("Failed to submit test. Please try again.")}finally{f(!1),b(!1)}},loading:y,className:"flex items-center space-x-2",children:[L.jsx(ve,{className:"w-4 h-4"}),L.jsx("span",{children:"Submit Test"})]})]})]})})]})}const ct=[{path:"/dashboard",label:"Admin Dashboard",category:"Dashboard",level:1},{path:"/users",label:"User Management",category:"Administration",level:1},{path:"/roles",label:"Role Management",category:"Administration",level:1},{path:"/surveys",label:"Survey Management",category:"Content",level:1},{path:"/questions",label:"Question Bank",category:"Content",level:1},{path:"/settings",label:"System Settings",category:"Administration",level:1},{path:"/zo-dashboard",label:"ZO Dashboard",category:"Dashboard",level:2},{path:"/zone-performance",label:"Zone Performance",category:"Analytics",level:2},{path:"/regional-overview",label:"Regional Overview",category:"Analytics",level:2},{path:"/ro-dashboard",label:"RO Dashboard",category:"Dashboard",level:3},{path:"/district-performance",label:"District Performance",category:"Analytics",level:3},{path:"/supervisor-teams",label:"Supervisor Teams",category:"Management",level:3},{path:"/supervisor-dashboard",label:"Supervisor Dashboard",category:"Dashboard",level:4},{path:"/team-results",label:"Team Results",category:"Analytics",level:4},{path:"/my-enumerators",label:"My Enumerators",category:"Management",level:4},{path:"/assigned-surveys",label:"Assigned Surveys",category:"Content",level:4},{path:"/enumerator-dashboard",label:"My Dashboard",category:"Dashboard",level:5},{path:"/available-tests",label:"Available Tests",category:"Testing",level:5},{path:"/my-results",label:"My Results",category:"Testing",level:5},{path:"/my-certificates",label:"My Certificates",category:"Testing",level:5},{path:"/test-schedule",label:"Test Schedule",category:"Testing",level:5},{path:"/results",label:"Results & Analytics",category:"Analytics",level:1},{path:"/enumerator-status",label:"Enumerator Status",category:"Monitoring",level:1},{path:"/certificates",label:"Certificates",category:"Certificates",level:1}];function dt(){const[s,t]=e.useState([]),[a,r]=e.useState(null),[l,i]=e.useState(!0),[n,c]=e.useState(!1),[d,o]=e.useState(!1),[m,x]=e.useState([]),[u,h]=e.useState(""),[p,g]=e.useState("all");e.useEffect(()=>{j()},[]);const j=async()=>{try{i(!0);const e=await W.getRoles();t(e.data)}catch(e){}finally{i(!1)}},y=ct.filter(e=>{const s=e.label.toLowerCase().includes(u.toLowerCase())||e.path.toLowerCase().includes(u.toLowerCase()),t="all"===p||e.category===p;return s&&t}).reduce((e,s)=>(e[s.category]||(e[s.category]=[]),e[s.category].push(s),e),{}),f=[...new Set(ct.map(e=>e.category))];return L.jsx(Ms,{children:L.jsxs("div",{className:"p-6",children:[L.jsxs("div",{className:"flex items-center justify-between mb-6",children:[L.jsxs("div",{children:[L.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Role-Based Menu Access Control"}),L.jsx("p",{className:"text-gray-600 mt-2",children:"Configure menu access permissions for each role"})]}),L.jsx("div",{className:"flex items-center space-x-2",children:L.jsx("div",{className:"px-3 py-1 bg-green-100 text-green-800 rounded-full text-sm font-medium",children:"RBAC Enabled"})})]}),L.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8",children:l?Array.from({length:5}).map((e,s)=>L.jsx(As,{className:"animate-pulse",children:L.jsx("div",{className:"h-32 bg-gray-200 rounded"})},s)):s.map(e=>{var s,t,a;return L.jsxs(As,{className:"hover:shadow-lg transition-shadow",children:[L.jsxs("div",{className:"flex items-center justify-between mb-4",children:[L.jsxs("div",{className:"flex items-center space-x-3",children:[L.jsx("div",{className:"p-2 rounded-lg "+(1===e.level?"bg-red-100":2===e.level?"bg-purple-100":3===e.level?"bg-indigo-100":4===e.level?"bg-green-100":"bg-blue-100"),children:L.jsx(Ve,{className:"w-5 h-5 "+(1===e.level?"text-red-600":2===e.level?"text-purple-600":3===e.level?"text-indigo-600":4===e.level?"text-green-600":"text-blue-600")})}),L.jsxs("div",{children:[L.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:e.name}),L.jsxs("span",{className:"text-xs text-gray-500",children:["Level ",e.level]})]})]}),L.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-medium "+(e.isActive?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"),children:e.isActive?"Active":"Inactive"})]}),L.jsx("p",{className:"text-gray-600 text-sm mb-4",children:e.description}),L.jsxs("div",{className:"space-y-2 mb-4",children:[L.jsxs("div",{className:"flex items-center justify-between text-sm",children:[L.jsx("span",{className:"text-gray-500",children:"Menu Items:"}),L.jsx("span",{className:"font-medium",children:(null==(s=e.menuAccess)?void 0:s.length)||0})]}),L.jsxs("div",{className:"flex items-center justify-between text-sm",children:[L.jsx("span",{className:"text-gray-500",children:"Users:"}),L.jsx("span",{className:"font-medium",children:e.userCount||0})]})]}),L.jsxs("div",{className:"flex items-center justify-between",children:[L.jsxs("div",{className:"flex flex-wrap gap-1",children:[(e.menuAccess||[]).slice(0,2).map(e=>{const s=ct.find(s=>s.path===e);return L.jsx("span",{className:"px-2 py-1 bg-blue-50 text-blue-700 text-xs rounded-full",children:(null==s?void 0:s.label)||e},e)}),((null==(t=e.menuAccess)?void 0:t.length)||0)>2&&L.jsxs("span",{className:"px-2 py-1 bg-gray-100 text-gray-600 text-xs rounded-full",children:["+",((null==(a=e.menuAccess)?void 0:a.length)||0)-2," more"]})]}),L.jsxs(bs,{variant:"secondary",size:"sm",onClick:()=>(e=>{r(e),x(e.menuAccess||[]),c(!0)})(e),className:"flex items-center space-x-2",children:[L.jsx(Ke,{className:"w-4 h-4"}),L.jsx("span",{children:"Configure"})]})]})]},e.id)})}),L.jsx(us,{isOpen:n,onClose:()=>{c(!1),r(null),x([])},title:`Configure Menu Access: ${null==a?void 0:a.name}`,size:"xl",children:a&&L.jsxs("div",{className:"space-y-6",children:[L.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[L.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[L.jsx(Ve,{className:"w-5 h-5 text-blue-600"}),L.jsx("h3",{className:"font-semibold text-gray-900",children:a.name}),L.jsxs("span",{className:"px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded-full",children:["Level ",a.level]})]}),L.jsx("p",{className:"text-sm text-gray-600",children:a.description}),L.jsxs("div",{className:"mt-2 flex items-center space-x-4 text-sm",children:[L.jsxs("span",{className:"text-gray-500",children:["Users: ",a.userCount||0]}),L.jsxs("span",{className:"text-gray-500",children:["Selected Menus: ",m.length]})]})]}),L.jsxs("div",{className:"flex items-center justify-between",children:[L.jsxs("div",{className:"flex items-center space-x-2",children:[L.jsxs(bs,{variant:"secondary",size:"sm",onClick:()=>(e=>{const s=ct.filter(s=>s.level>=e).map(e=>e.path);x(e=>{const t=[...e];return s.forEach(e=>{t.includes(e)||t.push(e)}),t})})(a.level),className:"flex items-center space-x-2",children:[L.jsx(ze,{className:"w-4 h-4"}),L.jsxs("span",{children:["Add Level ",a.level,"+ Menus"]})]}),L.jsxs(bs,{variant:"secondary",size:"sm",onClick:()=>x([]),className:"flex items-center space-x-2",children:[L.jsx(qe,{className:"w-4 h-4"}),L.jsx("span",{children:"Clear All"})]})]}),L.jsxs("div",{className:"flex items-center space-x-4",children:[L.jsx("div",{className:"relative",children:L.jsx(Ns,{placeholder:"Search menus...",value:u,onChange:e=>h(e.target.value),className:"w-48"})}),L.jsxs("select",{value:p,onChange:e=>g(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[L.jsx("option",{value:"all",children:"All Categories"}),f.map(e=>L.jsx("option",{value:e,children:e},e))]})]})]}),L.jsx("div",{className:"space-y-4 max-h-96 overflow-y-auto",children:Object.entries(y).map(([e,s])=>L.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[L.jsxs("div",{className:"flex items-center justify-between mb-3",children:[L.jsx("h4",{className:"font-medium text-gray-900",children:e}),L.jsxs("div",{className:"flex items-center space-x-2",children:[L.jsx(bs,{variant:"secondary",size:"sm",onClick:()=>{const e=s.map(e=>e.path);x(s=>[...new Set([...s,...e])])},className:"text-xs",children:"Select All"}),L.jsx(bs,{variant:"secondary",size:"sm",onClick:()=>{const e=s.map(e=>e.path);x(s=>s.filter(s=>!e.includes(s)))},className:"text-xs",children:"Deselect All"})]})]}),L.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:s.map(e=>{const s=m.includes(e.path),t=e.level>=a.level;return L.jsxs("label",{className:"flex items-center space-x-3 p-3 rounded-lg cursor-pointer transition-colors "+(s?"bg-blue-50 border border-blue-200":"hover:bg-gray-50 border border-transparent"),children:[L.jsx("input",{type:"checkbox",checked:s,onChange:()=>{return s=e.path,void x(e=>e.includes(s)?e.filter(e=>e!==s):[...e,s]);var s},className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),L.jsxs("div",{className:"flex-1",children:[L.jsxs("div",{className:"flex items-center space-x-2",children:[L.jsx("span",{className:"text-sm font-medium text-gray-900",children:e.label}),L.jsxs("span",{className:"px-1.5 py-0.5 bg-gray-100 text-gray-600 text-xs rounded",children:["L",e.level]}),t&&L.jsx("span",{className:"px-1.5 py-0.5 bg-green-100 text-green-600 text-xs rounded",children:"Recommended"})]}),L.jsx("div",{className:"text-xs text-gray-500 font-mono",children:e.path})]}),s&&L.jsx(ve,{className:"w-4 h-4 text-blue-600"})]},e.path)})})]},e))}),L.jsxs("div",{className:"bg-blue-50 rounded-lg p-4",children:[L.jsx("h4",{className:"font-medium text-blue-900 mb-2",children:"Access Summary"}),L.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:f.map(e=>{const s=ct.filter(s=>s.category===e),t=m.filter(e=>s.some(s=>s.path===e)).length;return L.jsxs("div",{className:"text-center",children:[L.jsxs("p",{className:"font-medium text-blue-900",children:[t,"/",s.length]}),L.jsx("p",{className:"text-blue-700",children:e})]},e)})})]}),L.jsxs("div",{className:"flex justify-end space-x-3 pt-4 border-t",children:[L.jsx(bs,{variant:"secondary",onClick:()=>{c(!1),r(null),x([])},children:"Cancel"}),L.jsxs(bs,{onClick:async()=>{if(a)try{o(!0);(await W.updateRoleMenuAccess(a.id,m)).success&&(t(s.map(e=>e.id===a.id?{...e,menuAccess:m}:e)),c(!1),r(null),x([]))}catch(e){}finally{o(!1)}},loading:d,className:"flex items-center space-x-2",children:[L.jsx(Ze,{className:"w-4 h-4"}),L.jsx("span",{children:"Save Menu Access"})]})]})]})})]})})}function ot(){const e=c(),{user:s}=_s();return L.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center px-4",children:L.jsx(As,{className:"max-w-md w-full text-center",children:L.jsxs("div",{className:"p-8",children:[L.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-6",children:L.jsx(Ve,{className:"w-8 h-8 text-red-600"})}),L.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Access Denied"}),L.jsxs("p",{className:"text-gray-600 mb-6",children:["You don't have permission to access this page. Your current role (",null==s?void 0:s.role.name,") doesn't include access to this resource."]}),L.jsxs("div",{className:"space-y-3",children:[L.jsxs(bs,{onClick:()=>{e("/login")},className:"w-full flex items-center justify-center space-x-2",children:[L.jsx(De,{className:"w-4 h-4"}),L.jsx("span",{children:"Go to Dashboard"})]}),L.jsxs(bs,{variant:"secondary",onClick:()=>{e("/login")},className:"w-full flex items-center justify-center space-x-2",children:[L.jsx(me,{className:"w-4 h-4"}),L.jsx("span",{children:"Go Back"})]})]}),L.jsx("div",{className:"mt-6 p-4 bg-blue-50 rounded-lg",children:L.jsxs("p",{className:"text-sm text-blue-800",children:[L.jsx("strong",{children:"Need access?"})," Contact your administrator to request additional permissions for your role."]})})]})})})}function mt({children:e,requiredRoles:s=[],requiredLevel:t,redirectTo:a="/unauthorized"}){const{user:r,isAuthenticated:l}=_s();if(!l||!r)return L.jsx(i,{to:"/login",replace:!0});const n="Administrator"===r.role.name?"Admin":r.role.name,c=r.role.level;return(0===s.length||s.includes(n))&&(!t||c<=t)?L.jsx(L.Fragment,{children:e}):L.jsx(i,{to:a,replace:!0})}function xt(){const{user:e}=_s();return L.jsx(i,{to:(()=>{if(!e)return"/dashboard";switch(e.role.name.toLowerCase()){case"administrator":case"admin":default:return"/dashboard";case"zo user":return"/zo-dashboard";case"ro user":return"/ro-dashboard";case"supervisor":return"/supervisor-dashboard";case"enumerator":case"fresherbscbca":return"/enumerator-dashboard"}})(),replace:!0})}function ut(){return L.jsxs(m,{children:[L.jsx(x,{path:"/dashboard",element:L.jsx(mt,{requiredRoles:["Admin"],children:L.jsx(Bs,{})})}),L.jsx(x,{path:"/users",element:L.jsx(mt,{requiredRoles:["Admin"],children:L.jsx(Ws,{})})}),L.jsx(x,{path:"/roles",element:L.jsx(mt,{requiredRoles:["Admin"],children:L.jsx(Hs,{})})}),L.jsx(x,{path:"/role-menu-management",element:L.jsx(mt,{requiredRoles:["Admin"],children:L.jsx(dt,{})})}),L.jsx(x,{path:"/surveys",element:L.jsx(mt,{requiredRoles:["Admin"],children:L.jsx(Gs,{})})}),L.jsx(x,{path:"/questions",element:L.jsx(mt,{requiredRoles:["Admin"],children:L.jsx(Xs,{})})}),L.jsx(x,{path:"/settings",element:L.jsx(mt,{requiredRoles:["Admin"],children:L.jsx(tt,{})})}),L.jsx(x,{path:"/zo-dashboard",element:L.jsx(mt,{requiredRoles:["ZO User"],children:L.jsx($s,{})})}),L.jsx(x,{path:"/ro-dashboard",element:L.jsx(mt,{requiredRoles:["RO User"],children:L.jsx(Zs,{})})}),L.jsx(x,{path:"/supervisor-dashboard",element:L.jsx(mt,{requiredRoles:["Supervisor"],children:L.jsx(Qs,{})})}),L.jsx(x,{path:"/team-results",element:L.jsx(mt,{requiredRoles:["Supervisor"],children:L.jsx(Vs,{})})}),L.jsx(x,{path:"/my-enumerators",element:L.jsx(mt,{requiredRoles:["Supervisor"],children:L.jsx(Ks,{})})}),L.jsx(x,{path:"/enumerator-dashboard",element:L.jsx(mt,{requiredRoles:["Enumerator"],children:L.jsx(Ys,{})})}),L.jsx(x,{path:"/available-tests",element:L.jsx(mt,{requiredRoles:["Enumerator","FresherBScBCA"],children:L.jsx(at,{})})}),L.jsx(x,{path:"/my-results",element:L.jsx(mt,{requiredRoles:["Enumerator","FresherBScBCA"],children:L.jsx(rt,{})})}),L.jsx(x,{path:"/my-certificates",element:L.jsx(mt,{requiredRoles:["Enumerator","FresherBScBCA"],children:L.jsx(lt,{})})}),L.jsx(x,{path:"/test-schedule",element:L.jsx(mt,{requiredRoles:["Enumerator","FresherBScBCA"],children:L.jsx(it,{})})}),L.jsx(x,{path:"/test/:sessionId",element:L.jsx(mt,{requiredRoles:["Enumerator","FresherBScBCA"],children:L.jsx(nt,{})})}),L.jsx(x,{path:"/results",element:L.jsx(mt,{requiredRoles:["Admin","ZO User","RO User","Supervisor"],children:L.jsx(Js,{})})}),L.jsx(x,{path:"/enumerator-status",element:L.jsx(mt,{requiredRoles:["Admin","ZO User","RO User","Supervisor"],children:L.jsx(et,{})})}),L.jsx(x,{path:"/certificates",element:L.jsx(mt,{requiredRoles:["Admin","ZO User","RO User","Supervisor","Enumerator"],children:L.jsx(st,{})})}),L.jsx(x,{path:"/unauthorized",element:L.jsx(ot,{})}),L.jsx(x,{path:"/",element:L.jsx(xt,{})})]})}function ht(){return L.jsx(Es,{children:L.jsx(u,{children:L.jsx(ks,{children:L.jsxs(m,{children:[L.jsx(x,{path:"/login",element:L.jsx(Ts,{})}),L.jsx(x,{path:"/*",element:L.jsx(Is,{children:L.jsx(ut,{})})})]})})})})}hs.suppressConsoleWarnings(),O(document.getElementById("root")).render(L.jsx(e.StrictMode,{children:L.jsx(Ss,{children:L.jsx(ht,{})})}));
